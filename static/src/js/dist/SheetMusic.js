/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./src/js/JZZ.js":
/*!***********************!*\
  !*** ./src/js/JZZ.js ***!
  \***********************/
/***/ (function(module, __unused_webpack_exports, __webpack_require__) {

eval("(function(global, factory) {\n  /* istanbul ignore next */\n  if (true) {\n    module.exports = factory();\n  }\n  else {}\n})(this, function() {\n\n  var _scope = typeof window === 'undefined' ? __webpack_require__.g : window;\n  var _version = '1.5.9';\n  var i, j, k, m, n;\n\n  /* istanbul ignore next */\n  var _time = Date.now || function () { return new Date().getTime(); };\n  var _startTime = _time();\n  /* istanbul ignore next */\n  var _now = typeof performance != 'undefined' && performance.now ?\n    function() { return performance.now(); } : function() { return _time() - _startTime; };\n  var _schedule = function(f) {\n    setTimeout(f, 0);\n  };\n  function _nop() {}\n  function _func(f) { return typeof f == 'function'; }\n\n  // _R: common root for all async objects\n  function _R() {\n    this._orig = this;\n    this._ready = false;\n    this._queue = [];\n    this._log = [];\n  }\n  _R.prototype._exec = function() {\n    while (this._ready && this._queue.length) {\n      var x = this._queue.shift();\n      x[0].apply(this, x[1]);\n    }\n  };\n  _R.prototype._push = function(func, arg) { this._queue.push([func, arg]); _R.prototype._exec.apply(this); };\n  _R.prototype._slip = function(func, arg) { this._queue.unshift([func, arg]); };\n  _R.prototype._pause = function() { this._ready = false; };\n  _R.prototype._resume = function() { this._ready = true; _R.prototype._exec.apply(this); };\n  _R.prototype._break = function(err) { this._orig._bad = true; this._orig._log.push(err || 'Unknown JZZ error'); };\n  _R.prototype._repair = function() { this._orig._bad = false; };\n  _R.prototype._crash = function(err) { this._break(err); this._resume(); };\n  _R.prototype._err = function() { return this._log[this._log.length - 1]; };\n  _R.prototype.log = function() { return _clone(this._log); };\n  _R.prototype._dup = function() {\n    var F = function() {};\n    F.prototype = this._orig;\n    var ret = new F();\n    ret._ready = false;\n    ret._queue = [];\n    return ret;\n  };\n  _R.prototype._image = function() { return this._dup(); };\n  _R.prototype._thenable = function() {\n    if (this.then) return this;\n    var self = this;\n    var F = function() {}; F.prototype = self;\n    var ret = new F();\n    ret.then = function(good, bad) { self._push(_then, [good, bad]); return this; };      \n    return ret;\n  };\n  function _then(good, bad) {\n    if (this._bad) {\n      if (_func(bad)) bad.apply(this, [new Error(this._err())]);\n    }\n    else {\n      if (_func(good)) good.apply(this, [this]);\n    }\n  }\n  function _wait(obj, delay) {\n    if (this._bad) obj._crash(this._err());\n    else setTimeout(function() { obj._resume(); }, delay);\n  }\n  _R.prototype.wait = function(delay) {\n    if (!delay) return this;\n    var ret = this._image();\n    this._push(_wait, [ret, delay]);\n    return ret._thenable();\n  };\n  function _kick(obj) { if (this._bad) obj._break(this._err()); obj._resume(); }\n  function _rechain(self, obj, name) {\n    self[name] = function() {\n      var arg = arguments;\n      var ret = obj._image();\n      this._push(_kick, [ret]);\n      return ret[name].apply(ret, arg);\n    };\n  }\n  function _and(q) {\n    if (!this._bad) {\n      if (_func(q)) q.apply(this); else console.log(q);\n    }\n  }\n  _R.prototype.and = function(func) { this._push(_and, [func]); return this._thenable(); };\n  function _or(q) {\n    if (this._bad) {\n      if (_func(q)) q.apply(this); else console.log(q);\n    }\n  }\n  _R.prototype.or = function(func) { this._push(_or, [func]); return this._thenable(); };\n\n  _R.prototype._info = {};\n  _R.prototype.info = function() {\n    var info = _clone(this._orig._info);\n    if (typeof info.engine == 'undefined') info.engine = 'none';\n    if (typeof info.sysex == 'undefined') info.sysex = true;\n    return info;\n  };\n  _R.prototype.name = function() { return this.info().name; };\n\n  function _close(obj) {\n    if (this._bad) obj._crash(this._err());\n    else {\n      this._break('Closed');\n      obj._resume();\n    }\n  }\n  _R.prototype.close = function() {\n    var ret = new _R();\n    if (this._close) this._push(this._close, []);\n    this._push(_close, [ret]);\n    return ret._thenable();\n  };\n\n  function _tryAny(arr) {\n    if (!arr.length) {\n      this._break();\n      return;\n    }\n    var func = arr.shift();\n    if (arr.length) {\n      var self = this;\n      this._slip(_or, [ function() { _tryAny.apply(self, [arr]); } ]);\n    }\n    try {\n      this._repair();\n      func.apply(this);\n    }\n    catch (err) {\n      this._break(err.toString());\n    }\n  }\n\n  function _push(arr, obj) {\n    for (var i = 0; i < arr.length; i++) if (arr[i] === obj) return;\n    arr.push(obj);\n  }\n  function _pop(arr, obj) {\n    for (var i = 0; i < arr.length; i++) if (arr[i] === obj) {\n      arr.splice(i, 1);\n      return;\n    }\n  }\n\n  // _J: JZZ object\n  function _J() {\n    _R.apply(this);\n  }\n  _J.prototype = new _R();\n\n  function _for(x, f) {\n    for(var k in x) if (x.hasOwnProperty(k)) f.call(this, k);\n  }\n  function _clone(obj, key, val) {\n    if (typeof key == 'undefined') return _clone(obj, [], []);\n    if (obj instanceof Object) {\n      for (var i = 0; i < key.length; i++) if (key[i] === obj) return val[i];\n      var ret;\n      if (obj instanceof Array) ret = []; else ret = {};\n      key.push(obj); val.push(ret);\n      _for(obj, function(k) { ret[k] = _clone(obj[k], key, val); });\n      return ret;\n    }\n    return obj;\n  }\n  _J.prototype._info = { name: 'JZZ.js', ver: _version, version: _version, inputs: [], outputs: [] };\n\n  var _outs = [];\n  var _ins = [];\n  var _outsW = [];\n  var _insW = [];\n\n  function _postRefresh() {\n    _jzz._info.engine = _engine._type;\n    _jzz._info.version = _engine._version;\n    _jzz._info.sysex = _engine._sysex;\n    _jzz._info.inputs = [];\n    _jzz._info.outputs = [];\n    _outs = [];\n    _ins = [];\n    _engine._allOuts = {};\n    _engine._allIns = {};\n    var i, x;\n    for (i = 0; i < _engine._outs.length; i++) {\n      x = _engine._outs[i];\n      x.engine = _engine;\n      _engine._allOuts[x.name] = x;\n      _jzz._info.outputs.push({\n        id: x.name,\n        name: x.name,\n        manufacturer: x.manufacturer,\n        version: x.version,\n        engine: _engine._type\n      });\n      _outs.push(x);\n    }\n    for (i = 0; i < _virtual._outs.length; i++) {\n      x = _virtual._outs[i];\n      _jzz._info.outputs.push({\n        id: x.name,\n        name: x.name,\n        manufacturer: x.manufacturer,\n        version: x.version,\n        engine: x.type\n      });\n      _outs.push(x);\n    }\n    for (i = 0; i < _engine._ins.length; i++) {\n      x = _engine._ins[i];\n      x.engine = _engine;\n      _engine._allIns[x.name] = x;\n      _jzz._info.inputs.push({\n        id: x.name,\n        name: x.name,\n        manufacturer: x.manufacturer,\n        version: x.version,\n        engine: _engine._type\n      });\n      _ins.push(x);\n    }\n    for (i = 0; i < _virtual._ins.length; i++) {\n      x = _virtual._ins[i];\n      _jzz._info.inputs.push({\n        id: x.name,\n        name: x.name,\n        manufacturer: x.manufacturer,\n        version: x.version,\n        engine: x.type\n      });\n      _ins.push(x);\n    }\n    if (_jzz._watcher && _jzz._watcher._handles.length) {\n      var diff = _diff(_insW, _outsW, _jzz._info.inputs, _jzz._info.outputs);\n       if (diff) {\n        for (j = 0; j < diff.inputs.removed.length; j++) {\n          x = _engine._inMap[diff.inputs.removed[j].name];\n          if (x) x._closeAll();\n        }\n        for (j = 0; j < diff.outputs.removed.length; j++) {\n          x = _engine._outMap[diff.outputs.removed[j].name];\n          if (x) x._closeAll();\n        }\n        _fireW(diff);\n      }\n    }\n    _insW = _jzz._info.inputs;\n    _outsW = _jzz._info.outputs;\n  }\n  function _refresh() {\n    if (!this._bad) _engine._refresh(this);\n  }\n  _J.prototype.refresh = function() {\n    this._push(_refresh, []);\n    return this._thenable();\n  };\n\n  function _filterList(q, arr) {\n    var i, n;\n    if (_func(q)) q = q(arr);\n    if (!(q instanceof Array)) q = [q];\n    var before = [];\n    var after = [];\n    var etc = arr.slice();\n    var a = before;\n    for (i = 0; i < q.length; i++) {\n      if (typeof q[i] == 'undefined') a = after;\n      else if (q[i] instanceof RegExp) for (n = 0; n < etc.length; n++) {\n        if (q[i].test(etc[n].name)) {\n          a.push(etc[n]);\n          etc.splice(n, 1);\n          n--;\n        }\n      }\n      else {\n        for (n = 0; n < etc.length; n++) if (q[i] + '' === n + '' || q[i] === etc[n].name || (q[i] instanceof Object && q[i].name === etc[n].name)) {\n          a.push(etc[n]);\n          etc.splice(n, 1);\n          n--;\n        }\n      }\n    }\n    return a == before ? before : before.concat(etc).concat(after);\n  }\n\n  function _notFound(port, q) {\n    var msg;\n    if (q instanceof RegExp) msg = 'Port matching ' + q + ' not found';\n    else if (q instanceof Object || typeof q == 'undefined') msg = 'Port not found';\n    else msg = 'Port \"' + q + '\" not found';\n    port._crash(msg);\n  }\n  function _openMidiOut(port, arg) {\n    if (this._bad) port._crash(this._err());\n    else {\n      var arr = _filterList(arg, _outs);\n      if (!arr.length) { _notFound(port, arg); return; }\n      var pack = function(x) { return function() { x.engine._openOut(this, x.name); }; };\n      for (var i = 0; i < arr.length; i++) arr[i] = pack(arr[i]);\n      port._slip(_tryAny, [arr]);\n      port._resume();\n    }\n  }\n  _J.prototype.openMidiOut = function(arg) {\n    var port = new _M();\n    this._push(_refresh, []);\n    this._push(_openMidiOut, [port, arg]);\n    return port._thenable();\n  };\n  _J.prototype._openMidiOutNR = function(arg) {\n    var port = new _M();\n    this._push(_openMidiOut, [port, arg]);\n    return port._thenable();\n  };\n\n  function _openMidiIn(port, arg) {\n    if (this._bad) port._crash(this._err());\n    else {\n      var arr = _filterList(arg, _ins);\n      if (!arr.length) { _notFound(port, arg); return; }\n      var pack = function(x) { return function() { x.engine._openIn(this, x.name); }; };\n      for (var i = 0; i < arr.length; i++) arr[i] = pack(arr[i]);\n      port._slip(_tryAny, [arr]);\n      port._resume();\n    }\n  }\n  _J.prototype.openMidiIn = function(arg) {\n    var port = new _M();\n    this._push(_refresh, []);\n    this._push(_openMidiIn, [port, arg]);\n    return port._thenable();\n  };\n  _J.prototype._openMidiInNR = function(arg) {\n    var port = new _M();\n    this._push(_openMidiIn, [port, arg]);\n    return port._thenable();\n  };\n\n  function _onChange(watcher, arg) {\n    if (this._bad) watcher._crash();\n    else {\n      watcher._slip(_connectW, [arg]);\n      watcher._resume();\n    }\n  }\n  _J.prototype.onChange = function(arg) {\n    if (!this._orig._watcher) this._orig._watcher = new _W();\n    var watcher = this._orig._watcher._image();\n    this._push(_onChange, [watcher, arg]);\n    return watcher._thenable();\n  };\n\n  _J.prototype._close = function() {\n    _engine._close();\n  };\n\n  // _M: MIDI-In/Out object\n  function _M() {\n    _R.apply(this);\n    this._handles = [];\n    this._outs = [];\n  }\n  _M.prototype = new _R();\n  _M.prototype._filter = function(msg) {\n    if (this._orig._mpe) {\n      var out;\n      var outs = 0;\n      if (this._handles && this._handles.length) {\n        outs = this._handles.length;\n        out = this._handles[0];\n      }\n      if (this._outs && this._outs.length) {\n        outs = this._outs.length;\n        out = this._outs[0];\n      }\n      if (outs == 1 && !out._mpe) {\n        msg = this._orig._mpe.filter(msg);\n      }\n    }\n    return msg;\n  };\n  _M.prototype._receive = function(msg) { this._emit(this._filter(msg)); };\n  function _receive(msg) { if (!this._bad) this._receive(msg); }\n  _M.prototype.send = function() {\n    this._push(_receive, [MIDI.apply(null, arguments)]);\n    return this._thenable();\n  };\n  _M.prototype.note = function(c, n, v, t) {\n    this.noteOn(c, n, v);\n    if (typeof this._ch == 'undefined' && typeof this._master == 'undefined') {\n      if (t > 0) this.wait(t).noteOff(c, n);\n    }\n    else {\n      if (v > 0) this.wait(v).noteOff(c);\n    }\n    return this._thenable();\n  };\n  _M.prototype._emit = function(msg) {\n    var i;\n    for (i = 0; i < this._handles.length; i++) this._handles[i].apply(this, [MIDI(msg)._stamp(this)]);\n    for (i = 0; i < this._outs.length; i++) {\n      var m = MIDI(msg);\n      if (!m._stamped(this._outs[i])) this._outs[i].send(m._stamp(this));\n    }\n  };\n  function _emit(msg) { this._emit(msg); }\n  _M.prototype.emit = function(msg) {\n    this._push(_emit, [msg]);\n    return this._thenable();\n  };\n  function _connect(arg) {\n    if (_func(arg)) _push(this._orig._handles, arg);\n    else _push(this._orig._outs, arg);\n  }\n  function _disconnect(arg) {\n    if (typeof arg == 'undefined') {\n      this._orig._handles = [];\n      this._orig._outs = [];\n    }\n    else if (_func(arg)) _pop(this._orig._handles, arg);\n    else _pop(this._orig._outs, arg);\n  }\n  _M.prototype.connect = function(arg) {\n    this._push(_connect, [arg]);\n    return this._thenable();\n  };\n  _M.prototype.disconnect = function(arg) {\n    this._push(_disconnect, [arg]);\n    return this._thenable();\n  };\n  _M.prototype.connected = function() {\n    return this._orig._handles.length + this._orig._outs.length;\n  };\n  _M.prototype._image = function() {\n    var dup = this._dup();\n    dup._ch = this._ch;\n    dup._sxid = this._sxid;\n    dup._master = this._master;\n    dup._band = this._band;\n    return dup;\n  };\n  _M.prototype._ch = undefined;\n  _M.prototype._sxid = 0x7f;\n  _M.prototype._master = undefined;\n  _M.prototype._band = undefined;\n\n  _M.prototype.sxId = function(id) {\n    if (typeof id == 'undefined') id = _M.prototype._sxid;\n    if (id == this._sxid) return this._thenable();\n    id = _7b(id);\n    var img = this._image();\n    img._sxid = id;\n    this._push(_kick, [img]);\n    return img._thenable();\n  };\n  _M.prototype.ch = function(c) {\n    if (c == this._ch || typeof c == 'undefined' && typeof this._ch == 'undefined') return this._thenable();\n    var img = this._image();\n    if (typeof c != 'undefined') c = _ch(c);\n    img._ch = c;\n    img._master = undefined;\n    img._band = undefined;\n    this._push(_kick, [img]);\n    return img._thenable();\n  };\n\n  function _mpe(m, n) {\n    if (!this._orig._mpe) this._orig._mpe = new MPE();\n    this._orig._mpe.setup(m, n);\n  }\n  _M.prototype.mpe = function(m, n) {\n    if (m == this._master && n == this._band || typeof m == 'undefined' && typeof this._master == 'undefined') return this._thenable();\n    if (typeof m != 'undefined') MPE.validate(m, n);\n    if (!n) return this.ch(m);\n    var img = this._image();\n    img._ch = undefined;\n    img._master = m;\n    img._band = n;\n    this._push(_mpe, [m, n]);\n    this._push(_kick, [img]);\n    return img._thenable();\n  };\n  function _validateChannel(c) {\n    if (c != parseInt(c) || c < 0 || c > 15)\n      throw RangeError('Bad channel value (must not be less than 0 or more than 15): ' + c);\n  }\n\n  // _W: Watcher object ~ MIDIAccess.onstatechange\n  function _W() {\n    _R.apply(this);\n    this._handles = [];\n    _rechain(this, _jzz, 'refresh');\n    _rechain(this, _jzz, 'openMidiOut');\n    _rechain(this, _jzz, 'openMidiIn');\n    _rechain(this, _jzz, 'onChange');\n    _rechain(this, _jzz, 'close');\n  }\n  _W.prototype = new _R();\n  function _connectW(arg) {\n    if (_func(arg)) {\n      if (!this._orig._handles.length) _engine._watch();\n      _push(this._orig._handles, arg);\n    }\n  }\n  function _disconnectW(arg) {\n    if (typeof arg == 'undefined') this._orig._handles = [];\n    else _pop(this._orig._handles, arg);\n    if (!this._orig._handles.length) _engine._unwatch();\n  }\n  _W.prototype.connect = function(arg) {\n    this._push(_connectW, [arg]);\n    return this._thenable();\n  };\n  _W.prototype.disconnect = function(arg) {\n    this._push(_disconnectW, [arg]);\n    return this._thenable();\n  };\n  function _changed(x0, y0, x1, y1) {\n    var i;\n    if (x0.length != x1.length || y0.length != y1.length) return true;\n    for (i = 0; i < x0.length; i++) if (x0[i].name != x1[i].name) return true;\n    for (i = 0; i < y0.length; i++) if (y0[i].name != y1[i].name) return true;\n    return false;\n  }\n  function _diff(x0, y0, x1, y1) {\n    if (!_changed(x0, y0, x1, y1)) return;\n    var ax = []; // added\n    var ay = [];\n    var rx = []; // removed\n    var ry = [];\n    var i;\n    var h = {};\n    for (i = 0; i < x0.length; i++) h[x0[i].name] = true;\n    for (i = 0; i < x1.length; i++) if (!h[x1[i].name]) ax.push(x1[i]);\n    h = {};\n    for (i = 0; i < x1.length; i++) h[x1[i].name] = true;\n    for (i = 0; i < x0.length; i++) if (!h[x0[i].name]) rx.push(x0[i]);\n    h = {};\n    for (i = 0; i < y0.length; i++) h[y0[i].name] = true;\n    for (i = 0; i < y1.length; i++) if (!h[y1[i].name]) ay.push(y1[i]);\n    h = {};\n    for (i = 0; i < y1.length; i++) h[y1[i].name] = true;\n    for (i = 0; i < y0.length; i++) if (!h[y0[i].name]) ry.push(y0[i]);\n    return { inputs: { added: ax, removed: rx }, outputs: { added: ay, removed: ry } };\n  }\n  function _fireW(arg) {\n    for (i = 0; i < _jzz._watcher._handles.length; i++) _jzz._watcher._handles[i].apply(_jzz, [arg]);\n  }\n\n  var _jzz;\n  var _engine = { _outs: [], _ins: [] };\n  var _virtual = { _outs: [], _ins: [] };\n\n  // // Node.js\n  // function _tryNODE() {\n  //   if (typeof module != 'undefined' && module.exports) {\n  //     var jazzmidi = require('jazz-midi');\n  //     if (jazzmidi) {\n  //       _initNode(jazzmidi);\n  //       return;\n  //     }\n  //   }\n  //   this._break();\n  // }\n  // Jazz-Plugin\n  function _tryJazzPlugin() {\n    var div = document.createElement('div');\n    div.style.visibility = 'hidden';\n    document.body.appendChild(div);\n    var obj = document.createElement('object');\n    obj.style.visibility = 'hidden';\n    obj.style.width = '0px'; obj.style.height = '0px';\n    obj.classid = 'CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90';\n    obj.type = 'audio/x-jazz';\n    document.body.appendChild(obj);\n    /* istanbul ignore next */\n    if (obj.isJazz) {\n      _initJazzPlugin(obj);\n      return;\n    }\n    this._break();\n  }\n\n  // Web MIDI API\n  var _navigator;\n  var _requestMIDIAccess;\n  function _findMidiAccess() {\n    if (typeof navigator !== 'undefined' && navigator.requestMIDIAccess) {\n      _navigator = navigator;\n      _requestMIDIAccess = navigator.requestMIDIAccess;\n      try {\n        if (_requestMIDIAccess.toString().indexOf('JZZ(') != -1) _requestMIDIAccess = undefined;\n      }\n      catch (err) {}\n    }\n  }\n  function _tryWebMIDI() {\n    _findMidiAccess();\n    if (_requestMIDIAccess) {\n      var self = this;\n      var onGood = function(midi) {\n        _initWebMIDI(midi);\n        self._resume();\n      };\n      var onBad = function(msg) {\n        self._crash(msg);\n      };\n      var opt = {};\n      _requestMIDIAccess.call(_navigator, opt).then(onGood, onBad);\n      this._pause();\n      return;\n    }\n    this._break();\n  }\n  function _tryWebMIDIsysex() {\n    _findMidiAccess();\n    if (_requestMIDIAccess) {\n      var self = this;\n      var onGood = function(midi) {\n        _initWebMIDI(midi, true);\n        self._resume();\n      };\n      var onBad = function(msg) {\n        self._crash(msg);\n      };\n      var opt = { sysex:true };\n      _requestMIDIAccess.call(_navigator, opt).then(onGood, onBad);\n      this._pause();\n      return;\n    }\n    this._break();\n  }\n\n  // Web-extension\n  function _tryCRX() {\n    var self = this;\n    var inst;\n    var msg;\n    function eventHandle(evt) {\n      inst = true;\n      var a = evt.detail;\n      if (!a) {\n        if (!msg) msg = document.getElementById('jazz-midi-msg');\n        if (!msg) return;\n        try { a = JSON.parse(msg.innerText); } catch (err) {}\n        msg.innerText = '';\n      }\n      document.removeEventListener('jazz-midi-msg', eventHandle);\n      if (a[0] === 'version') {\n        _initCRX(msg, a[2]);\n        self._resume();\n      }\n      else {\n        self._crash();\n      }\n    }\n    this._pause();\n    try {\n      document.addEventListener('jazz-midi-msg', eventHandle);\n      document.dispatchEvent(new Event('jazz-midi'));\n    }\n    catch (err) {}\n    setTimeout(function() { if (!inst) self._crash(); }, 50);\n  }\n\n  /* istanbul ignore next */\n  function _zeroBreak() {\n    this._pause();\n    var self = this;\n    _schedule(function() { self._crash(); });\n  }\n\n  function _filterEngines(opt) {\n    var ret = [];\n    var arr = _filterEngineNames(opt);\n    for (var i = 0; i < arr.length; i++) {\n      if (arr[i] == 'webmidi') {\n        if (opt && opt.sysex === true) ret.push(_tryWebMIDIsysex);\n        if (!opt || opt.sysex !== true || opt.degrade === true) ret.push(_tryWebMIDI);\n      }\n      //else if (arr[i] == 'node') { ret.push(_tryNODE); ret.push(_zeroBreak); }\n      else if (arr[i] == 'extension') ret.push(_tryCRX);\n      else if (arr[i] == 'plugin') ret.push(_tryJazzPlugin);\n    }\n    ret.push(_initNONE);\n    return ret;\n  }\n\n  function _filterEngineNames(opt) {\n    var web = ['node', 'extension', 'plugin', 'webmidi'];\n    if (!opt || !opt.engine) return web;\n    var arr = opt.engine instanceof Array ? opt.engine : [opt.engine];\n    var dup = {};\n    var none;\n    var etc;\n    var head = [];\n    var tail = [];\n    var i;\n    for (i = 0; i < arr.length; i++) {\n      var name = arr[i].toString().toLowerCase();\n      if (dup[name]) continue;\n      dup[name] = true;\n      if (name === 'none') none = true;\n      if (name === 'etc' || typeof name == 'undefined') etc = true;\n      if (etc) tail.push(name); else head.push(name);\n      _pop(web, name);\n    }\n    if (etc || head.length || tail.length) none = false;\n    return none ? [] : head.concat(etc ? web : tail);\n  }\n\n  function _initJZZ(opt) {\n    _jzz = new _J();\n    _jzz._options = opt;\n    _jzz._push(_tryAny, [_filterEngines(opt)]);\n    _jzz.refresh();\n    _jzz._resume();\n  }\n\n  function _initNONE() {\n    _engine._type = 'none';\n    _engine._version = _version;\n    _engine._sysex = true;\n    _engine._outs = [];\n    _engine._ins = [];\n    _engine._refresh = function() { _postRefresh(); };\n    _engine._watch = _nop;\n    _engine._unwatch = _nop;\n    _engine._close = _nop;\n  }\n  // common initialization for Jazz-Plugin and jazz-midi\n  function _initEngineJP() {\n    _engine._inArr = [];\n    _engine._outArr = [];\n    _engine._inMap = {};\n    _engine._outMap = {};\n    _engine._outsW = [];\n    _engine._insW = [];\n    _engine._version = _engine._main.version;\n    _engine._sysex = true;\n    var watcher;\n    function _closeAll() {\n      for (var i = 0; i < this.clients.length; i++) this._close(this.clients[i]);\n    }\n    _engine._refresh = function() {\n      _engine._outs = [];\n      _engine._ins = [];\n      var i, x;\n      for (i = 0; (x = _engine._main.MidiOutInfo(i)).length; i++) {\n        _engine._outs.push({ type: _engine._type, name: x[0], manufacturer: x[1], version: x[2] });\n      }\n      for (i = 0; (x = _engine._main.MidiInInfo(i)).length; i++) {\n        _engine._ins.push({ type: _engine._type, name: x[0], manufacturer: x[1], version: x[2] });\n      }\n      _postRefresh();\n    };\n    _engine._openOut = function(port, name) {\n      var impl = _engine._outMap[name];\n      if (!impl) {\n        if (_engine._pool.length <= _engine._outArr.length) _engine._pool.push(_engine._newPlugin());\n        impl = {\n          name: name,\n          clients: [],\n          info: {\n            name: name,\n            manufacturer: _engine._allOuts[name].manufacturer,\n            version: _engine._allOuts[name].version,\n            type: 'MIDI-out',\n            sysex: _engine._sysex,\n            engine: _engine._type\n          },\n          _close: function(port) { _engine._closeOut(port); },\n          _closeAll: _closeAll,\n          _receive: function(a) { if (a.length) this.plugin.MidiOutRaw(a.slice()); }\n        };\n        var plugin = _engine._pool[_engine._outArr.length];\n        impl.plugin = plugin;\n        _engine._outArr.push(impl);\n        _engine._outMap[name] = impl;\n      }\n      if (!impl.open) {\n        var s = impl.plugin.MidiOutOpen(name);\n        if (s !== name) {\n          if (s) impl.plugin.MidiOutClose();\n          port._break(); return;\n        }\n        impl.open = true;\n      }\n      port._orig._impl = impl;\n      _push(impl.clients, port._orig);\n      port._info = impl.info;\n      port._receive = function(arg) { impl._receive(arg); };\n      port._close = function() { impl._close(this); };\n    };\n    _engine._openIn = function(port, name) {\n      var impl = _engine._inMap[name];\n      if (!impl) {\n        if (_engine._pool.length <= _engine._inArr.length) _engine._pool.push(_engine._newPlugin());\n        impl = {\n          name: name,\n          clients: [],\n          info: {\n            name: name,\n            manufacturer: _engine._allIns[name].manufacturer,\n            version: _engine._allIns[name].version,\n            type: 'MIDI-in',\n            sysex: _engine._sysex,\n            engine: _engine._type\n          },\n          _close: function(port) { _engine._closeIn(port); },\n          _closeAll: _closeAll,\n          handle: function(t, a) {\n            for (var i = 0; i < this.clients.length; i++) {\n              var msg = MIDI(a);\n              this.clients[i]._emit(msg);\n            }\n          }\n        };\n        var makeHandle = function(x) { return function(t, a) { x.handle(t, a); }; };\n        impl.onmidi = makeHandle(impl);\n        var plugin = _engine._pool[_engine._inArr.length];\n        impl.plugin = plugin;\n        _engine._inArr.push(impl);\n        _engine._inMap[name] = impl;\n      }\n      if (!impl.open) {\n        var s = impl.plugin.MidiInOpen(name, impl.onmidi);\n        if (s !== name) {\n          if (s) impl.plugin.MidiInClose();\n          port._break(); return;\n        }\n        impl.open = true;\n      }\n      port._orig._impl = impl;\n      _push(impl.clients, port._orig);\n      port._info = impl.info;\n      port._close = function() { impl._close(this); };\n    };\n    _engine._closeOut = function(port) {\n      var impl = port._impl;\n      _pop(impl.clients, port._orig);\n      if (!impl.clients.length && impl.open) {\n        impl.open = false;\n        impl.plugin.MidiOutClose();\n      }\n    };\n    _engine._closeIn = function(port) {\n      var impl = port._impl;\n      _pop(impl.clients, port._orig);\n      if (!impl.clients.length && impl.open) {\n        impl.open = false;\n        impl.plugin.MidiInClose();\n      }\n    };\n    _engine._close = function() {\n      for (var i = 0; i < _engine._inArr.length; i++) if (_engine._inArr[i].open) _engine._inArr[i].plugin.MidiInClose();\n      _engine._unwatch();\n    };\n    _engine._watch = function() {\n      if (!watcher) watcher = setInterval(function() { _engine._refresh(); }, 250);\n    };\n    _engine._unwatch = function() {\n      if (watcher) clearInterval(watcher);\n      watcher = undefined;\n    };\n  }\n\n  function _initNode(obj) {\n    _engine._type = 'node';\n    _engine._main = obj;\n    _engine._pool = [];\n    _engine._newPlugin = function() { return new obj.MIDI(); };\n    _initEngineJP();\n  }\n  /* istanbul ignore next */\n  function _initJazzPlugin(obj) {\n    _engine._type = 'plugin';\n    _engine._main = obj;\n    _engine._pool = [obj];\n    _engine._newPlugin = function() {\n      var plg = document.createElement('object');\n      plg.style.visibility = 'hidden';\n      plg.style.width = '0px'; obj.style.height = '0px';\n      plg.classid = 'CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90';\n      plg.type = 'audio/x-jazz';\n      document.body.appendChild(plg);\n      return plg.isJazz ? plg : undefined;\n    };\n    _initEngineJP();\n  }\n  function _initWebMIDI(access, sysex) {\n    _engine._type = 'webmidi';\n    _engine._version = 43;\n    _engine._sysex = !!sysex;\n    _engine._access = access;\n    _engine._inMap = {};\n    _engine._outMap = {};\n    _engine._outsW = [];\n    _engine._insW = [];\n    var watcher;\n    function _closeAll() {\n      for (var i = 0; i < this.clients.length; i++) this._close(this.clients[i]);\n    }\n    _engine._refresh = function() {\n      _engine._outs = [];\n      _engine._ins = [];\n      _engine._access.outputs.forEach(function(port) {\n        _engine._outs.push({type: _engine._type, name: port.name, manufacturer: port.manufacturer, version: port.version});\n      });\n      _engine._access.inputs.forEach(function(port) {\n        _engine._ins.push({type: _engine._type, name: port.name, manufacturer: port.manufacturer, version: port.version});\n      });\n      _postRefresh();\n    };\n    _engine._openOut = function(port, name) {\n      var impl = _engine._outMap[name];\n      if (!impl) {\n        impl = {\n          name: name,\n          clients: [],\n          info: {\n            name: name,\n            manufacturer: _engine._allOuts[name].manufacturer,\n            version: _engine._allOuts[name].version,\n            type: 'MIDI-out',\n            sysex: _engine._sysex,\n            engine: _engine._type\n          },\n          _close: function(port) { _engine._closeOut(port); },\n          _closeAll: _closeAll,\n          _receive: function(a) { if (impl.dev && a.length) this.dev.send(a.slice()); }\n        };\n      }\n      var found;\n      _engine._access.outputs.forEach(function(dev) {\n        if (dev.name === name) found = dev;\n      });\n      if (found) {\n        impl.dev = found;\n        _engine._outMap[name] = impl;\n        port._orig._impl = impl;\n        _push(impl.clients, port._orig);\n        port._info = impl.info;\n        port._receive = function(arg) { impl._receive(arg); };\n        port._close = function() { impl._close(this); };\n        if (impl.dev.open) {\n          port._pause();\n          impl.dev.open().then(function() {\n            port._resume();\n          }, function() {\n            port._crash();\n          });\n        }\n      }\n      else port._break();\n    };\n    _engine._openIn = function(port, name) {\n      var impl = _engine._inMap[name];\n      if (!impl) {\n        impl = {\n          name: name,\n          clients: [],\n          info: {\n            name: name,\n            manufacturer: _engine._allIns[name].manufacturer,\n            version: _engine._allIns[name].version,\n            type: 'MIDI-in',\n            sysex: _engine._sysex,\n            engine: _engine._type\n          },\n          _close: function(port) { _engine._closeIn(port); },\n          _closeAll: _closeAll,\n          handle: function(evt) {\n            for (var i = 0; i < this.clients.length; i++) {\n              var msg = MIDI([].slice.call(evt.data));\n              this.clients[i]._emit(msg);\n            }\n          }\n        };\n      }\n      var found;\n      _engine._access.inputs.forEach(function(dev) {\n        if (dev.name === name) found = dev;\n      });\n      if (found) {\n        impl.dev = found;\n        var makeHandle = function(x) { return function(evt) { x.handle(evt); }; };\n        impl.dev.onmidimessage = makeHandle(impl);\n        _engine._inMap[name] = impl;\n        port._orig._impl = impl;\n        _push(impl.clients, port._orig);\n        port._info = impl.info;\n        port._close = function() { impl._close(this); };\n        if (impl.dev.open) {\n          port._pause();\n          impl.dev.open().then(function() {\n            port._resume();\n          }, function() {\n            port._crash();\n          });\n        }\n      }\n      else port._break();\n    };\n    _engine._closeOut = function(port) {\n      var impl = port._impl;\n      _pop(impl.clients, port._orig);\n      if (!impl.clients.length) {\n        if (impl.dev && impl.dev.close) impl.dev.close();\n        impl.dev = undefined;\n      }\n    };\n    _engine._closeIn = function(port) {\n      var impl = port._impl;\n      _pop(impl.clients, port._orig);\n      if (!impl.clients.length) {\n        if (impl.dev) {\n          impl.dev.onmidimessage = null;\n          if (impl.dev.close) impl.dev.close();\n        }\n        impl.dev = undefined;\n      }\n    };\n    _engine._close = function() {\n      _engine._unwatch();\n    };\n    _engine._watch = function() {\n      _engine._access.onstatechange = function() {\n        watcher = true;\n        _schedule(function() {\n          if (watcher) {\n            _engine._refresh();\n            watcher = false;\n          }\n        });\n      };\n    };\n    _engine._unwatch = function() {\n      _engine._access.onstatechange = undefined;\n    };\n  }\n  function _initCRX(msg, ver) {\n    _engine._type = 'extension';\n    _engine._version = ver;\n    _engine._sysex = true;\n    _engine._pool = [];\n    _engine._outs = [];\n    _engine._ins = [];\n    _engine._inArr = [];\n    _engine._outArr = [];\n    _engine._inMap = {};\n    _engine._outMap = {};\n    _engine._outsW = [];\n    _engine._insW = [];\n    _engine.refreshClients = [];\n    _engine._msg = msg;\n    _engine._newPlugin = function() {\n      var plugin = { id: _engine._pool.length };\n      _engine._pool.push(plugin);\n      if (!plugin.id) plugin.ready = true;\n      else document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['new'] }));\n    };\n    _engine._newPlugin();\n    _engine._refresh = function(client) {\n      _engine.refreshClients.push(client);\n      client._pause();\n      _schedule(function() {\n        document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['refresh'] }));\n      });\n    };\n    function _closeAll() {\n      for (var i = 0; i < this.clients.length; i++) this._close(this.clients[i]);\n    }\n    _engine._openOut = function(port, name) {\n      var impl = _engine._outMap[name];\n      if (!impl) {\n        if (_engine._pool.length <= _engine._outArr.length) _engine._newPlugin();\n        var plugin = _engine._pool[_engine._outArr.length];\n        impl = {\n          name: name,\n          clients: [],\n          info: {\n            name: name,\n            manufacturer: _engine._allOuts[name].manufacturer,\n            version: _engine._allOuts[name].version,\n            type: 'MIDI-out',\n            sysex: _engine._sysex,\n            engine: _engine._type\n          },\n          _start: function() { document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['openout', plugin.id, name] })); },\n          _close: function(port) { _engine._closeOut(port); },\n          _closeAll: _closeAll,\n          _receive: function(a) { if (a.length) { var v = a.slice(); v.splice(0, 0, 'play', plugin.id); document.dispatchEvent(new CustomEvent('jazz-midi', {detail: v})); } }\n        };\n        impl.plugin = plugin;\n        plugin.output = impl;\n        _engine._outArr.push(impl);\n        _engine._outMap[name] = impl;\n      }\n      port._orig._impl = impl;\n      _push(impl.clients, port._orig);\n      port._info = impl.info;\n      port._receive = function(arg) { impl._receive(arg); };\n      port._close = function() { impl._close(this); };\n      if (!impl.open) {\n        port._pause();\n        if (impl.plugin.ready) impl._start();\n      }\n    };\n    _engine._openIn = function(port, name) {\n      var impl = _engine._inMap[name];\n      if (!impl) {\n        if (_engine._pool.length <= _engine._inArr.length) _engine._newPlugin();\n        var plugin = _engine._pool[_engine._inArr.length];\n        impl = {\n          name: name,\n          clients: [],\n          info: {\n            name: name,\n            manufacturer: _engine._allIns[name].manufacturer,\n            version: _engine._allIns[name].version,\n            type: 'MIDI-in',\n            sysex: _engine._sysex,\n            engine: _engine._type\n          },\n          _start: function() { document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['openin', plugin.id, name] })); },\n          _close: function(port) { _engine._closeIn(port); },\n          _closeAll: _closeAll\n        };\n        impl.plugin = plugin;\n        plugin.input = impl;\n        _engine._inArr.push(impl);\n        _engine._inMap[name] = impl;\n      }\n      port._orig._impl = impl;\n      _push(impl.clients, port._orig);\n      port._info = impl.info;\n      port._close = function() { impl._close(this); };\n      if (!impl.open) {\n        port._pause();\n        if (impl.plugin.ready) impl._start();\n      }\n    };\n    _engine._closeOut = function(port) {\n      var impl = port._impl;\n      _pop(impl.clients, port._orig);\n      if (!impl.clients.length && impl.open) {\n        impl.open = false;\n        document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['closeout', impl.plugin.id] }));\n      }\n    };\n    _engine._closeIn = function(port) {\n      var impl = port._impl;\n      _pop(impl.clients, port._orig);\n      if (!impl.clients.length && impl.open) {\n        impl.open = false;\n        document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['closein', impl.plugin.id] }));\n      }\n    };\n    _engine._close = function() {\n      _engine._unwatch();\n    };\n    var watcher;\n    _engine._watch = function() {\n      _engine._insW = _engine._ins;\n      _engine._outsW = _engine._outs;\n      watcher = setInterval(function() {\n        document.dispatchEvent(new CustomEvent('jazz-midi', {detail:['refresh']}));\n      }, 250);\n    };\n    _engine._unwatch = function() {\n      clearInterval(watcher);\n      watcher = undefined;\n    };\n    document.addEventListener('jazz-midi-msg', function(evt) {\n      var i, j, impl;\n      var v = evt.detail ? [ evt.detail ] : undefined;\n      if (!v) {\n        v = _engine._msg.innerText.split('\\n');\n        _engine._msg.innerText = '';\n        for (i = 0; i < v.length; i++) try { v[i] = JSON.parse(v[i]); } catch (err) { v[i] = []; }\n      }\n      for (i = 0; i < v.length; i++) {\n        var a = v[i];\n        if (!a.length) continue;\n        if (a[0] === 'refresh') {\n          if (a[1].ins) {\n            for (j = 0; j < a[1].ins.length; j++) a[1].ins[j].type = _engine._type;\n            _engine._ins = a[1].ins;\n          }\n          if (a[1].outs) {\n            for (j = 0; j < a[1].outs.length; j++) a[1].outs[j].type = _engine._type;\n            _engine._outs = a[1].outs;\n          }\n          _postRefresh();\n          for (j = 0; j < _engine.refreshClients.length; j++) _engine.refreshClients[j]._resume();\n          _engine.refreshClients = [];\n        }\n        else if (a[0] === 'version') {\n          var plugin = _engine._pool[a[1]];\n          if (plugin) {\n            plugin.ready = true;\n            if (plugin.input) plugin.input._start();\n            if (plugin.output) plugin.output._start();\n          }\n        }\n        else if (a[0] === 'openout') {\n          impl = _engine._pool[a[1]].output;\n          if (impl) {\n            if (a[2] == impl.name) {\n              impl.open = true;\n              if (impl.clients) for (j = 0; j < impl.clients.length; j++) impl.clients[j]._resume();\n            }\n            else if (impl.clients) for (j = 0; j < impl.clients.length; j++) impl.clients[j]._crash();\n          }\n        }\n        else if (a[0] === 'openin') {\n          impl = _engine._pool[a[1]].input;\n          if (impl) {\n            if (a[2] == impl.name) {\n              impl.open = true;\n              if (impl.clients) for (j = 0; j < impl.clients.length; j++) impl.clients[j]._resume();\n            }\n            else if (impl.clients) for (j = 0; j < impl.clients.length; j++) impl.clients[j]._crash();\n          }\n        }\n        else if (a[0] === 'midi') {\n          impl = _engine._pool[a[1]].input;\n          if (impl && impl.clients) {\n            for (j = 0; j < impl.clients.length; j++) {\n              var msg = MIDI(a.slice(3));\n              impl.clients[j]._emit(msg);\n            }\n          }\n        }\n      }\n    });\n  }\n\n  var JZZ = function(opt) {\n    if (!_jzz) _initJZZ(opt);\n    return _jzz._thenable();\n  };\n  JZZ.JZZ = JZZ;\n  JZZ.version = _version;\n  JZZ.info = function() { return _J.prototype.info(); };\n\n  function Widget(arg) {\n    var self = new _M();\n    if (arg instanceof Object) _for(arg, function(k) { self[k] = arg[k]; });\n    self._resume();\n    return self;\n  }\n  JZZ.Widget = Widget;\n  _J.prototype.Widget = JZZ.Widget;\n  JZZ.addMidiIn = function(name, widget) {\n    var info = _clone(widget._info || {});\n    info.name = name;\n    info.type = info.type || 'javascript';\n    info.manufacturer = info.manufacturer || 'virtual';\n    info.version = info.version || '0.0';\n    var engine = {\n      _info: function() { return info; },\n      _openIn: function(port) {\n        port._pause();\n        port._info = _clone(info);\n        port._close = function() { widget.disconnect(port); };\n        widget.connect(port);\n        port._resume();\n      }\n    };\n    return JZZ.lib.registerMidiIn(name, engine);\n  };\n  JZZ.addMidiOut = function(name, widget) {\n    var info = _clone(widget._info || {});\n    info.name = name;\n    info.type = info.type || 'javascript';\n    info.manufacturer = info.manufacturer || 'virtual';\n    info.version = info.version || '0.0';\n    var engine = {\n      _info: function() { return info; },\n      _openOut: function(port) {\n        port._pause();\n        port._info = _clone(info);\n        port._close = function() { port.disconnect(); };\n        _connect.apply(port, [widget]);\n        port._resume();\n      }\n    };\n    return JZZ.lib.registerMidiOut(name, engine);\n  };\n\n  // JZZ.SMPTE\n\n  function SMPTE() {\n    var self = this instanceof SMPTE ? this : self = new SMPTE();\n    SMPTE.prototype.reset.apply(self, arguments);\n    return self;\n  }\n  SMPTE.prototype.reset = function(arg) {\n    if (arg instanceof SMPTE) {\n      this.setType(arg.getType());\n      this.setHour(arg.getHour());\n      this.setMinute(arg.getMinute());\n      this.setSecond(arg.getSecond());\n      this.setFrame(arg.getFrame());\n      this.setQuarter(arg.getQuarter());\n      return this;\n    }\n    var arr = arg instanceof Array ? arg : arguments;\n    this.setType(arr[0]);\n    this.setHour(arr[1]);\n    this.setMinute(arr[2]);\n    this.setSecond(arr[3]);\n    this.setFrame(arr[4]);\n    this.setQuarter(arr[5]);\n    return this;\n  };\n  function _fixDropFrame() { if (this.type == 29.97 && !this.second && this.frame < 2 && this.minute % 10) this.frame = 2; }\n  SMPTE.prototype.isFullFrame = function() { return this.quarter == 0 || this.quarter == 4; };\n  SMPTE.prototype.getType = function() { return this.type; };\n  SMPTE.prototype.getHour = function() { return this.hour; };\n  SMPTE.prototype.getMinute = function() { return this.minute; };\n  SMPTE.prototype.getSecond = function() { return this.second; };\n  SMPTE.prototype.getFrame = function() { return this.frame; };\n  SMPTE.prototype.getQuarter = function() { return this.quarter; };\n  SMPTE.prototype.setType = function(x) {\n    if (typeof x == 'undefined' || x == 24) this.type = 24;\n    else if (x == 25) this.type = 25;\n    else if (x == 29.97) { this.type = 29.97; _fixDropFrame.apply(this); }\n    else if (x == 30) this.type = 30;\n    else throw RangeError('Bad SMPTE frame rate: ' + x);\n    if (this.frame >= this.type) this.frame = this.type - 1; // could not be more than 29\n    return this;\n  };\n  SMPTE.prototype.setHour = function(x) {\n    if (typeof x == 'undefined') x = 0;\n    if (x != parseInt(x) || x < 0 || x >= 24) throw RangeError('Bad SMPTE hours value: ' + x);\n    this.hour = x;\n    return this;\n  };\n  SMPTE.prototype.setMinute = function(x) {\n    if (typeof x == 'undefined') x = 0;\n    if (x != parseInt(x) || x < 0 || x >= 60) throw RangeError('Bad SMPTE minutes value: ' + x);\n    this.minute = x;\n    _fixDropFrame.apply(this);\n    return this;\n  };\n  SMPTE.prototype.setSecond = function(x) {\n    if (typeof x == 'undefined') x = 0;\n    if (x != parseInt(x) || x < 0 || x >= 60) throw RangeError('Bad SMPTE seconds value: ' + x);\n    this.second = x;\n    _fixDropFrame.apply(this);\n    return this;\n  };\n  SMPTE.prototype.setFrame = function(x) {\n    if (typeof x == 'undefined') x = 0;\n    if (x != parseInt(x) || x < 0 || x >= this.type) throw RangeError('Bad SMPTE frame number: ' + x);\n    this.frame = x;\n    _fixDropFrame.apply(this);\n    return this;\n  };\n  SMPTE.prototype.setQuarter = function(x) {\n    if (typeof x == 'undefined') x = 0;\n    if (x != parseInt(x) || x < 0 || x >= 8) throw RangeError('Bad SMPTE quarter frame: ' + x);\n    this.quarter = x;\n    return this;\n  };\n  SMPTE.prototype.incrFrame = function() {\n    this.frame++;\n    if (this.frame >= this.type) {\n      this.frame = 0;\n      this.second++;\n      if (this.second >= 60) {\n        this.second = 0;\n        this.minute++;\n        if (this.minute >= 60) {\n          this.minute = 0;\n          this.hour = this.hour >= 23 ? 0 : this.hour + 1;\n        }\n      }\n    }\n    _fixDropFrame.apply(this);\n    return this;\n  };\n  SMPTE.prototype.decrFrame = function() {\n    if (!this.second && this.frame == 2 && this.type == 29.97 && this.minute % 10) this.frame = 0; // drop-frame\n    this.frame--;\n    if (this.frame < 0) {\n      this.frame = this.type == 29.97 ? 29 : this.type - 1;\n      this.second--;\n      if (this.second < 0) {\n        this.second = 59;\n        this.minute--;\n        if (this.minute < 0) {\n          this.minute = 59;\n          this.hour = this.hour ? this.hour - 1 : 23;\n        }\n      }\n    }\n    return this;\n  };\n  SMPTE.prototype.incrQF = function() {\n    this.backwards = false;\n    this.quarter = (this.quarter + 1) & 7;\n    if (this.quarter == 0 || this.quarter == 4) this.incrFrame();\n    return this;\n  };\n  SMPTE.prototype.decrQF = function() {\n    this.backwards = true;\n    this.quarter = (this.quarter + 7) & 7;\n    if (this.quarter == 3 || this.quarter == 7) this.decrFrame();\n    return this;\n  };\n  function _825(a) { return [[24, 25, 29.97, 30][(a[7] >> 1) & 3], ((a[7] & 1) << 4) | a[6], (a[5] << 4) | a[4], (a[3] << 4) | a[2], (a[1] << 4) | a[0]]; }\n  SMPTE.prototype.read = function(m) {\n    if (!(m instanceof MIDI)) m = MIDI.apply(null, arguments);\n    if (m[0] == 0xf0 && m[1] == 0x7f && m[3] == 1 && m[4] == 1 && m[9] == 0xf7) {\n      this.type = [24, 25, 29.97, 30][(m[5] >> 5) & 3];\n      this.hour = m[5] & 31;\n      this.minute = m[6];\n      this.second = m[7];\n      this.frame = m[8];\n      this.quarter = 0;\n      this._ = undefined;\n      this._b = undefined;\n      this._f = undefined;\n      return true;\n    }\n    if (m[0] == 0xf1 && typeof m[1] != 'undefined') {\n      var q = m[1] >> 4;\n      var n = m[1] & 15;\n      if (q == 0) {\n        if (this._ == 7) {\n          if (this._f == 7) {\n            this.reset(_825(this._a));\n            this.incrFrame();\n          }\n          this.incrFrame();\n        }\n      }\n      else if (q == 3) {\n        if (this._ == 4) {\n          this.decrFrame();\n        }\n      }\n      else if (q == 4) {\n        if (this._ == 3) {\n          this.incrFrame();\n        }\n      }\n      else if (q == 7) {\n        if (this._ === 0) {\n          if (this._b === 0) {\n            this.reset(_825(this._a));\n            this.decrFrame();\n          }\n          this.decrFrame();\n        }\n      }\n      if (!this._a) this._a = [];\n      this._a[q] = n;\n      this._f = this._f === q - 1 || q == 0 ? q : undefined;\n      this._b = this._b === q + 1 || q == 7 ? q : undefined;\n      this._ = q;\n      this.quarter = q;\n      return true;\n    }\n    return false;\n  };\n  function _mtc(t) {\n    if (!t.backwards && t.quarter >= 4) t.decrFrame(); // continue encoding previous frame\n    else if (t.backwards && t.quarter < 4) t.incrFrame();\n    var ret;\n    switch (t.quarter >> 1) {\n      case 0: ret = t.frame; break;\n      case 1: ret = t.second; break;\n      case 2: ret = t.minute; break;\n      default: ret = t.hour;\n    }\n    if (t.quarter & 1) ret >>= 4;\n    else ret &= 15;\n    if (t.quarter == 7) {\n      if (t.type == 25) ret |= 2;\n      else if (t.type == 29.97) ret |= 4;\n      else if (t.type == 30) ret |= 6;\n    }\n    // restore original t\n    if (!t.backwards && t.quarter >= 4) t.incrFrame();\n    else if (t.backwards && t.quarter < 4) t.decrFrame();\n    return ret | (t.quarter << 4);\n  }\n  function _hrtype(t) {\n    if (t.type == 25) return t.hour | 0x20;\n    if (t.type == 29.97) return t.hour | 0x40;\n    if (t.type == 30) return t.hour | 0x60;\n    return t.hour;\n  }\n  function _dec(x) { return x < 10 ? '0' + x : x; }\n  function _smptetxt(x) {\n    var arr = [];\n    for (var i = 0; i < x.length; i++) arr[i] = _dec(i ? x[i] : x[i] & 0x1f);\n    return arr.join(':');\n  }\n  SMPTE.prototype.toString = function() { return _smptetxt([this.hour, this.minute, this.second, this.frame]); };\n  JZZ.SMPTE = SMPTE;\n  _J.prototype.SMPTE = SMPTE;\n\n  // JZZ.MIDI\n\n  function MIDI(arg) {\n    var self = this instanceof MIDI ? this : self = new MIDI();\n    var i;\n    if (arg instanceof MIDI) {\n      self._from = arg._from.slice();\n      _for(arg, function(i) { if (i != '_from') self[i] = arg[i]; });\n      return self;\n    }\n    else self._from = [];\n    if (typeof arg == 'undefined') return self;\n    var arr = arg instanceof Array ? arg : arguments;\n    for (i = 0; i < arr.length; i++) {\n      n = arr[i];\n      if (i == 1) {\n        if (self[0] >= 0x80 && self[0] <= 0xAF) n = MIDI.noteValue(n);\n        if (self[0] >= 0xC0 && self[0] <= 0xCF) n = MIDI.programValue(n);\n      }\n      if (n != parseInt(n) || n < 0 || n > 255) _throw(arr[i]);\n      self.push(n);\n    }\n    return self;\n  }\n  MIDI.prototype = [];\n  MIDI.prototype.constructor = MIDI;\n  var _noteNum = {};\n  MIDI.noteValue = function(x) { return typeof x == 'undefined' ? undefined : _noteNum[x.toString().toLowerCase()]; };\n  MIDI.programValue = function(x) { return x; };\n  MIDI.octaveValue = function(x) {\n    var n = _noteNum[x.toString().toLowerCase()];\n    if (typeof n == 'undefined') n = _noteNum[x.toString().toLowerCase() + '1'];\n    return typeof n == 'undefined' ? undefined : n % 12;\n  };\n  MIDI.freq = function(n, a) {\n    if (typeof a == 'undefined') a = 440.0;\n    _float(a);\n    if (n != parseFloat(n)) n = _7bn(n);\n    return (a * Math.pow(2, (n - 69.0) / 12.0));\n  };\n  function _float(x) { if (x != parseFloat(x)) throw TypeError('Not a number: ' + x); }\n  MIDI.shift = function(f, f0) {\n    if (typeof f0 == 'undefined') f0 = 440;\n    _float(f);\n    _float(f0);\n    return Math.log2(f / f0) * 12;\n  };\n  MIDI.midi = function(f, f0) {\n    if (f != parseFloat(f)) return _7bn(f);\n    return MIDI.shift(f, f0) + 69;\n  };\n  MIDI.to7b = function(x) {\n    _float(x);\n    return x <= 0 ? 0 : x >= 1 ? 0x7f : Math.floor(x * 0x80);\n  };\n  MIDI.to14b = function(x) {\n    _float(x);\n    return x <= 0 ? 0 : x >= 1 ? 0x3fff : Math.floor(x * 0x4000);\n  };\n  MIDI.to21b = function(x) {\n    if (typeof x == 'undefined') return 0x1fffff;\n    _float(x);\n    if (x <= 0) return 0;\n    x = (Math.floor(x) << 14) + MIDI.to14b(x - Math.floor(x));\n    return x < 0x1fffff ? x : 0x1ffffe;\n  };\n  function _MIDI() {}\n  _MIDI.prototype = MIDI;\n  MIDI._sxid = 0x7f;\n  MIDI.sxId = function(id) {\n    if (typeof id == 'undefined') id = MIDI._sxid;\n    if (id == this._sxid) return this;\n    id = _7b(id);\n    var ret = new _MIDI();\n    ret._ch = this._ch;\n    ret._sxid = id;\n    return ret;\n  };\n  MIDI.ch = function(c) {\n    if (c == this._ch || typeof c == 'undefined' && typeof this._ch == 'undefined') return this;\n    var ret = new _MIDI();\n    if (typeof c != 'undefined') c = _ch(c);\n    ret._ch = c;\n    ret._sxid = this._sxid;\n    return ret;\n  };\n\n  var _noteMap = { c:0, d:2, e:4, f:5, g:7, a:9, b:11, h:11 };\n  _for(_noteMap, function(k) {\n    for (n = 0; n < 12; n++) {\n      m = _noteMap[k] + n * 12;\n      if (m > 127) break;\n      _noteNum[k + n] = m; _noteNum[k + '♮' + n] = m;\n      if (m > 0) {\n        _noteNum[k + 'b' + n] = m - 1; _noteNum[k + '♭' + n] = m - 1;\n        _noteNum[k + 'bb' + n] = m - 2; _noteNum[k + '♭♭' + n] = m - 2; _noteNum[k + '𝄫' + n] = m - 2;\n      }\n      if (m < 127) {\n        _noteNum[k + '#' + n] = m + 1; _noteNum[k + '♯' + n] = m + 1;\n        _noteNum[k + '##' + n] = m + 2; _noteNum[k + '♯♯' + n] = m + 2; _noteNum[k + '𝄪' + n] = m + 2;\n      }\n    }\n  });\n  for (n = 0; n < 128; n++) _noteNum[n] = n;\n  function _throw(x) { throw RangeError('Bad MIDI value: ' + x); }\n  function _bad(x) { throw TypeError('Invalid value: ' + x); }\n  function _oor(x) { throw RangeError('Out of range: ' + x); }\n  function _ch(c) { _validateChannel(c); return parseInt(c); }\n  function _7b(n, m) { if (n != parseInt(n) || n < 0 || n > 0x7f) _throw(typeof m == 'undefined' ? n : m); return parseInt(n); }\n  function _8b(n) { if (n != parseInt(n) || n < 0 || n > 0xff) _throw(n); return parseInt(n); }\n  function _14b(n) { if (n != parseInt(n) || n < 0 || n > 0x3fff) _throw(n); return parseInt(n); }\n  function _16b(n) { if (n != parseInt(n) || n < 0 || n > 0xffff) throw RangeError('Expected a 16-bit value: ' + n); return parseInt(n); }\n  function _21b(n) { if (n != parseInt(n) || n < 0 || n > 0x1fffff) _throw(n); return parseInt(n); }\n  function _7bn(n) { return _7b(MIDI.noteValue(n), n); }\n  function _lsb(n) { return _14b(n) & 0x7f; }\n  function _msb(n) { return _14b(n) >> 7; }\n  function _8bs(s) { s = '' + s; for (var i = 0; i < s.length; i++) if (s.charCodeAt(i) > 255) _throw(s[i]); return s; }\n  function _to777(n) { return [n >> 14, (n >> 7) & 0x7f, n & 0x7f]; }\n  function _01(x, y) {\n    if (x != parseFloat(x)) _bad(typeof y == 'undefined' ? x : y);\n    if (x < 0 || x > 1) _oor(typeof y == 'undefined' ? x : y);\n    return parseFloat(x);\n }\n  function _rt(b) { return typeof b != 'undefined' && !b ? 0x7E : 0x7F; }\n  function _ntu(x) {\n    var k, m;\n    var kkk = [];\n    var vvv = {};\n    _for(x, function(k) {\n      m = _21b(x[k]);\n      k = _7bn(k);\n      if (k in vvv) throw RangeError('Duplicate MIDI value: ' + k);\n      kkk.push(k);\n      vvv[k] = m;\n    });\n    kkk.sort();\n    var out = [kkk.length];\n    for (k = 0; k < kkk.length; k++) out = out.concat([kkk[k]], _to777(vvv[kkk[k]]));\n    return out;\n  }\n  function _f2ntu(x) {\n    var out = {};\n    _for (x, function(k) { out[k] = MIDI.to21b(x[k] == parseFloat(x[k]) ? x[k] : _7bn(x[k])); });\n    return out;\n  }\n  function _hz2ntu(x) {\n    var out = {};\n    _for (x, function(k) { out[k] = MIDI.to21b(MIDI.midi(x[k])); });\n    return out;\n  }\n  function _12x7(a) {\n    var out = [];\n    if (!(a instanceof Array) || a.length != 12) throw TypeError('Expected an array of size 12');\n    for (var i = 0; i < 12; i++) out.push(_7b(a[i]));\n    return out;\n  }\n  function _12x14(a) {\n    var out = [];\n    if (!(a instanceof Array) || a.length != 12) throw TypeError('Expected an array of size 12');\n    for (var i = 0; i < 12; i++) {\n      out.push(_msb(a[i]));\n      out.push(_lsb(a[i]));\n    }\n    return out;\n  }\n  var _helperMPE = {\n    noteOff: function(c, n, v) { if (typeof v == 'undefined') v = 64; return [0x80 + _ch(c), _7bn(n), _7b(v)]; },\n    noteOn: function(c, n, v) { if (typeof v == 'undefined') v = 127; return [0x90 + _ch(c), _7bn(n), _7b(v)]; },\n    aftertouch: function(c, n, v) { return [0xA0 + _ch(c), _7bn(n), _7b(v)]; },\n  };\n  var _helperCH = {\n    control: function(c, n, v) { return [0xB0 + _ch(c), _7b(n), _7b(v)]; },\n    program: function(c, n) { return [0xC0 + _ch(c), _7b(MIDI.programValue(n), n)]; },\n    pressure: function(c, n) { return [0xD0 + _ch(c), _7b(n)]; },\n    pitchBend: function(c, n, l) { return typeof l == 'undefined' ? [0xE0 + _ch(c), _lsb(n), _msb(n)] : [0xE0 + _ch(c), _7b(l), _7b(n)]; },\n    pitchBendF: function(c, x) { return _helperCH.pitchBend(c, MIDI.to14b((x + 1) / 2)); },\n    bankMSB: function(c, n) { return [0xB0 + _ch(c), 0x00, _7b(n)]; },\n    bankLSB: function(c, n) { return [0xB0 + _ch(c), 0x20, _7b(n)]; },\n    modMSB: function(c, n) { return [0xB0 + _ch(c), 0x01, _7b(n)]; },\n    modLSB: function(c, n) { return [0xB0 + _ch(c), 0x21, _7b(n)]; },\n    breathMSB: function(c, n) { return [0xB0 + _ch(c), 0x02, _7b(n)]; },\n    breathLSB: function(c, n) { return [0xB0 + _ch(c), 0x22, _7b(n)]; },\n    footMSB: function(c, n) { return [0xB0 + _ch(c), 0x04, _7b(n)]; },\n    footLSB: function(c, n) { return [0xB0 + _ch(c), 0x24, _7b(n)]; },\n    portamentoMSB: function(c, n) { return [0xB0 + _ch(c), 0x05, _7b(n)]; },\n    portamentoLSB: function(c, n) { return [0xB0 + _ch(c), 0x25, _7b(n)]; },\n    dataMSB: function(c, n) { return [0xB0 + _ch(c), 0x06, _7b(n)]; },\n    dataLSB: function(c, n) { return [0xB0 + _ch(c), 0x26, _7b(n)]; },\n    volumeMSB: function(c, n) { return [0xB0 + _ch(c), 0x07, _7b(n)]; },\n    volumeLSB: function(c, n) { return [0xB0 + _ch(c), 0x27, _7b(n)]; },\n    balanceMSB: function(c, n) { return [0xB0 + _ch(c), 0x08, _7b(n)]; },\n    balanceLSB: function(c, n) { return [0xB0 + _ch(c), 0x28, _7b(n)]; },\n    panMSB: function(c, n) { return [0xB0 + _ch(c), 0x0A, _7b(n)]; },\n    panLSB: function(c, n) { return [0xB0 + _ch(c), 0x2A, _7b(n)]; },\n    expressionMSB: function(c, n) { return [0xB0 + _ch(c), 0x0B, _7b(n)]; },\n    expressionLSB: function(c, n) { return [0xB0 + _ch(c), 0x2B, _7b(n)]; },\n    damper: function(c, b) { if (typeof b == 'undefined') b = true; return [0xB0 + _ch(c), 0x40, b ? 127 : 0]; },\n    portamento: function(c, b) { if (typeof b == 'undefined') b = true; return [0xB0 + _ch(c), 0x41, b ? 127 : 0]; },\n    sostenuto: function(c, b) { if (typeof b == 'undefined') b = true; return [0xB0 + _ch(c), 0x42, b ? 127 : 0]; },\n    soft: function(c, b) { if (typeof b == 'undefined') b = true; return [0xB0 + _ch(c), 0x43, b ? 127 : 0]; },\n    legato: function(c, b) { if (typeof b == 'undefined') b = true; return [0xB0 + _ch(c), 0x44, b ? 127 : 0]; },\n    hold2: function(c, b) { if (typeof b == 'undefined') b = true; return [0xB0 + _ch(c), 0x45, b ? 127 : 0]; },\n    soundVariation: function(c, n) { return [0xB0 + _ch(c), 0x46, _7bn(n)]; },\n    filterResonance: function(c, n) { return [0xB0 + _ch(c), 0x47, _7bn(n)]; },\n    releaseTime: function(c, n) { return [0xB0 + _ch(c), 0x48, _7bn(n)]; },\n    attackTime: function(c, n) { return [0xB0 + _ch(c), 0x49, _7bn(n)]; },\n    brightness: function(c, n) { return [0xB0 + _ch(c), 0x4A, _7bn(n)]; },\n    decayTime: function(c, n) { return [0xB0 + _ch(c), 0x4B, _7bn(n)]; },\n    vibratoRate: function(c, n) { return [0xB0 + _ch(c), 0x4C, _7bn(n)]; },\n    vibratoDepth: function(c, n) { return [0xB0 + _ch(c), 0x4D, _7bn(n)]; },\n    vibratoDelay: function(c, n) { return [0xB0 + _ch(c), 0x4E, _7bn(n)]; },\n    ptc: function(c, n) { return [0xB0 + _ch(c), 0x54, _7bn(n)]; },\n    dataIncr: function(c) { return [0xB0 + _ch(c), 0x60, 0]; },\n    dataDecr: function(c) { return [0xB0 + _ch(c), 0x61, 0]; },\n    nrpnLSB: function(c, n) { return [0xB0 + _ch(c), 0x62, _7b(n)]; },\n    nrpnMSB: function(c, n) { return [0xB0 + _ch(c), 0x63, _7b(n)]; },\n    rpnLSB: function(c, n) { return [0xB0 + _ch(c), 0x64, _7b(n)]; },\n    rpnMSB: function(c, n) { return [0xB0 + _ch(c), 0x65, _7b(n)]; },\n    allSoundOff: function(c) { return [0xB0 + _ch(c), 0x78, 0]; },\n    resetAllControllers: function(c) { return [0xB0 + _ch(c), 0x79, 0]; },\n    localControl: function(c, b) { if (typeof b == 'undefined') b = true; return [0xB0 + _ch(c), 0x7a, b ? 127 : 0]; },\n    allNotesOff: function(c) { return [0xB0 + _ch(c), 0x7b, 0]; },\n    omni: function(c, b) { if (typeof b == 'undefined') b = true; return [0xB0 + _ch(c), b ? 0x7d : 0x7c, 0]; },\n    mono: function(c, n) { if (typeof n == 'undefined') n = 1; return [0xB0 + _ch(c), 0x7e, _7b(n)]; },\n    poly: function(c) { return [0xB0 + _ch(c), 0x7f, 0]; },\n  };\n  function _splitMasterTuning(a, b, c, d) {\n    if (typeof b != 'undefined') return [_7b(a), _7b(b), _7b(c), _7b(d)];\n    if (a != parseInt(a) || a < 0 || n > 0xffff) _bad(a);\n    a = parseInt(a);\n    return [(a >> 12) & 0xf, (a >> 8) & 0xf, (a >> 4) & 0xf, a & 0xf];\n  }\n  function _gsxg12b(x) { // -1 <= x <= 1\n    _float(x);\n    return Math.round(x * 1000 + 0x400);\n  }\n  var _helperNC = { // no channel\n    mtc: function(t) { return [0xF1, _mtc(t)]; },\n    songPosition: function(n, l) { return typeof l == 'undefined' ? [0xF2, _lsb(n), _msb(n)] : [0xF2, _7b(l), _7b(n)]; },\n    songSelect: function(n) { return [0xF3, _7b(n)]; },\n    tune: function() { return [0xF6]; },\n    clock: function() { return [0xF8]; },\n    start: function() { return [0xFA]; },\n    continue: function() { return [0xFB]; },\n    stop: function() { return [0xFC]; },\n    active: function() { return [0xFE]; },\n    sxIdRequest: function() { return [0xF0, 0x7E, this._sxid, 0x06, 0x01, 0xF7]; },\n    sxTuningDumpRequest: function(n, k) { return typeof k == 'undefined' ?\n      [0xF0, 0x7E, this._sxid, 0x08, 0x00, _7b(n), 0xF7] : [0xF0, 0x7E, this._sxid, 0x08, 0x03, _7b(n), _7b(k), 0xF7]; },\n    sxFullFrame: function(t) { return [0xF0, 0x7F, this._sxid, 0x01, 0x01, _hrtype(t), t.getMinute(), t.getSecond(), t.getFrame(), 0xF7]; },\n    sxMasterVolume: function(n, l) { return typeof l == 'undefined' ?\n      [0xF0, 0x7F, this._sxid, 0x04, 0x01, _lsb(n), _msb(n), 0xF7] : [0xF0, 0x7F, this._sxid, 0x04, 0x01, _7b(l), _7b(n), 0xF7]; },\n    sxMasterVolumeF: function(x) { return _helperNC.sxMasterVolume.call(this, MIDI.to14b(_01(x))); },\n    sxMasterFineTuning: function(n, l) { return typeof l == 'undefined' ?\n      [0xF0, 0x7F, this._sxid, 0x04, 0x03, _lsb(n), _msb(n), 0xF7] : [0xF0, 0x7F, this._sxid, 0x04, 0x03, _7b(l), _7b(n), 0xF7]; },\n    sxMasterFineTuningF: function(x) { return _helperNC.sxMasterFineTuning.call(this, MIDI.to14b(_01((x % 1 + 1) / 2, x))); },\n    sxMasterCoarseTuning: function(n) { return [0xF0, 0x7F, this._sxid, 0x04, 0x04, 0x00, _7b(n), 0xF7]; },\n    sxMasterCoarseTuningF: function(x) { return _helperNC.sxMasterCoarseTuning.call(this, 0x40 + (x - x % 1)); },\n    sxNoteTuning: function(a, b, c, d) { return b == parseInt(b) ?\n      [0xF0, _rt(d), this._sxid, 0x08, 0x07, _7b(a), _7b(b)].concat(_ntu(c), [0xF7]) :\n      [0xF0, 0x7F, this._sxid, 0x08, 0x02, _7b(a)].concat(_ntu(b), [0xF7]); },\n    sxNoteTuningF: function(a, b, c, d) { return b == parseInt(b) ?\n      _helperNC.sxNoteTuning.call(this, a, b, _f2ntu(c), d) : _helperNC.sxNoteTuning.call(this, a, _f2ntu(b)); },\n    sxNoteTuningHZ: function(a, b, c, d) { return b == parseInt(b) ?\n      _helperNC.sxNoteTuning.call(this, a, b, _hz2ntu(c), d) : _helperNC.sxNoteTuning.call(this, a, _hz2ntu(b)); },\n    sxScaleTuning1: function(a, b, c) { return a == parseInt(a) ?\n      [0xF0, _rt(c), this._sxid, 0x08, 0x08].concat(_to777(_16b(a)), _12x7(b), [0xF7]) :\n      _helperNC.sxScaleTuning1.call(this, 0xffff, a, b); },\n    sxScaleTuning1F: function(a, b, c) { if (a != parseInt(a)) return _helperNC.sxScaleTuning1F.call(this, 0xffff, a, b);\n      var v = []; for (var i = 0; i < b.length; i++) {\n        if (b[i] < -0.64 || b[i] > 0.63) throw RangeError('Out of range: ' + b[i]);\n        v.push(Math.floor(b[i] * 100 + 64)); }\n      return _helperNC.sxScaleTuning1.call(this, a, v, c); },\n    sxScaleTuning2: function(a, b, c) { return a == parseInt(a) ?\n      [0xF0, _rt(c), this._sxid, 0x08, 0x09].concat(_to777(_16b(a)), _12x14(b), [0xF7]) :\n      _helperNC.sxScaleTuning2.call(this, 0xffff, a, b); },\n    sxScaleTuning2F: function(a, b, c) { if (a != parseInt(a)) return _helperNC.sxScaleTuning2F.call(this, 0xffff, a, b);\n      var v = []; for (var i = 0; i < b.length; i++) {\n        var x = (b[i] + 1) / 2;\n        if (x < -1 || x > 1) throw RangeError('Out of range: ' + b[i]);\n        v.push(MIDI.to14b((b[i] + 1) / 2)); }\n      return _helperNC.sxScaleTuning2.call(this, a, v, c); },\n    sxGM: function(gm) { if (typeof gm == 'undefined') gm = 1; return [0xF0, 0x7E, this._sxid, 0x09, gm ? gm == 2 ? 3 : 1 : 2, 0xf7]; },\n    sxGS: function(arg) { var arr = typeof arg == 'undefined' ? [0x40, 0, 0x7F, 0] : arg instanceof Array ? arg : arguments;\n      var c = 0; var a = [0xF0, 0x41, this._sxid, 0x42, 0x12];\n      for (var i = 0; i < arr.length; i++) { var x = _7b(arr[i]); a.push(x); c += x; }\n      c %= 128; a.push(c ? 128 - c : 0); a.push(0xf7); return a; },\n    sxXG: function(arg) { var arr = typeof arg == 'undefined' ? [0, 0, 0x7E, 0] : arg instanceof Array ? arg : arguments;\n      var sxid = this._sxid == 0x7f ? 0 : this._sxid;\n      if (sxid > 15) _throw('Bad Yamaha device number: ' + sxid);\n      var a = [0xf0, 0x43, 16 + sxid, 0x4c];\n      for (var i = 0; i < arr.length; i++) a.push(_7b(arr[i])); a.push(0xf7); return a; },\n    sxMidiSoft: function(n, s) {\n      var a = [0xf0, 0x00, 0x20, 0x24, 0x00, _7b(n || 0)];\n      s = typeof s == 'undefined' ? '' : '' + s;\n      for (var i = 0; i < s.length; i++) a.push(_7b(s.charCodeAt(i)));\n      a.push(0xf7); return a; },\n    gsMasterVolume: function(n) { return _helperNC.sxGS.call(this, [0x40, 0, 4, _7b(n)]); },\n    gsMasterVolumeF: function(x) { return _helperNC.gsMasterVolume.call(this, MIDI.to7b(_01(x))); },\n    gsMasterFineTuning: function(a, b, c, d) { a = _splitMasterTuning(a, b, c, d); return _helperNC.sxGS.call(this, [0x40, 0, 0, a[0], a[1], a[2], a[3]]); },\n    gsMasterFineTuningF: function(x) { return _helperNC.gsMasterFineTuning.call(this, _gsxg12b(x % 1)); },\n    gsMasterCoarseTuning: function(n) { return _helperNC.sxGS.call(this, [0x40, 0, 5, _7b(n)]); },\n    gsMasterCoarseTuningF: function(x) { return _helperNC.gsMasterCoarseTuning.call(this, 0x40 + (x - x % 1)); },\n    gsOctaveTuning: function(c, n, x) { return _helperNC.sxGS.call(this, [0x40, 0x10 + [1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 11, 12, 13, 14, 15][_ch(c)], 0x40 + MIDI.octaveValue(n), _7b(x)]); },\n    gsOctaveTuningF: function(c, n, x) { if (x < -0.64 || x > 0.63) throw RangeError('Out of range: ' + x);\n      return _helperNC.gsOctaveTuning.call(this, c, n, Math.floor(x * 100 + 64)); },\n    xgMasterVolume: function(n) { return _helperNC.sxXG.call(this, [0, 0, 4, _7b(n)]); },\n    xgMasterVolumeF: function(x) { return _helperNC.xgMasterVolume.call(this, MIDI.to7b(_01(x))); },\n    xgMasterFineTuning: function(a, b, c, d) { a = _splitMasterTuning(a, b, c, d); return _helperNC.sxXG.call(this, [0, 0, 0, a[0], a[1], a[2], a[3]]); },\n    xgMasterFineTuningF: function(x) { return _helperNC.xgMasterFineTuning.call(this, _gsxg12b(x % 1)); },\n    xgMasterCoarseTuning: function(n) { return _helperNC.sxXG.call(this, [0, 0, 6, _7b(n)]); },\n    xgMasterCoarseTuningF: function(x) { return _helperNC.xgMasterCoarseTuning.call(this, 0x40 + (x - x % 1)); },\n    xgOctaveTuning: function(c, n, x) { return _helperNC.sxXG.call(this, [8, _ch(c), 0x41 + MIDI.octaveValue(n), _7b(x)]); },\n    xgOctaveTuningF: function(c, n, x) { if (x < -0.64 || x > 0.63) throw RangeError('Out of range: ' + x);\n      return _helperNC.xgOctaveTuning.call(this, c, n, Math.floor(x * 100 + 64)); },\n    reset: function() { return [0xFF]; },\n  };\n  _helperNC.sxScaleTuning = _helperNC.sxScaleTuning2;\n  _helperNC.sxScaleTuningF = _helperNC.sxScaleTuning2F;\n  _helperNC.sxMasterTranspose = _helperNC.sxMasterCoarseTuning;\n  _helperNC.sxMasterTransposeF = _helperNC.sxMasterCoarseTuningF;\n  _helperNC.gsMasterTranspose = _helperNC.gsMasterCoarseTuning;\n  _helperNC.gsMasterTransposeF = _helperNC.gsMasterCoarseTuningF;\n  _helperNC.xgMasterTranspose = _helperNC.xgMasterCoarseTuning;\n  _helperNC.xgMasterTransposeF = _helperNC.xgMasterCoarseTuningF;\n  var _helperGCH = { // compound messages\n    bank: function(c, m, l) { return typeof l == 'undefined' ?\n      [_helperCH.bankMSB(c, _msb(m)), _helperCH.bankLSB(c, _lsb(m))] : [_helperCH.bankMSB(c, m), _helperCH.bankLSB(c, l)]; },\n    modF: function(c, x) { return _helperGCH.mod(c, MIDI.to14b(x)); },\n    mod: function(c, m, l) { return typeof l == 'undefined' ?\n      [_helperCH.modMSB(c, _msb(m)), _helperCH.modLSB(c, _lsb(m))] : [_helperCH.modMSB(c, m), _helperCH.modLSB(c, l)]; },\n    breathF: function(c, x) { return _helperGCH.breath(c, MIDI.to14b(x)); },\n    breath: function(c, m, l) { return typeof l == 'undefined' ?\n      [_helperCH.breathMSB(c, _msb(m)), _helperCH.breathLSB(c, _lsb(m))] : [_helperCH.breathMSB(c, m), _helperCH.breathLSB(c, l)]; },\n    footF: function(c, x) { return _helperGCH.foot(c, MIDI.to14b(x)); },\n    foot: function(c, m, l) { return typeof l == 'undefined' ?\n      [_helperCH.footMSB(c, _msb(m)), _helperCH.footLSB(c, _lsb(m))] : [_helperCH.footMSB(c, m), _helperCH.footLSB(c, l)]; },\n    portamentoTimeF: function(c, x) { return _helperGCH.portamentoTime(c, MIDI.to14b(x)); },\n    portamentoTime: function(c, m, l) { return typeof l == 'undefined' ?\n      [_helperCH.portamentoMSB(c, _msb(m)), _helperCH.portamentoLSB(c, _lsb(m))] : [_helperCH.portamentoMSB(c, m), _helperCH.portamentoLSB(c, l)]; },\n    dataF: function(c, x) { return _helperGCH.data(c, MIDI.to14b(x)); },\n    data: function(c, m, l) { return typeof l == 'undefined' ?\n      [_helperCH.dataMSB(c, _msb(m)), _helperCH.dataLSB(c, _lsb(m))] : [_helperCH.dataMSB(c, m), _helperCH.dataLSB(c, l)]; },\n    volumeF: function(c, x) { return _helperGCH.volume(c, MIDI.to14b(x)); },\n    volume: function(c, m, l) { return typeof l == 'undefined' ?\n      [_helperCH.volumeMSB(c, _msb(m)), _helperCH.volumeLSB(c, _lsb(m))] : [_helperCH.volumeMSB(c, m), _helperCH.volumeLSB(c, l)]; },\n    balanceF: function(c, x) { return _helperGCH.balance(c, MIDI.to14b((x + 1) / 2)); },\n    balance: function(c, m, l) { return typeof l == 'undefined' ?\n      [_helperCH.balanceMSB(c, _msb(m)), _helperCH.balanceLSB(c, _lsb(m))] : [_helperCH.balanceMSB(c, m), _helperCH.balanceLSB(c, l)]; },\n    panF: function(c, x) { return _helperGCH.pan(c, MIDI.to14b((x + 1) / 2)); },\n    pan: function(c, m, l) { return typeof l == 'undefined' ?\n      [_helperCH.panMSB(c, _msb(m)), _helperCH.panLSB(c, _lsb(m))] : [_helperCH.panMSB(c, m), _helperCH.panLSB(c, l)]; },\n    expressionF: function(c, x) { return _helperGCH.expression(c, MIDI.to14b(x)); },\n    expression: function(c, m, l) { return typeof l == 'undefined' ?\n      [_helperCH.expressionMSB(c, _msb(m)), _helperCH.expressionLSB(c, _lsb(m))] : [_helperCH.expressionMSB(c, m), _helperCH.expressionLSB(c, l)]; },\n    nrpn: function(c, m, l) { return typeof l == 'undefined' ?\n      [_helperCH.nrpnMSB(c, _msb(m)), _helperCH.nrpnLSB(c, _lsb(m))] : [_helperCH.nrpnMSB(c, m), _helperCH.nrpnLSB(c, l)]; },\n    rpn: function(c, m, l) { return typeof l == 'undefined' ?\n      [_helperCH.rpnMSB(c, _msb(m)), _helperCH.rpnLSB(c, _lsb(m))] : [_helperCH.rpnMSB(c, m), _helperCH.rpnLSB(c, l)]; },\n    rpnPitchBendRange: function(c, m, l) { return _helperGCH.rpn(c, 0, 0).concat(_helperGCH.data(c, m, l)); },\n    rpnPitchBendRangeF: function(c, x) { return _helperGCH.rpnPitchBendRange(c, _7b(x - x % 1), Math.floor((x % 1) * 100)); },\n    rpnFineTuning: function(c, m, l) { return _helperGCH.rpn(c, 0, 1).concat(_helperGCH.data(c, m, l)); },\n    rpnFineTuningF: function(c, x) { return _helperGCH.rpn(c, 0, 1).concat(_helperGCH.dataF(c, (x % 1 + 1) / 2)); },\n    rpnCoarseTuning: function(c, m) { return _helperGCH.rpn(c, 0, 2).concat([_helperCH.dataMSB(c, m)]); },\n    rpnCoarseTuningF: function(c, x) { return _helperGCH.rpn(c, 0, 2).concat([_helperCH.dataMSB(c, 0x40 + (x - x % 1))]); },\n    rpnTuning: function(c, n, m, l) { return _helperGCH.rpnCoarseTuning(c, n).concat(_helperGCH.rpnFineTuning(c, m, l)); },\n    rpnTuningF: function(c, x) { return _helperGCH.rpnCoarseTuningF(c, x).concat(_helperGCH.rpnFineTuningF(c, x)); },\n    rpnTuningA: function(c, a) { return _helperGCH.rpnTuningF(c, MIDI.shift(a)); },\n    rpnSelectTuningProgram: function(c, n) { return _helperGCH.rpn(c, 0, 3).concat([_helperCH.dataMSB(c, n)]); },\n    rpnSelectTuningBank: function(c, n) { return _helperGCH.rpn(c, 0, 4).concat([_helperCH.dataMSB(c, n)]); },\n    rpnSelectTuning: function(c, n, k) { return typeof k == 'undefined' ?\n      _helperGCH.rpnSelectTuningProgram(c, n) : _helperGCH.rpnSelectTuningBank(c, n).concat(_helperGCH.rpnSelectTuningProgram(c, k)); },\n    rpnModulationDepthRange: function(c, m, l) { return _helperGCH.rpn(c, 0, 5).concat(_helperGCH.data(c, m, l)); },\n    rpnModulationDepthRangeF: function(c, x) { return _helperGCH.rpnModulationDepthRange(c, _7b(x - x % 1), Math.floor((x % 1) * 128)); },\n    rpnNull: function(c) { return _helperGCH.rpn(c, 0x7f, 0x7f); },\n    mode1: function(c) { return [ _helperCH.omni(c, true), _helperCH.poly(c) ]; },\n    mode2: function(c) { return [ _helperCH.omni(c, true), _helperCH.mono(c) ]; },\n    mode3: function(c) { return [ _helperCH.omni(c, false), _helperCH.poly(c) ]; },\n    mode4: function(c) { return [ _helperCH.omni(c, false), _helperCH.mono(c) ]; },\n  };\n  var _helperGNC = { // compound messages no channel\n    sxMasterTuning: function(n, m, l) { return [_helperNC.sxMasterCoarseTuning.call(this, n), _helperNC.sxMasterFineTuning.call(this, m, l)]; },\n    sxMasterTuningF: function(x) { return [_helperNC.sxMasterCoarseTuningF.call(this, x), _helperNC.sxMasterFineTuningF.call(this, x)]; },\n    gsMasterTuningF: function(x) { return [_helperNC.gsMasterCoarseTuningF.call(this, x), _helperNC.gsMasterFineTuningF.call(this, x)]; },\n    xgMasterTuningF: function(x) { return [_helperNC.xgMasterCoarseTuningF.call(this, x), _helperNC.xgMasterFineTuningF.call(this, x)]; },\n    sxMasterTuningA: function(a) { return _helperGNC.sxMasterTuningF.call(this, MIDI.shift(a)); },\n    gsMasterTuningA: function(a) { return _helperGNC.gsMasterTuningF.call(this, MIDI.shift(a)); },\n    xgMasterTuningA: function(a) { return _helperGNC.xgMasterTuningF.call(this, MIDI.shift(a)); },\n    gsScaleTuning: function(c, a) { var out = []; if (a.length != 12) throw RangeError('Wrong input size: ' + a.length);\n      for (var i = 0; i < 12; i++) out.push(_helperNC.gsOctaveTuning.call(this, c, i, a[i])); return out; },\n    gsScaleTuningF: function(c, a) { var out = []; if (a.length != 12) throw RangeError('Wrong input size: ' + a.length);\n      for (var i = 0; i < 12; i++) out.push(_helperNC.gsOctaveTuningF.call(this, c, i, a[i])); return out; },\n    xgScaleTuning: function(c, a) { var out = []; if (a.length != 12) throw RangeError('Wrong input size: ' + a.length);\n      for (var i = 0; i < 12; i++) out.push(_helperNC.xgOctaveTuning.call(this, c, i, a[i])); return out; },\n    xgScaleTuningF: function(c, a) { var out = []; if (a.length != 12) throw RangeError('Wrong input size: ' + a.length);\n      for (var i = 0; i < 12; i++) out.push(_helperNC.xgOctaveTuningF.call(this, c, i, a[i])); return out; },\n  };\n  function _smf(ff, dd) {\n    var midi = new MIDI();\n    midi.ff = _8b(ff);\n    midi.dd = typeof dd == 'undefined' ? '' : _8bs(dd);\n    return midi;\n  }\n  var _helperSMF = { // Standard MIDI File events\n    smf: function(arg) {\n      if (arg instanceof MIDI) return new MIDI(arg);\n      var arr = arg instanceof Array ? arg : arguments;\n      var ff = _8b(arr[0]);\n      var dd = '';\n      if (arr.length == 2) dd = _2s(arr[1]);\n      else if (arr.length > 2) dd = _2s(Array.prototype.slice.call(arr, 1));\n      return _smf(ff, dd);\n    },\n    smfSeqNumber: function(dd) {\n      if (dd == parseInt(dd)) {\n        if (dd < 0 || dd > 0xffff) throw RangeError('Sequence number out of range: ' + dd);\n        dd = String.fromCharCode(dd >> 8) + String.fromCharCode(dd & 0xff);\n      }\n      else {\n        dd = '' + dd;\n        if (dd.length == 0) dd = '\\x00\\x00';\n        else if (dd.length == 1) dd = '\\x00' + dd;\n        else if (dd.length > 2) throw RangeError('Sequence number out of range' + _smftxt(dd));\n      }\n      return _smf(0, dd);\n    },\n    smfText: function(dd) { return _smf(1, JZZ.lib.toUTF8(dd)); },\n    smfCopyright: function(dd) { return _smf(2, JZZ.lib.toUTF8(dd)); },\n    smfSeqName: function(dd) { return _smf(3, JZZ.lib.toUTF8(dd)); },\n    smfInstrName: function(dd) { return _smf(4, JZZ.lib.toUTF8(dd)); },\n    smfLyric: function(dd) { return _smf(5, JZZ.lib.toUTF8(dd)); },\n    smfMarker: function(dd) { return _smf(6, JZZ.lib.toUTF8(dd)); },\n    smfCuePoint: function(dd) { return _smf(7, JZZ.lib.toUTF8(dd)); },\n    smfProgName: function(dd) { return _smf(8, JZZ.lib.toUTF8(dd)); },\n    smfDevName: function(dd) { return _smf(9, JZZ.lib.toUTF8(dd)); },\n    smfChannelPrefix: function(dd) {\n      if (dd == parseInt(dd)) {\n        _validateChannel(dd);\n        dd = String.fromCharCode(dd);\n      }\n      else {\n        dd = '' + dd;\n        if (dd.length == 0) dd = '\\x00';\n        else if (dd.length > 1 || dd.charCodeAt(0) > 15) throw RangeError('Channel number out of range' + _smftxt(dd));\n      }\n      return _smf(32, dd);\n    },\n    smfMidiPort: function(dd) {\n      if (dd == parseInt(dd)) {\n        if (dd < 0 || dd > 127) throw RangeError('Port number out of range: ' + dd);\n        dd = String.fromCharCode(dd);\n      }\n      else {\n        dd = '' + dd;\n        if (dd.length == 0) dd = '\\x00';\n        else if (dd.length > 1 || dd.charCodeAt(0) > 127) throw RangeError('Port number out of range' + _smftxt(dd));\n      }\n      return _smf(33, dd);\n    },\n    smfEndOfTrack: function(dd) {\n      if (_2s(dd) != '') throw RangeError('Unexpected data' + _smftxt(_2s(dd)));\n      return _smf(47);\n    },\n    smfTempo: function(dd) { // microseconds per quarter note\n      if (('' + dd).length == 3) return _smf(81, dd);\n      if (dd == parseInt(dd) && dd > 0 && dd <= 0xffffff) {\n        return _smf(81, String.fromCharCode(dd >> 16) + String.fromCharCode((dd >> 8) & 0xff) + String.fromCharCode(dd & 0xff));\n      }\n      throw RangeError('Out of range' + _smftxt(_2s(dd)));\n    },\n    smfBPM: function(bpm) { return _helperSMF.smfTempo(Math.round(60000000.0 / bpm)); },\n    smfSMPTE: function(dd) {\n      if (dd instanceof SMPTE) return _smf(84, String.fromCharCode(dd.hour) + String.fromCharCode(dd.minute) + String.fromCharCode(dd.second) + String.fromCharCode(dd.frame) + String.fromCharCode((dd.quarter % 4) * 25));\n      var s = '' + dd;\n      if (s.length == 5) {\n        return _smf(84, dd);\n      }\n      var arr = dd instanceof Array ? dd : Array.prototype.slice.call(arguments);\n      arr.splice(0, 0, 30);\n      return _helperSMF.smfSMPTE(new SMPTE(arr));\n    },\n    smfTimeSignature: function(a, b, c, d) {\n      var nn, dd, cc, bb;\n      var m = ('' + a ).match(/^\\s*(\\d+)\\s*\\/\\s*(\\d+)\\s*$/);\n      if (m) {\n        nn = parseInt(m[1]);\n        dd = parseInt(m[2]);\n        if (nn > 0 && nn < 0x100 && dd > 0 && !(dd & (dd - 1))) {\n          cc = dd; dd = 0;\n          for (cc >>= 1; cc; cc >>= 1) dd++;\n          cc = b == parseInt(b) ? b : 24;\n          bb = c == parseInt(c) ? c : 8;\n          return _smf(88, String.fromCharCode(nn) + String.fromCharCode(dd) + String.fromCharCode(cc) + String.fromCharCode(bb));\n        }\n        else if (('' + a ).length == 4) return _smf(88, a);\n      }\n      else if (a == parseInt(a) && b == parseInt(b)) {\n        if (a > 0 && a < 0x100 && b > 0 && !(b & (b - 1))) {\n          nn = a;\n          dd = 0;\n          cc = b;\n          for (cc >>= 1; cc; cc >>= 1) dd++;\n          cc = c == parseInt(c) ? c : 24;\n          bb = d == parseInt(d) ? d : 8;\n          return _smf(88, String.fromCharCode(nn) + String.fromCharCode(dd) + String.fromCharCode(cc) + String.fromCharCode(bb));\n        }\n        else if (('' + a ).length == 4) return _smf(88, a);\n        a = a + '/' + b;\n      }\n      else if (('' + a ).length == 4) return _smf(88, a);\n      throw RangeError('Wrong time signature' + _smftxt(_2s('' + a)));\n    },\n    smfKeySignature: function(dd) {\n      dd = '' + dd;\n      var m = dd.match(/^\\s*([A-H][b#]?)\\s*(|maj|major|dur|m|min|minor|moll)\\s*$/i);\n      if (m) {\n        var sf = {\n          CB: 0, GB: 1, DB: 2, AB: 3, EB: 4, BB: 5, F: 6, C: 7, G: 8, D: 9, A: 10,\n          E:11, B: 12, H: 12, 'F#': 13, 'C#': 14, 'G#': 15, 'D#': 16, 'A#': 17\n        }[m[1].toUpperCase()];\n        var mi = { '': 0, MAJ: 0, MAJOR: 0, DUR: 0, M: 1, MIN: 1, MINOR: 1, MOLL: 1}[m[2].toUpperCase()];\n        if (typeof sf != 'undefined' && typeof mi != 'undefined') {\n          if (mi) sf -= 3;\n          sf -= 7;\n          if (sf >= -7 && sf < 0) dd = String.fromCharCode(256 + sf) + String.fromCharCode(mi);\n          else if (sf >= 0 && sf <= 7) dd = String.fromCharCode(sf) + String.fromCharCode(mi);\n        }\n      }\n      if (dd.length == 2 && dd.charCodeAt(1) <= 1 && (dd.charCodeAt(0) <= 7 || dd.charCodeAt(0) <= 255 && dd.charCodeAt(0) >= 249)) return _smf(89, dd);\n      throw RangeError('Incorrect key signature' + _smftxt(dd));\n    },\n    smfSequencer: function(dd) { return _smf(127, _2s(dd)); }\n  };\n\n  var _helpers = {};\n  function _copyHelperNC(name, func) {\n    MIDI[name] = function() { return new MIDI(func.apply(this, arguments)); };\n    _helpers[name] = function() { return this.send(func.apply(this, arguments)); };\n  }\n  function _copyHelperSMF(name, func) {\n    MIDI[name] = function() { return func.apply(this, arguments); };\n    _helpers[name] = function() { return this.send(func.apply(this, arguments)); };\n  }\n  function _copyHelperGNC(name, func) {\n    MIDI[name] = function() {\n      var i;\n      var g = [];\n      var a = func.apply(this, arguments);\n      for (i = 0; i < a.length; i++) g.push(new MIDI(a[i]));\n      return g;\n    };\n    _helpers[name] = function() {\n      var a = func.apply(this, arguments);\n      var g = this;\n      for (var i = 0; i < a.length; i++) g = g.send(a[i]);\n      return g;\n    };\n  }\n  function _copyHelperMPE(name, func) {\n    MIDI[name] = function() {\n      return new MIDI(func.apply(this, typeof this._ch == 'undefined' ? arguments : [this._ch].concat(Array.prototype.slice.call(arguments))));\n    };\n    _helpers[name] = function() {\n      if (typeof this._master != 'undefined') {\n        var msg = new MIDI(func.apply(this, [this._master].concat(Array.prototype.slice.call(arguments))));\n        msg._mpe = msg[1];\n        return this.send(msg);\n      }\n      return this.send(func.apply(this, typeof this._ch == 'undefined' ? arguments : [this._ch].concat(Array.prototype.slice.call(arguments))));\n    };\n  }\n  function _copyHelperCH(name, func) {\n    MIDI[name] = function() {\n      return new MIDI(func.apply(this, typeof this._ch == 'undefined' ? arguments : [this._ch].concat(Array.prototype.slice.call(arguments))));\n    };\n    _helpers[name] = function() {\n      if (typeof this._master != 'undefined') {\n        var chan;\n        var args = Array.prototype.slice.call(arguments);\n        if (args.length < func.length) args = [this._master].concat(args);\n        else {\n          chan = _7bn(args[0]);\n          args[0] = this._master;\n        }\n        var msg = new MIDI(func.apply(this, args));\n        msg._mpe = chan;\n        return this.send(msg);\n      }\n      return this.send(func.apply(this, typeof this._ch == 'undefined' ? arguments : [this._ch].concat(Array.prototype.slice.call(arguments))));\n    };\n  }\n  function _copyHelperGCH(name, func) {\n    MIDI[name] = function() {\n      var i;\n      var g = [];\n      var a = func.apply(this, typeof this._ch == 'undefined' ? arguments : [this._ch].concat(Array.prototype.slice.call(arguments)));\n      for (i = 0; i < a.length; i++) g.push(new MIDI(a[i]));\n      return g;\n    };\n    _helpers[name] = function() {\n      var i;\n      var a;\n      var g;\n      if (typeof this._master != 'undefined') {\n        var chan;\n        var args = Array.prototype.slice.call(arguments);\n        if (args.length < func.length) args = [this._master].concat(args);\n        else {\n          chan = _7bn(args[0]);\n          args[0] = this._master;\n        }\n        a = func.apply(this, args);\n        g = this;\n        for (i = 0; i < a.length; i++) {\n          var msg = MIDI(a[i]);\n          msg._mpe = chan;\n          g = g.send(msg);\n        }\n        return g;\n      }\n      a = func.apply(this, typeof this._ch == 'undefined' ? arguments : [this._ch].concat(Array.prototype.slice.call(arguments)));\n      g = this;\n      for (i = 0; i < a.length; i++) g = g.send(a[i]);\n      return g;\n    };\n  }\n\n  _for(_helperNC, function(n) { _copyHelperNC(n, _helperNC[n]); });\n  _for(_helperSMF, function(n) { _copyHelperSMF(n, _helperSMF[n]); });\n  _for(_helperGNC, function(n) { _copyHelperGNC(n, _helperGNC[n]); });\n  _for(_helperMPE, function(n) { _copyHelperMPE(n, _helperMPE[n]); });\n  _for(_helperCH, function(n) { _copyHelperCH(n, _helperCH[n]); });\n  _for(_helperGCH, function(n) { _copyHelperGCH(n, _helperGCH[n]); });\n\n  function _copyMidiHelpers(M) {\n    _for(_helpers, function(n) { M.prototype[n] = _helpers[n]; });\n  }\n  _copyMidiHelpers(_M);\n\n  var _channelMap = { a:10, b:11, c:12, d:13, e:14, f:15, A:10, B:11, C:12, D:13, E:14, F:15 };\n  for (k = 0; k < 16; k++) _channelMap[k] = k;\n  MIDI.prototype.getChannel = function() {\n    if (this.ff == 0x20 && this.dd.length == 1 && this.dd.charCodeAt(0) < 16) return this.dd.charCodeAt(0);\n    var c = this[0];\n    if (typeof c == 'undefined' || c < 0x80 || c > 0xef) return;\n    return c & 15;\n  };\n  MIDI.prototype.setChannel = function(x) {\n    x = _channelMap[x];\n    if (typeof x == 'undefined') return this;\n    if (this.ff == 0x20) this.dd = String.fromCharCode(x);\n    else {\n      var c = this[0];\n      if (typeof c != 'undefined' && c >= 0x80 && c <= 0xef) this[0] = (c & 0xf0) | x;\n    }\n    return this;\n  };\n  MIDI.prototype.getNote = function() {\n    var c = this[0];\n    if (typeof c == 'undefined' || c < 0x80 || c > 0xaf) return;\n    return this[1];\n  };\n  MIDI.prototype.setNote = function(x) {\n    var c = this[0];\n    if (typeof c == 'undefined' || c < 0x80 || c > 0xaf) return this;\n    x = MIDI.noteValue(x);\n    if (typeof x != 'undefined') this[1] = x;\n    return this;\n  };\n  MIDI.prototype.getVelocity = function() {\n    var c = this[0];\n    if (typeof c == 'undefined' || c < 0x80 || c > 0x9f) return;\n    return this[2];\n  };\n  MIDI.prototype.setVelocity = function(x) {\n    var c = this[0];\n    if (typeof c == 'undefined' || c < 0x80 || c > 0x9f) return this;\n    x = parseInt(x);\n    if (x >= 0 && x < 128) this[2] = x;\n    return this;\n  };\n  MIDI.prototype.getSysExId = function() {\n    if (this[0] == 0xf0) return this[2];\n  };\n  MIDI.prototype.setSysExId = function(x) {\n    if (this[0] == 0xf0 && this.length > 2) {\n      x = parseInt(x);\n      if (x >= 0 && x < 128) this[2] = x;\n    }\n    return this;\n  };\n  MIDI.prototype.getData = function() {\n    if (typeof this.dd != 'undefined') return this.dd.toString();\n  };\n  MIDI.prototype.setData = function(dd) {\n    this.dd = _2s(dd);\n    return this;\n  };\n  function _is_yamaha_smf(ff, dd) { return ff == 0x7f && typeof dd != 'undefined' && dd.charCodeAt(0) == 0x43 && dd.charCodeAt(1) == 0x7b; }\n  function _is_yamaha_chord(ff, dd) { return _is_yamaha_smf(ff, dd) && dd.charCodeAt(2) == 1; }\n  function _yamaha_chord(a, b) {\n    if (a >= 0 && a <= 0x7f && b >= 0 && b <= 0x7f) {\n      var c = a & 0xf;\n      var d = a >> 4;\n      if (c > 0 && c < 8 && d < 7) c = ['C', 'D', 'E', 'F', 'G', 'A', 'B'][c - 1] + ['bbb', 'bb', 'b', '', '#', '##', '###'][d];\n      else return '-';\n      if (b > 34) return c + '?';\n      else return c + [\n        '', '6', 'Maj7', 'Maj7(#11)', '(9)', 'Maj7(9)', '6(9)', 'aug', 'm', 'm6', 'm7', 'm7b5',\n        'm(9)', 'm7(9)', 'm7(11)', 'm+7', 'm+7(9)', 'dim', 'dim7', '7', '7sus4', '7b5', '7(9)',\n        '7(#11)', '7(13)', '7(b9)', '7(b13)', '7(#9)', 'Maj7aug', '7aug', '1+8', '1+5', 'sus4', '1+2+5', 'cc'][b];\n    }\n    return '-';\n  }\n  MIDI.prototype.getText = function() {\n    if (typeof this.dd != 'undefined') {\n      if (_is_yamaha_chord(this.ff, this.dd)) return _yamaha_chord(this.dd.charCodeAt(3), this.dd.charCodeAt(4));\n      else return JZZ.lib.fromUTF8(this.dd);\n    }\n    if (this.isMidiSoft()) {\n      var s = [];\n      for (var i = 6; i < this.length - 1; i++) s.push(String.fromCharCode(this[i]));\n      return s.join('');\n    }\n  };\n  MIDI.prototype.setText = function(dd) {\n    this.dd = JZZ.lib.toUTF8(dd);\n    return this;\n  };\n  MIDI.prototype.getTempo = function() {\n    if (this.ff == 0x51 && typeof this.dd != 'undefined') {\n      return this.dd.charCodeAt(0) * 65536 + this.dd.charCodeAt(1) * 256 + this.dd.charCodeAt(2);\n    }\n  };\n  MIDI.prototype.getBPM = function() {\n    var ms = this.getTempo();\n    if (ms) return 60000000 / ms;\n  };\n  MIDI.prototype.getTimeSignature = function() {\n    if (this.ff == 0x58 && typeof this.dd != 'undefined') {\n       return [this.dd.charCodeAt(0), 1 << this.dd.charCodeAt(1)];\n    }\n  };\n  MIDI.prototype.getKeySignature = function() {\n    if (this.ff == 0x59 && typeof this.dd != 'undefined') {\n      var sf = this.dd.charCodeAt(0);\n      var mi = this.dd.charCodeAt(1);\n      if (sf & 0x80) sf = sf - 0x100;\n      if (sf >= -7 && sf <= 7 && mi >= 0 && mi <= 1) {\n        return [sf,\n          ['Cb', 'Gb', 'Db', 'Ab', 'Eb', 'Bb', 'F', 'C', 'G', 'D', 'A', 'E', 'B', 'F#', 'C#', 'G#', 'D#', 'A#'][mi ? sf + 10 : sf + 7],\n          !!mi\n        ];\n      }\n    }\n  };\n\n  MIDI.prototype.isNoteOn = function() {\n    var c = this[0];\n    if (typeof c == 'undefined' || c < 0x90 || c > 0x9f) return false;\n    return this[2] > 0 ? true : false;\n  };\n  MIDI.prototype.isNoteOff = function() {\n    var c = this[0];\n    if (typeof c == 'undefined' || c < 0x80 || c > 0x9f) return false;\n    if (c < 0x90) return true;\n    return this[2] == 0 ? true : false;\n  };\n  MIDI.prototype.isSysEx = function() {\n    return this[0] == 0xf0;\n  };\n  MIDI.prototype.isFullSysEx = function() {\n    return this[0] == 0xf0 && this[this.length - 1] == 0xf7;\n  };\n  MIDI.prototype.isMidiSoft = function() {\n    return this.isFullSysEx() && this[1] == 0 && this[2] == 0x20 && this[3] == 0x24 && this[4] == 0;\n  };\n  MIDI.prototype.isSMF = function() {\n    return this.ff >= 0 && this.ff <= 0x7f;\n  };\n  MIDI.prototype.isEOT = function() {\n    return this.ff == 0x2f;\n  };\n  MIDI.prototype.isTempo = function() {\n    return this.ff == 0x51;\n  };\n  MIDI.prototype.isTimeSignature = function() {\n    return this.ff == 0x58;\n  };\n  MIDI.prototype.isKeySignature = function() {\n    return this.ff == 0x59;\n  };\n  MIDI.prototype.isGmReset = function() {\n    return this.match([0xf0, 0x7e, [0, 0], 0x09, [0, 0], 0xf7]);\n  };\n  MIDI.prototype.isGsReset = function() {\n    return this.match([0xf0, 0x41, [0, 0], 0x42, 0x12, 0x40, 0, 0x7f, 0, 0x41, 0xf7]);\n  };\n  MIDI.prototype.isXgReset = function() {\n    return this.match([0xf0, 0x43, [0x10, 0xf0], 0x4c, 0, 0, 0x7e, 0, 0xf7]);\n  };\n  MIDI.prototype.match = function(a) {\n    var i, m;\n    for (i = 0; i < a.length; i++) {\n      m = a[i][1];\n      if (typeof m == 'undefined') {\n        if (this[i] != a[i]) return false;\n      }\n      else {\n        if ((this[i] & m) != (a[i][0] & m)) return false;\n      }\n    }\n    return true;\n  };\n\n  function _s2a(x) {\n    var a = [];\n    for (var i = 0; i < x.length; i++) {\n      a[i] = x.charCodeAt(i);\n    }\n    return a;\n  }\n  function _a2s(x) {\n    var a = '';\n    for (var i = 0; i < x.length; i++) {\n      a += String.fromCharCode(x[i]);\n    }\n    return a;\n  }\n  function _2s(x) {\n    return x instanceof Array ? _a2s(x) : typeof x == 'undefined' ? '' : '' + x;\n  }\n  function _s2n(x) {\n    var n = 0;\n    for (var i = 0; i < x.length; i++) n = (n << 8) + x.charCodeAt(i);\n    return n;\n  }\n\n  function __hex(x) { return (x < 16 ? '0' : '') + x.toString(16); }\n  function _hex(x) {\n    var a = [];\n    for (var i = 0; i < x.length; i++) {\n      a[i] = __hex(x[i]);\n    }\n    return a.join(' ');\n  }\n  function _toLine(s) {\n    var out = '';\n    for (var i = 0; i < s.length; i++) {\n      if (s[i] == '\\n') out += '\\\\n';\n      else if (s[i] == '\\r') out += '\\\\r';\n      else if (s[i] == '\\t') out += '\\\\t';\n      else if (s.charCodeAt(i) < 32) out += '\\\\x' + __hex(s.charCodeAt(i));\n      else out += s[i];\n    }\n    return out;\n  }\n  function _smfhex(dd) {\n    return dd.length ? ': ' + _hex(_s2a(dd)) : '';\n  }\n  function _smftxt(dd) {\n    return dd.length ? ': ' + _toLine(JZZ.lib.fromUTF8(dd)) : '';\n  }\n  MIDI.prototype.label = function(s) {\n    this.lbl = this.lbl ? this.lbl + ', ' + s : s;\n    return this;\n  };\n  MIDI.prototype.toString = function() {\n    return this.lbl ? this._str() + ' (' + this.lbl + ')' : this._str();\n  };\n  MIDI.prototype._str = function() {\n    var s;\n    var ss;\n    if (!this.length) {\n      if (typeof this.ff != 'undefined') {\n        s = 'ff' + __hex(this.ff) + ' -- ';\n        if (this.ff == 0) s += 'Sequence Number: ' + _s2n(this.dd);\n        else if (this.ff > 0 && this.ff < 10) s += ['', 'Text', 'Copyright', 'Sequence Name', 'Instrument Name', 'Lyric', 'Marker', 'Cue Point', 'Program Name', 'Device Name'][this.ff] + _smftxt(this.dd);\n        else if (this.ff == 32) s += 'Channel Prefix' + _smfhex(this.dd);\n        else if (this.ff == 33) s += 'MIDI Port' + _smfhex(this.dd);\n        else if (this.ff == 47) s += 'End of Track' + _smfhex(this.dd);\n        else if (this.ff == 81) {\n          var bpm = Math.round(this.getBPM() * 100) / 100;\n          s += 'Tempo: ' + bpm + ' bpm';\n        }\n        else if (this.ff == 84) s += 'SMPTE Offset: ' + _smptetxt(_s2a(this.dd));\n        else if (this.ff == 88) {\n          var d = 1 << this.dd.charCodeAt(1);\n          s += 'Time Signature: ' + this.dd.charCodeAt(0) + '/' + d;\n          s += ' ' + this.dd.charCodeAt(2) + ' ' + this.dd.charCodeAt(3);\n        }\n        else if (this.ff == 89) {\n          s += 'Key Signature: ';\n          var ks = this.getKeySignature();\n          if (ks) {\n            s += ks[1];\n            if (ks[2]) s += ' min';\n          }\n          else s+= 'invalid';\n        }\n        else if (this.ff == 127) {\n          if (this.dd.charCodeAt(0) == 0x43) {\n            if (this.dd.charCodeAt(1) == 0x7b) {\n              s += '[XF:' + __hex(this.dd.charCodeAt(2)) + ']';\n              ss = { 0: 'Version', 1: 'Chord', 2: 'Rehearsal Mark', 3: 'Phrase Mark', 4: 'Max Phrase Mark',\n                5: 'Fingering Number', 12: 'Guide Track Flag', 16: 'Guitar Info', 18: 'Chord Voicing',\n                127: 'XG Song Data Number' }[this.dd.charCodeAt(2)];\n              s += ss ? ' ' + ss : '';\n              s += ': ';\n              if (this.dd.charCodeAt(2) == 0) {\n                return s + this.dd.substr(3, 4) + ' ' + _hex(_s2a(this.dd.substr(7)));\n              }\n              if (this.dd.charCodeAt(2) == 1) {\n                return s + this.getText();\n              }\n              return s + _hex(_s2a(this.dd.substr(3)));\n            }\n          }\n          s += 'Sequencer Specific' + _smfhex(this.dd);\n        }\n        else s += 'SMF' + _smfhex(this.dd);\n        return s;\n      }\n      return 'empty';\n    }\n    s = _hex(this);\n    if (this[0] < 0x80) return s;\n    ss = {\n      241: 'MIDI Time Code',\n      242: 'Song Position',\n      243: 'Song Select',\n      244: 'Undefined',\n      245: 'Undefined',\n      246: 'Tune request',\n      248: 'Timing clock',\n      249: 'Undefined',\n      250: 'Start',\n      251: 'Continue',\n      252: 'Stop',\n      253: 'Undefined',\n      254: 'Active Sensing',\n      255: 'Reset'\n    }[this[0]];\n    if (ss) return s + ' -- ' + ss;\n    if (this.isMidiSoft()) {\n      ss = _toLine(this.getText());\n      if (ss) ss = ' ' + ss;\n      return s + ' -- [K:' + __hex(this[5]) + ']' + ss;\n    }\n    var c = this[0] >> 4;\n    ss = {8: 'Note Off', 10: 'Aftertouch', 12: 'Program Change', 13: 'Channel Aftertouch', 14: 'Pitch Wheel'}[c];\n    if (ss) return s + ' -- ' + ss;\n    if (c == 9) return s + ' -- ' + (this[2] ? 'Note On' : 'Note Off');\n    if (c != 11) return s;\n    ss = {\n      0: 'Bank Select MSB',\n      1: 'Modulation Wheel MSB',\n      2: 'Breath Controller MSB',\n      4: 'Foot Controller MSB',\n      5: 'Portamento Time MSB',\n      6: 'Data Entry MSB',\n      7: 'Channel Volume MSB',\n      8: 'Balance MSB',\n      10: 'Pan MSB',\n      11: 'Expression Controller MSB',\n      12: 'Effect Control 1 MSB',\n      13: 'Effect Control 2 MSB',\n      16: 'General Purpose Controller 1 MSB',\n      17: 'General Purpose Controller 2 MSB',\n      18: 'General Purpose Controller 3 MSB',\n      19: 'General Purpose Controller 4 MSB',\n      31: 'Karaoke',\n      32: 'Bank Select LSB',\n      33: 'Modulation Wheel LSB',\n      34: 'Breath Controller LSB',\n      36: 'Foot Controller LSB',\n      37: 'Portamento Time LSB',\n      38: 'Data Entry LSB',\n      39: 'Channel Volume LSB',\n      40: 'Balance LSB',\n      42: 'Pan LSB',\n      43: 'Expression Controller LSB',\n      44: 'Effect control 1 LSB',\n      45: 'Effect control 2 LSB',\n      48: 'General Purpose Controller 1 LSB',\n      49: 'General Purpose Controller 2 LSB',\n      50: 'General Purpose Controller 3 LSB',\n      51: 'General Purpose Controller 4 LSB',\n      64: 'Damper Pedal',\n      65: 'Portamento',\n      66: 'Sostenuto',\n      67: 'Soft Pedal',\n      68: 'Legato',\n      69: 'Hold 2',\n      70: 'Sound Variation',\n      71: 'Filter Resonance',\n      72: 'Release Time',\n      73: 'Attack Time',\n      74: 'Brightness',\n      75: 'Decay Time',\n      76: 'Vibrato Rate',\n      77: 'Vibrato Depth',\n      78: 'Vibrato Delay',\n      79: 'Sound Controller 10',\n      80: 'General Purpose Controller 5',\n      81: 'General Purpose Controller 6',\n      82: 'General Purpose Controller 7',\n      83: 'General Purpose Controller 8',\n      84: 'Portamento Control',\n      88: 'High Resolution Velocity Prefix',\n      91: 'Effects 1 Depth',\n      92: 'Effects 2 Depth',\n      93: 'Effects 3 Depth',\n      94: 'Effects 4 Depth',\n      95: 'Effects 5 Depth',\n      96: 'Data Increment',\n      97: 'Data Decrement',\n      98: 'Non-Registered Parameter Number LSB',\n      99: 'Non-Registered Parameter Number MSB',\n      100: 'Registered Parameter Number LSB',\n      101: 'Registered Parameter Number MSB',\n      120: 'All Sound Off',\n      121: 'Reset All Controllers',\n      122: 'Local Control On/Off',\n      123: 'All Notes Off',\n      124: 'Omni Mode Off',\n      125: 'Omni Mode On',\n      126: 'Mono Mode On',\n      127: 'Poly Mode On'\n    }[this[1]];\n    if (this[1] >= 64 && this[1] <= 69) ss += this[2] < 64 ? ' Off' : ' On';\n    if (!ss) ss = 'Undefined';\n    return s + ' -- ' + ss;\n  };\n  MIDI.prototype._stamp = function(obj) { this._from.push(obj._orig ? obj._orig : obj); return this; };\n  MIDI.prototype._unstamp = function(obj) {\n    if (typeof obj == 'undefined') this._from = [];\n    else {\n      if (obj._orig) obj = obj._orig;\n      var i = this._from.indexOf(obj);\n      if (i > -1) this._from.splice(i, 1);\n    }\n    return this;\n  };\n  MIDI.prototype._stamped = function(obj) {\n    if (obj._orig) obj = obj._orig;\n    for (var i = 0; i < this._from.length; i++) if (this._from[i] == obj) return true;\n    return false;\n  };\n\n  JZZ.MIDI = MIDI;\n  _J.prototype.MIDI = MIDI;\n\n  function _clear_ctxt() {\n    var i;\n    this._cc = [];\n    for (i = 0; i < 16; i++) this._cc[i] = {};\n  }\n  function _rpn_txt(msb, lsb) {\n    var a = typeof msb == 'undefined' ? '??' : __hex(msb);\n    var b = typeof lsb == 'undefined' ? '??' : __hex(lsb);\n    var c = {\n      '0000': 'Pitch Bend Sensitivity',\n      '0001': 'Channel Fine Tune',\n      '0002': 'Channel Coarse Tune',\n      '0003': 'Select Tuning Program',\n      '0004': 'Select Tuning Bank',\n      '0005': 'Vibrato Depth Range',\n      '7f7f': 'NONE'\n    }[a + '' + b];\n    return 'RPN ' + a + ' ' + b + (c ? ': ' + c : '');\n  }\n  function _nrpn_txt(msb, lsb) {\n    var a = typeof msb == 'undefined' ? '??' : __hex(msb);\n    var b = typeof lsb == 'undefined' ? '??' : __hex(lsb);\n    return 'NRPN ' + a + ' ' + b;\n  }\n  function _read_ctxt(msg) {\n    if (!msg.length || msg[0] < 0x80) return msg;\n    if (msg[0] == 0xff) { this._clear(); return msg; }\n    var ch = msg[0] & 15;\n    var st = msg[0] >> 4;\n    var s;\n    if (st == 12) {\n      msg._bm = this._cc[ch].bm;\n      msg._bl = this._cc[ch].bl;\n      if (JZZ.MIDI.programName) msg.label(JZZ.MIDI.programName(msg[1], msg._bm, msg._bl));\n    }\n    else if (st == 11) {\n      switch (msg[1]) {\n        case 0: this._cc[ch].bm = msg[2]; break;\n        case 32: this._cc[ch].bl = msg[2]; break;\n        case 98: this._cc[ch].nl = msg[2]; this._cc[ch].rn = 'n'; break;\n        case 99: this._cc[ch].nm = msg[2]; this._cc[ch].rn = 'n'; break;\n        case 100: this._cc[ch].rl = msg[2]; this._cc[ch].rn = 'r'; break;\n        case 101: this._cc[ch].rm = msg[2]; this._cc[ch].rn = 'r'; break;\n        case 6: case 38: case 96: case 97:\n          if (this._cc[ch].rn == 'r') {\n            msg._rm = this._cc[ch].rm;\n            msg._rl = this._cc[ch].rl;\n            msg.label(_rpn_txt(this._cc[ch].rm, this._cc[ch].rl));\n          }\n          if (this._cc[ch].rn == 'n') {\n            msg._nm = this._cc[ch].rm;\n            msg._nl = this._cc[ch].nl;\n            msg.label(_nrpn_txt(this._cc[ch].nm, this._cc[ch].nl));\n          }\n          break;\n      }\n    }\n    else if (msg.isFullSysEx()) {\n      if (msg[1] == 0x7f) {\n        if (msg[3] == 4) {\n          s = { 1: 'Master Volume', 2: 'Master Balance', 3: 'Master Fine Tuning', 4: 'Master Coarse Tuning' }[msg[4]];\n          if (s) msg.label(s);\n        }\n        else if (msg[3] == 8) {\n          s = { 2: 'Note Tuning', 7: 'Note Tuning, Bank', 8: 'Scale Tuning, 1 byte format', 9: 'Scale Tuning, 2 byte format' }[msg[4]];\n          if (s) msg.label(s);\n        }\n      }\n      else if (msg[1] == 0x7e) {\n        if (msg[3] == 6) {\n          if (msg[4] == 1) msg.label('Device ID Request');\n          else if (msg[4] == 2) {\n            msg.label('Device ID Response');\n          }\n        }\n        else if (msg[3] == 8) {\n          s = {\n            0: 'Bulk Tuning Dump Request', 1: 'Bulk Tuning Dump', 3: 'Bulk Tuning Dump Request, Bank', 4: 'Bulk Tuning Dump, Bank',\n            5: 'Scale Tuning Dump, 1 byte format', 6: 'Scale Tuning Dump, 2 byte format',\n            7: 'Note Tuning, Bank', 8: 'Scale Tuning, 1 byte format', 9: 'Scale Tuning, 2 byte format'\n          }[msg[4]];\n          if (s) msg.label(s);\n        }\n        else if (msg[3] == 9) {\n          if (msg[4] == 1) { msg.label('GM1 System On'); this._clear(); this._gm = '1'; }\n          else if (msg[4] == 2) { msg.label('GM System Off'); this._clear(); this._gm = '0'; }\n          else if (msg[4] == 3) { msg.label('GM2 System On'); this._clear(); this._gm = '2'; }\n        }\n      }\n      else if (msg[1] == 0x43) {\n        if ((msg[2] & 0xf0) == 0x10 && msg[3] == 0x4c) {\n          if (msg[4] == 0 && msg[5] == 0 && msg[6] == 0x7e && msg[7] == 0) {\n            msg.label('XG System On'); this._clear(); this._gm = 'Y';\n          }\n          else if (msg[4] == 0 && msg[5] == 0 && msg[6] == 0) msg.label('XG Master Tuning');\n          else if (msg[4] == 0 && msg[5] == 0 && msg[6] == 4) msg.label('XG Master Volume');\n          else if (msg[4] == 0 && msg[5] == 0 && msg[6] == 6) msg.label('XG Master Transpose');\n          else if (msg[4] == 8 && msg[5] < 16 && msg[6] >= 0x41 && msg[6] <= 0x4c) msg.label('XG Scale Tuning');\n          else  msg.label('XG Parameter');\n        }\n      }\n      else if (msg[1] == 0x41) {\n        if (msg[3] == 0x42 && msg[4] == 0x12) {\n          if (msg[5] == 0x40) {\n            if (msg[6] == 0) {\n              if (msg[7] == 0x7f && msg[8] == 0 && msg[9] == 0x41) {\n                msg.label('GS Reset'); this._clear(); this._gm = 'R';\n              }\n              else if (msg[7] == 0) msg.label('GS Master Tuning');\n              else if (msg[7] == 4) msg.label('GS Master Volume');\n              else if (msg[7] == 5) msg.label('GS Master Transpose');\n              else msg.label('GS Parameter');\n            }\n            else if ((msg[6] & 0xf0) == 0x10 && msg[7] == 0x15) msg.label('GS Drum Part Change');\n            else if ((msg[6] & 0xf0) == 0x10 && msg[7] >= 0x40 && msg[7] <= 0x4b) msg.label('GS Scale Tuning');\n            else msg.label('GS Parameter');\n          }\n          if (msg[5] == 0x41) msg.label('GS Parameter');\n        }\n      }\n    }\n    return msg;\n  }\n  function Context() {\n    var self = new _M();\n    self._clear = _clear_ctxt;\n    self._read = _read_ctxt;\n    self._receive = function(msg) { this._emit(this._read(msg)); };\n    self._clear();\n    self._resume();\n    return self;\n  }\n  JZZ.Context = Context;\n  _J.prototype.Context = Context;\n\n  function MPE() {\n    var self = this instanceof MPE ? this : self = new MPE();\n    self.reset();\n    if (arguments.length) MPE.prototype.setup.apply(self, arguments);\n    return self;\n  }\n  MPE.validate = function(arg) {\n    var a = arg instanceof Array ? arg : arguments;\n    if (a[0] != parseInt(a[0]) || a[0] < 0 || a[0] > 14) throw RangeError('Bad master channel value: ' + a[0]);\n    if (a[1] != parseInt(a[1]) || a[1] < 0 || a[0] + a[1] > 15) throw RangeError('Bad zone size value: ' + a[1]);\n  };\n  MPE.prototype.reset = function() { for (var n = 0; n < 16; n++) this[n] = { band: 0, master: n }; };\n  MPE.prototype.setup = function(m, n) {\n    MPE.validate(m, n);\n    var k;\n    var last = m + n;\n    if (this[m].master == m && this[m].band == n) return;\n    if (!n && !this[m].band) return;\n    if (this[m].band) {\n      k = m + this[m].band;\n      if (last < k) last = k;\n    }\n    else if (this[m].master == m - 1) {\n      k = m - 1;\n      k = k + this[k].band;\n      if (last < k) last = k;\n      this[m - 1] = { band: 0, master: m - 1 };\n    }\n    else if (this[m].master != m) {\n      k = this[m].master;\n      k = k + this[k].band;\n      if (last < k) last = k;\n      this[this[m].master].band = m - this[m].master - 1;\n    }\n    this[m].master = m;\n    this[m].band = n;\n    for (k = m + 1; k <= m + n; k++) {\n      if (this[k].band && last < k + this[k].band) last = k + this[k].band;\n      this[k] = { band: 0, master: m };\n    }\n    for (; k <= last; k++) this[k] = { band: 0, master: k };\n  };\n  MPE.prototype.filter = function(msg) {\n    var c = msg.getChannel();\n    if (!this[c] || !this[this[c].master].band) return msg;\n    var m = this[c].master;\n    var n = this[m].band;\n    var i, j, k;\n    if (typeof msg._mpe != 'undefined') {\n      k = 256;\n      for (i = m + 1; i <= m + n; i++) {\n        if (!this[i].notes) {\n          if (k > 0) { c = i; k = 0; }\n        }\n        else {\n          if (k > this[i].notes.length) { c = i; k = this[i].notes.length; }\n          for (j = 0; j < this[i].notes.length; j++) {\n            if (this[i].notes[j] == msg._mpe) { c = i; k = -1; break; }\n          }\n        }\n      }\n      msg.setChannel(c);\n      msg._mpe = undefined;\n    }\n    if (c == m) return msg; // bad mpe\n    if (msg.isNoteOn()) {\n      if (!this[c].notes) this[c].notes = [];\n      _push(this[c].notes, msg.getNote());\n    }\n    else if (msg.isNoteOff()) {\n      if (this[c].notes) _pop(this[c].notes, msg.getNote());\n    }\n    return msg;\n  };\n  JZZ.MPE = MPE;\n\n  JZZ.lib = {};\n  JZZ.lib.now = _now;\n  JZZ.lib.schedule = _schedule;\n  var _sch_list = [];\n  var _sch_worker;\n  var _sch_count = 0;\n  try {\n    var _blob = URL.createObjectURL(new Blob(['(', function() {\n      function tick() {\n        postMessage({});\n        setTimeout(tick, 0);\n      }\n      tick();\n    }.toString(), ')()'], { type: 'application/javascript' }));\n    var _sch_tick = function() {\n      var n = _sch_list.length;\n      // cannot use i < _sch_list.length !\n      for (var i = 0; i < n; i++) _sch_list.shift()();\n      _sch_count++;\n      if (_sch_count > 20 && _sch_worker) {\n        _sch_worker.terminate();\n        _sch_worker = undefined;\n      }\n    };\n    var _sch = function(x) {\n      _sch_list.push(x);\n      _sch_count = 0;\n      if (!_sch_worker) {\n        _sch_worker = new Worker(_blob);\n        _sch_worker.onmessage = _sch_tick;\n      }\n    };\n    _sch(function() { JZZ.lib.schedule = _sch; });\n  }\n  catch (e) {}\n\n  JZZ.lib.openMidiOut = function(name, engine) {\n    var port = new _M();\n    engine._openOut(port);\n    port._info = engine._info(name);\n    return port;\n  };\n  JZZ.lib.openMidiIn = function(name, engine) {\n    var port = new _M();\n    engine._openIn(port);\n    port._info = engine._info(name);\n    return port;\n  };\n  JZZ.lib.registerMidiOut = function(name, engine) {\n    var x = engine._info(name);\n    for (var i = 0; i < _virtual._outs.length; i++) if (_virtual._outs[i].name == x.name) return false;\n    x.engine = engine;\n    _virtual._outs.push(x);\n    if (_jzz) {\n      _postRefresh();\n      if (_jzz._bad) { _jzz._repair(); _jzz._resume(); }\n    }\n    return true;\n  };\n  JZZ.lib.registerMidiIn = function(name, engine) {\n    var x = engine._info(name);\n    for (var i = 0; i < _virtual._ins.length; i++) if (_virtual._ins[i].name == x.name) return false;\n    x.engine = engine;\n    _virtual._ins.push(x);\n    if (_jzz) {\n      _postRefresh();\n      if (_jzz._bad) { _jzz._repair(); _jzz._resume(); }\n    }\n    return true;\n  };\n  var _ac;\n  function _initAudioContext() {\n    if (!_ac && typeof window !== 'undefined') {\n      var AudioContext = window.AudioContext || window.webkitAudioContext;\n      if (AudioContext) {\n        _ac = new AudioContext();\n        if (_ac && !_ac.createGain) _ac.createGain = _ac.createGainNode;\n        var _activateAudioContext = function() {\n          if (_ac.state != 'running') {\n            _ac.resume();\n            var osc = _ac.createOscillator();\n            var gain = _ac.createGain();\n            try { gain.gain.value = 0; } catch (err) {}\n            gain.gain.setTargetAtTime(0, _ac.currentTime, 0.01);\n            osc.connect(gain);\n            gain.connect(_ac.destination);\n            if (!osc.start) osc.start = osc.noteOn;\n            if (!osc.stop) osc.stop = osc.noteOff;\n            osc.start(0.1); osc.stop(0.11);\n          }\n          else if (typeof document != 'undefined') {\n            document.removeEventListener('touchstart', _activateAudioContext);\n            document.removeEventListener('touchend', _activateAudioContext);\n            document.removeEventListener('mousedown', _activateAudioContext);\n            document.removeEventListener('keydown', _activateAudioContext);\n          }\n        };\n        if (typeof document != 'undefined') {\n          document.addEventListener('touchstart', _activateAudioContext);\n          document.addEventListener('touchend', _activateAudioContext);\n          document.addEventListener('mousedown', _activateAudioContext);\n          document.addEventListener('keydown', _activateAudioContext);\n        }\n        _activateAudioContext();\n      }\n    }\n  }\n  JZZ.lib.copyMidiHelpers = _copyMidiHelpers;\n  JZZ.lib.getAudioContext = function() { _initAudioContext(); return _ac; };\n  var _b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n  JZZ.lib.fromBase64 = function(input) {\n    var output = '';\n    var chr1, chr2, chr3;\n    var enc1, enc2, enc3, enc4;\n    var i = 0;\n    input = input.replace(/[^A-Za-z0-9+/=]/g, '');\n    while (i < input.length) {\n      enc1 = _b64.indexOf(input.charAt(i++));\n      enc2 = _b64.indexOf(input.charAt(i++));\n      enc3 = _b64.indexOf(input.charAt(i++));\n      enc4 = _b64.indexOf(input.charAt(i++));\n      chr1 = (enc1 << 2) | (enc2 >> 4);\n      chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n      chr3 = ((enc3 & 3) << 6) | enc4;\n      output = output + String.fromCharCode(chr1);\n      if (enc3 != 64) {\n        output = output + String.fromCharCode(chr2);\n      }\n      if (enc4 != 64) {\n        output = output + String.fromCharCode(chr3);\n      }\n    }\n    return output;\n  };\n  JZZ.lib.toBase64 = function(data) {\n    var o1, o2, o3, h1, h2, h3, h4, bits, i = 0, ac = 0, enc = '', arr = [];\n    if (!data) return data;\n    do {\n      o1 = data.charCodeAt(i++);\n      o2 = data.charCodeAt(i++);\n      o3 = data.charCodeAt(i++);\n      bits = o1 << 16 | o2 << 8 | o3;\n      h1 = bits >> 18 & 0x3f;\n      h2 = bits >> 12 & 0x3f;\n      h3 = bits >> 6 & 0x3f;\n      h4 = bits & 0x3f;\n      arr[ac++] = _b64.charAt(h1) + _b64.charAt(h2) + _b64.charAt(h3) + _b64.charAt(h4);\n    } while(i < data.length);\n    enc = arr.join('');\n    var r = data.length % 3;\n    return (r ? enc.slice(0, r - 3) + '==='.slice(r) : enc);\n  };\n  JZZ.lib.fromUTF8 = function(data) {\n    data = typeof data == 'undefined' ? '' : '' + data;\n    var out = '';\n    var i, n, m;\n    for (i = 0; i < data.length; i++) {\n      n = data.charCodeAt(i);\n      if (n > 0xff) return data;\n      if (n < 0x80) out += data[i];\n      else if ((n & 0xe0) == 0xc0) {\n        n = (n & 0x1f) << 6;\n        i++; if (i >= data.length) return data;\n        m = data.charCodeAt(i);\n        if ((m & 0xc0) != 0x80) return data;\n        n += (m & 0x3f);\n        out += String.fromCharCode(n);\n      }\n      else if ((n & 0xf0) == 0xe0) {\n        n = (n & 0x0f) << 12;\n        i++; if (i >= data.length) return data;\n        m = data.charCodeAt(i);\n        if ((m & 0xc0) != 0x80) return data;\n        n += (m & 0x3f) << 6;\n        i++; if (i >= data.length) return data;\n        m = data.charCodeAt(i);\n        if ((m & 0xc0) != 0x80) return data;\n        n += (m & 0x3f);\n        out += String.fromCharCode(n);\n      }\n      else if ((n & 0xf8) == 0xf0) {\n        n = (n & 0x07) << 18;\n        i++; if (i >= data.length) return data;\n        m = data.charCodeAt(i);\n        if ((m & 0xc0) != 0x80) return data;\n        n += (m & 0x3f) << 12;\n        i++; if (i >= data.length) return data;\n        m = data.charCodeAt(i);\n        if ((m & 0xc0) != 0x80) return data;\n        n += (m & 0x3f) << 6;\n        i++; if (i >= data.length) return data;\n        m = data.charCodeAt(i);\n        if ((m & 0xc0) != 0x80) return data;\n        n += (m & 0x3f);\n        if (n > 0x10ffff) return data;\n        n -= 0x10000;\n        out += String.fromCharCode(0xd800 + (n >> 10));\n        out += String.fromCharCode(0xdc00 + (n & 0x3ff));\n      }\n    }\n    return out;\n  };\n  JZZ.lib.toUTF8 = function(data) {\n    data = typeof data == 'undefined' ? '' : '' + data;\n    var out = '';\n    var i, n;\n    for (i = 0; i < data.length; i++) {\n      n = data.charCodeAt(i);\n      if (n < 0x80) out += data[i];\n      else if (n < 0x800) {\n        out += String.fromCharCode(0xc0 + (n >> 6));\n        out += String.fromCharCode(0x80 + (n & 0x3f));\n      }\n      else if (n < 0x10000) {\n        out += String.fromCharCode(0xe0 + (n >> 12));\n        out += String.fromCharCode(0x80 + ((n >> 6) & 0x3f));\n        out += String.fromCharCode(0x80 + (n & 0x3f));\n      }\n      /* istanbul ignore next */\n      else {\n        out += String.fromCharCode(0xf0 + (n >> 18));\n        out += String.fromCharCode(0x80 + ((n >> 12) & 0x3f));\n        out += String.fromCharCode(0x80 + ((n >> 6) & 0x3f));\n        out += String.fromCharCode(0x80 + (n & 0x3f));\n      }\n    }\n    return out;\n  };\n\n  // Web MIDI API\n  var _wma = [];\n  var _outputMap = {};\n  var _inputMap = {};\n\n  var Promise = _scope.Promise;\n  /* istanbul ignore next */\n  if (typeof Promise !== 'function') {\n    Promise = function(executor) {\n      this.executor = executor;\n    };\n    Promise.prototype.then = function(resolve, reject) {\n      if (typeof resolve !== 'function') {\n        resolve = _nop;\n      }\n      if (typeof reject !== 'function') {\n        reject = _nop;\n      }\n      this.executor(resolve, reject);\n    };\n  }\n  function DOMException(name, message, code) {\n    this.name = name;\n    this.message = message;\n    this.code = code;\n  }\n\n  function MIDIConnectionEvent(port, target) {\n    this.bubbles = false;\n    this.cancelBubble = false;\n    this.cancelable = false;\n    this.currentTarget = target;\n    this.defaultPrevented = false;\n    this.eventPhase = 0;\n    this.path = [];\n    this.port = port;\n    this.returnValue = true;\n    this.srcElement = target;\n    this.target = target;\n    this.timeStamp = _now();\n    this.type = 'statechange';\n  }\n\n  function MIDIMessageEvent(port, data) {\n    this.bubbles = false;\n    this.cancelBubble = false;\n    this.cancelable = false;\n    this.currentTarget = port;\n    this.data = data;\n    this.defaultPrevented = false;\n    this.eventPhase = 0;\n    this.path = [];\n    this.receivedTime = _now();\n    this.returnValue = true;\n    this.srcElement = port;\n    this.target = port;\n    this.timeStamp = this.receivedTime;\n    this.type = 'midimessage';\n  }\n\n  function _statechange(p, a) {\n    if (p) {\n      if (p.onstatechange) p.onstatechange(new MIDIConnectionEvent(p, p));\n      if (a.onstatechange) a.onstatechange(new MIDIConnectionEvent(p, a));\n    }\n  }\n\n  function MIDIInput(a, p) {\n    var self = this;\n    var _open = false;\n    var _ochng = null;\n    var _onmsg = null;\n    this.type = 'input';\n    this.id = p.id;\n    this.name = p.name;\n    this.manufacturer = p.man;\n    this.version = p.ver;\n    Object.defineProperty(this, 'state', { get: function() { return p.connected ? 'connected' : 'disconnected'; }, enumerable: true });\n    Object.defineProperty(this, 'connection', { get: function() {\n      return _open ? p.proxy ? 'open' : 'pending' : 'closed';\n    }, enumerable: true });\n    Object.defineProperty(this, 'onmidimessage', {\n      get: function() { return _onmsg; },\n      set: function(value) {\n        if (_func(value)) {\n          _onmsg = value;\n          if (!_open) self.open().then(_nop, _nop);\n        }\n        else _onmsg = null;\n      },\n      enumerable: true\n    });\n    Object.defineProperty(this, 'onstatechange', {\n      get: function() { return _ochng; },\n      set: function(value) {\n        if (_func(value)) _ochng = value;\n        else _ochng = null;\n      },\n      enumerable: true\n    });\n    this.open = function() {\n      return new Promise(function(resolve, reject) {\n        if (_open) resolve(self);\n        else {\n          p.open().then(function() {\n            if (!_open) {\n              _open = true;\n              _statechange(self, a);\n            }\n            resolve(self);\n          }, function() {\n            reject(new DOMException('InvalidAccessError', 'Port is not available', 15));\n          });\n        }\n      });\n    };\n    this.close = function() {\n      return new Promise(function(resolve/*, reject*/) {\n        if (_open) {\n          _open = false;\n          p.close();\n          _statechange(self, a);\n        }\n        resolve(self);\n      });\n    };\n    Object.freeze(this);\n  }\n\n  function _split(q) {\n    var i, k;\n    while (q.length) {\n      for (i = 0; i < q.length; i++) if (q[i] == parseInt(q[i]) && q[i] >= 0x80 && q[i] <= 0xff && q[i] != 0xf7) break;\n      q.splice(0, i);\n      if (!q.length) return;\n      if (q[0] == 0xf0) {\n        for (i = 1; i < q.length; i++) if (q[i] == 0xf7) break;\n        if (i == q.length) return;\n        return q.splice(0, i + 1);\n      }\n      else {\n        k = _datalen(q[0]) + 1;\n        if (k > q.length) return;\n        for (i = 1; i < k; i++) if (q[i] != parseInt(q[i]) || q[i] < 0 || q[i] >= 0x80) break;\n        if (i == k) return q.splice(0, i);\n        else q.splice(0, i);\n      }\n    }\n  }\n\n  function _InputProxy(id, name, man, ver) {\n    var self = this;\n    this.id = id;\n    this.name = name;\n    this.man = man;\n    this.ver = ver;\n    this.connected = true;\n    this.ports = [];\n    this.pending = [];\n    this.proxy = undefined;\n    this.queue = [];\n    this.onmidi = function(msg) {\n      var m;\n      self.queue = self.queue.concat(msg.slice());\n      for (m = _split(self.queue); m; m = _split(self.queue)) {\n        for (i = 0; i < self.ports.length; i++) {\n          if (self.ports[i][0].onmidimessage && (m[0] != 0xf0 || self.ports[i][1])) {\n            self.ports[i][0].onmidimessage(new MIDIMessageEvent(self, new Uint8Array(m)));\n          }\n        }\n      }\n    };\n  }\n  _InputProxy.prototype.open = function() {\n    var self = this;\n    return new Promise(function(resolve, reject) {\n      var i;\n      if (self.proxy || !self.connected) resolve();\n      else {\n        self.pending.push([resolve, reject]);\n        if (self.pending.length == 1) {\n          JZZ().openMidiIn(self.name).or(function() {\n            for (i = 0; i < self.pending.length; i++) self.pending[i][1]();\n            self.pending = [];\n          }).and(function() {\n            self.proxy = this;\n            self.proxy.connect(self.onmidi);\n            for (i = 0; i < self.pending.length; i++) self.pending[i][0]();\n            self.pending = [];\n          });\n        }\n      }\n    });\n  };\n  _InputProxy.prototype.close = function() {\n    var i;\n    if (this.proxy) {\n      for (i = 0; i < this.ports.length; i++) if (this.ports[i].connection == 'open') return;\n      this.proxy.close();\n      this.proxy = undefined;\n    }\n  };\n  _InputProxy.prototype.disconnect = function() {\n    this.connected = false;\n    if (this.proxy) {\n      this.proxy.close();\n      this.proxy = undefined;\n    }\n  };\n  _InputProxy.prototype.reconnect = function() {\n    var self = this;\n    var i, p;\n    var a = [];\n    this.connected = true;\n    for (i = 0; i < _wma.length; i++) {\n      p = _wma[i].inputs.get(this.id);\n      if (p.connection == 'closed') _statechange(p, _wma[i]);\n      else a.push([p, _wma[i]]);\n    }\n    if (a.length) {\n      JZZ()._openMidiInNR(self.name).or(function() {\n        for (i = 0; i < a.length; i++) a[i][0].close();\n      }).and(function() {\n        self.proxy = this;\n        self.proxy.connect(self.onmidi);\n        for (i = 0; i < a.length; i++) _statechange(a[i][0], a[i][1]);\n      });\n    }\n  };\n\n  function _datalen(x) {\n    if (x >= 0x80 && x <= 0xbf || x >= 0xe0 && x <= 0xef || x == 0xf2) return 2;\n    if (x >= 0xc0 && x <= 0xdf || x == 0xf1 || x == 0xf3) return 1;\n    return 0;\n  }\n\n  var _epr = \"Failed to execute 'send' on 'MIDIOutput': \";\n\n  function _validate(arr, sysex) {\n    var i, k;\n    var msg;\n    var data = [];\n    for (i = 0; i < arr.length; i++) {\n      if (arr[i] != parseInt(arr[i]) || arr[i] < 0 || arr[i] > 255) throw TypeError(_epr + arr[i] + ' is not a UInt8 value.');\n    }\n    k = 0;\n    for (i = 0; i < arr.length; i++) {\n      if (!k) {\n        if (arr[i] < 0x80) throw TypeError(_epr + 'Running status is not allowed at index ' + i + ' (' + arr[i] + ').');\n        if (arr[i] == 0xf7) throw TypeError(_epr + 'Unexpected end of system exclusive message at index ' + i + ' (' + arr[i] + ').');\n        msg = [arr[i]];\n        data.push(msg);\n        if (arr[i] == 0xf0) {\n          if (!sysex) throw new DOMException('InvalidAccessError', _epr + 'System exclusive messag is not allowed at index ' + i + ' (' + arr[i] + ').', 15);\n          k = -1;\n          for (; i < arr.length; i++) {\n            msg.push(arr[i]);\n            if (arr[i] == 0xf7) {\n              k = 0;\n              break;\n            }\n          }\n        }\n        else {\n          k = _datalen(arr[i]);\n        }\n      }\n      else {\n        if (arr[i] > 0x7f) throw TypeError(_epr + 'Unexpected status byte at index ' + i + ' (' + arr[i] + ').');\n        msg.push(arr[i]);\n        k--;\n      }\n    }\n    if (k) throw TypeError(_epr + 'Message is incomplete');\n    return [data];\n  }\n\n  function MIDIOutput(a, p) {\n    var self = this;\n    var _open = false;\n    var _ochng = null;\n    this.type = 'output';\n    this.id = p.id;\n    this.name = p.name;\n    this.manufacturer = p.man;\n    this.version = p.ver;\n    Object.defineProperty(this, 'state', { get: function() { return p.connected ? 'connected' : 'disconnected'; }, enumerable: true });\n    Object.defineProperty(this, 'connection', { get: function() {\n      return _open ? p.proxy ? 'open' : 'pending' : 'closed';\n    }, enumerable: true });\n    Object.defineProperty(this, 'onstatechange', {\n      get: function() { return _ochng; },\n      set: function(value) {\n        if (_func(value)) _ochng = value;\n        else _ochng = null;\n      },\n      enumerable: true\n    });\n    this.open = function() {\n      return new Promise(function(resolve, reject) {\n        if (_open) resolve(self);\n        else {\n          p.open().then(function() {\n            if (!_open) {\n              _open = true;\n              _statechange(self, a);\n            }\n            resolve(self);\n          }, function() {\n            reject(new DOMException('InvalidAccessError', 'Port is not available', 15));\n          });\n        }\n      });\n    };\n    this.close = function() {\n      return new Promise(function(resolve/*, reject*/) {\n        if (_open) {\n          _open = false;\n          self.clear();\n          p.close();\n          _statechange(self, a);\n        }\n        resolve(self);\n      });\n    };\n    this.clear = function() {\n    };\n    this.send = function(data, timestamp) {\n      _validate(data, a.sysexEnabled);\n      if (!p.connected) throw new DOMException('InvalidStateError', 'Port is not connected', 11);\n      if (_open) {\n        var now = _now();\n        if (timestamp > now) setTimeout(function() { p.proxy.send(data); }, timestamp - now);\n        else p.proxy.send(data);\n      }\n      else this.open().then(function() { self.send(data, timestamp); }, _nop);\n    };\n    Object.freeze(this);\n  }\n\n  function _OutputProxy(id, name, man, ver) {\n    this.id = id;\n    this.name = name;\n    this.man = man;\n    this.ver = ver;\n    this.connected = true;\n    this.ports = [];\n    this.pending = [];\n    this.proxy = undefined;\n  }\n  _OutputProxy.prototype.open = function() {\n    var self = this;\n    return new Promise(function(resolve, reject) {\n      var i;\n      if (self.proxy || !self.connected) resolve();\n      else {\n        self.pending.push([resolve, reject]);\n        if (self.pending.length == 1) {\n          JZZ().openMidiOut(self.name).or(function() {\n            for (i = 0; i < self.pending.length; i++) self.pending[i][1]();\n            self.pending = [];\n          }).and(function() {\n            self.proxy = this;\n            for (i = 0; i < self.pending.length; i++) self.pending[i][0]();\n            self.pending = [];\n          });\n        }\n      }\n    });\n  };\n  _OutputProxy.prototype.close = function() {\n    var i;\n    if (this.proxy) {\n      for (i = 0; i < this.ports.length; i++) if (this.ports[i].connection == 'open') return;\n      this.proxy.close();\n      this.proxy = undefined;\n    }\n  };\n  _OutputProxy.prototype.disconnect = function() {\n    this.connected = false;\n    if (this.proxy) {\n      this.proxy.close();\n      this.proxy = undefined;\n    }\n  };\n  _OutputProxy.prototype.reconnect = function() {\n    var self = this;\n    var i, p;\n    var a = [];\n    this.connected = true;\n    for (i = 0; i < _wma.length; i++) {\n      p = _wma[i].outputs.get(this.id);\n      if (p.connection == 'closed') _statechange(p, _wma[i]);\n      else a.push([p, _wma[i]]);\n    }\n    if (a.length) {\n      JZZ()._openMidiOutNR(self.name).or(function() {\n        for (i = 0; i < a.length; i++) a[i][0].close();\n      }).and(function() {\n        self.proxy = this;\n        for (i = 0; i < a.length; i++) _statechange(a[i][0], a[i][1]);\n      });\n    }\n  };\n\n  function _Maplike(data) {\n    this.has = function(id) {\n      return data.hasOwnProperty(id) && data[id].connected;\n    };\n    this.keys = function() {\n      try { // some old browsers may have no Map object\n        var m = new Map();\n        for (var id in data) if (this.has(id)) m.set(id, this.get(id));\n        return m.keys();\n      } catch (e) {}\n    };\n    this.values = function() {\n      try {\n        var m = new Map();\n        for (var id in data) if (this.has(id)) m.set(id, this.get(id));\n        return m.values();\n      } catch (e) {}\n    };\n    this.entries = function() {\n      try {\n        var m = new Map();\n        for (var id in data) if (this.has(id)) m.set(id, this.get(id));\n        return m.entries();\n      } catch (e) {}\n    };\n    this.forEach = function(fun, self) {\n      if (typeof self == 'undefined') self = this;\n      for (var id in data) if (this.has(id)) fun.call(self, this.get(id), id, this);\n    };\n    Object.defineProperty(this, 'size', {\n      get: function() {\n        var len = 0;\n        for (var id in data) if (this.has(id)) len++;\n        return len;\n      },\n      enumerable: true\n    });\n  }\n\n  function MIDIInputMap(_access, _inputs) {\n    this.get = function(id) {\n      if (_inputMap.hasOwnProperty(id) && _inputMap[id].connected) {\n        if (!_inputs[id]) {\n          _inputs[id] = new MIDIInput(_access, _inputMap[id]);\n          _inputMap[id].ports.push([_inputs[id], _access.sysexEnabled]);\n        }\n        return _inputs[id];\n      }\n    };\n    Object.freeze(this);\n  }\n  MIDIInputMap.prototype = new _Maplike(_inputMap);\n  MIDIInputMap.prototype.constructor = MIDIInputMap;\n\n  function MIDIOutputMap(_access, _outputs) {\n    this.get = function(id) {\n      if (_outputMap.hasOwnProperty(id) && _outputMap[id].connected) {\n        if (!_outputs[id]) {\n          _outputs[id] = new MIDIOutput(_access, _outputMap[id]);\n          _outputMap[id].ports.push([_outputs[id], _access.sysexEnabled]);\n        }\n        return _outputs[id];\n      }\n    };\n    Object.freeze(this);\n  }\n  MIDIOutputMap.prototype = new _Maplike(_outputMap);\n  MIDIOutputMap.prototype.constructor = MIDIOutputMap;\n\n  function _wm_watch(x) {\n    var i, k, p, a;\n    for (i = 0; i < x.inputs.added.length; i++) {\n      p = x.inputs.added[i];\n      if (!_inputMap.hasOwnProperty(p.id)) _inputMap[p.id] = new _InputProxy(p.id, p.name, p.manufacturer, p.version);\n      _inputMap[p.id].reconnect();\n    }\n    for (i = 0; i < x.outputs.added.length; i++) {\n      p = x.outputs.added[i];\n      if (!_outputMap.hasOwnProperty(p.id)) _outputMap[p.id] = new _OutputProxy(p.id, p.name, p.manufacturer, p.version);\n      _outputMap[p.id].reconnect();\n    }\n    for (i = 0; i < x.inputs.removed.length; i++) {\n      p = x.inputs.removed[i];\n      if (_inputMap.hasOwnProperty(p.id)) {\n        a = [];\n        for (k = 0; k < _wma.length; k++) a.push([_wma[k].inputs.get(p.id), _wma[k]]);\n        _inputMap[p.id].disconnect();\n        for (k = 0; k < a.length; k++) _statechange(a[k][0], a[k][1]);\n      }\n    }\n    for (i = 0; i < x.outputs.removed.length; i++) {\n      p = x.outputs.removed[i];\n      if (_outputMap.hasOwnProperty(p.id)) {\n        a = [];\n        for (k = 0; k < _wma.length; k++) a.push([_wma[k].outputs.get(p.id), _wma[k]]);\n        _outputMap[p.id].disconnect();\n        for (k = 0; k < a.length; k++) _statechange(a[k][0], a[k][1]);\n      }\n    }\n  }\n\n  function MIDIAccess(sysex) {\n    var _inputs = {};\n    var _outputs = {};\n    var _onstatechange = null;\n    var self = this;\n    this.sysexEnabled = sysex;\n    this.inputs = new MIDIInputMap(self, _inputs);\n    this.outputs = new MIDIOutputMap(self, _outputs);\n    Object.defineProperty(this, 'onstatechange', {\n      get: function() { return _onstatechange; },\n      set: function(f) { _onstatechange = _func(f) ? f : null; },\n      enumerable: true\n    });\n    Object.freeze(this);\n    var i;\n    var p;\n    var info = _jzz._info;\n    for (i = 0; i < info.inputs.length; i++) {\n      p = info.inputs[i];\n      if (!_inputMap.hasOwnProperty(p.id)) _inputMap[p.id] = new _InputProxy(p.id, p.name, p.manufacturer, p.version);\n    }\n    for (i = 0; i < info.outputs.length; i++) {\n      p = info.outputs[i];\n      if (!_outputMap.hasOwnProperty(p.id)) _outputMap[p.id] = new _OutputProxy(p.id, p.name, p.manufacturer, p.version);\n    }\n    if (!_wma.length) JZZ().onChange(_wm_watch);\n    _wma.push(this);\n  }\n\n  JZZ.requestMIDIAccess = function(opt) {\n    return new Promise(function(resolve, reject) {\n      JZZ.JZZ(opt).or(function() {\n      }).and(function() {\n        var sysex = !!(opt && opt.sysex);\n        if (sysex && !this.info().sysex) reject(new DOMException('SecurityError', 'Sysex is not allowed', 18));\n        else {\n          var wma = new MIDIAccess(sysex);\n          resolve(wma);\n        }\n      });\n    });\n  };\n  if (typeof navigator !== 'undefined' && !navigator.requestMIDIAccess) navigator.requestMIDIAccess = JZZ.requestMIDIAccess;\n  JZZ.close = function() { if (_engine._close) _engine._close(); };\n\n  return JZZ;\n});\n\n//export {JZZ}\n\n\n//# sourceURL=webpack://Synthesizer/./src/js/JZZ.js?");

/***/ }),

/***/ "./src/js/Share.js":
/*!*************************!*\
  !*** ./src/js/Share.js ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"MusicClip\": () => (/* binding */ MusicClip),\n/* harmony export */   \"MusicClipType\": () => (/* binding */ MusicClipType),\n/* harmony export */   \"MusicTrack\": () => (/* binding */ MusicTrack),\n/* harmony export */   \"SyntheysizerEvents\": () => (/* binding */ SyntheysizerEvents),\n/* harmony export */   \"TemplateClip\": () => (/* binding */ TemplateClip),\n/* harmony export */   \"VideoClip\": () => (/* binding */ VideoClip),\n/* harmony export */   \"dial_set\": () => (/* binding */ dial_set),\n/* harmony export */   \"joystick_set\": () => (/* binding */ joystick_set),\n/* harmony export */   \"note_set\": () => (/* binding */ note_set),\n/* harmony export */   \"pad_set\": () => (/* binding */ pad_set),\n/* harmony export */   \"poly_note_set\": () => (/* binding */ poly_note_set)\n/* harmony export */ });\nconst SyntheysizerEvents = window;\n\nconst note_set = {\n  pitch: 0,\n  note: 0,\n  value: 0\n};\nconst poly_note_set = {\n  pitch: [],\n  note : [],\n  value : []\n}\n\nconst pad_set = {\n  id: 0,\n  value: 0\n};\n\nconst dial_set = {\n  value: [[0.0, 0.0, 0.0, 0.0], \n          [0.0, 0.0, 0.0, 0.0]]  //순서대로  [21, 22, 23, 24]]\n}; \n\nconst joystick_set = {\n  value:[0, 0]\n};  \n\nconst MusicClipType = {\n  Mood: \"Mood\",\n  Melody: \"Melody\",\n  Beat: \"Beat\",\n  Lyrics:\"Lyrics\",\n  Template: \"Template\",\n  Total:\"Total\"\n}\n\nconst MusicNote = {\n  note:\"C0\",\n  intensity : 0.0,\n  start: 0.0,\n  end: -1.0\n}\nclass TemplateClip{\n  constructor(Clip_id, duration = 60, instrument = 0){\n    this.Clip_id = Clip_id;\n    this.duration = duration;\n    this.instrument = instrument;\n    this.dial_set = [[0.0, 0.0, 0.0, 0.0], \n                     [0.0, 0.0, 0.0, 0.0]]\n  }\n  set_dial(dial_set){\n    this.dial_set = dial_set\n  }\n  set_duration(duration){\n    this.duration = duration;\n  }\n  get_Clip_id(){\n    return this.Clip_id;\n  }\n  get_duration(){\n    return this.duration;\n  }\n  get_instrument(){\n    return this.instrument;\n  }\n  get_dial(){\n    return this.dial_set;\n  }\n}\n\nclass VideoObject{\n  constructor(videoId, videoData, videoDuration){{\n    this.videoId = videoId;\n    this.videoData = videoData;\n    this.videoDuration = videoDuration;\n  }}\n}\n\n\nclass VideoClip{\n  constructor (videoId = [], videoData = [], videoDuration = []){ \n    this.videoId = videoId;\n    this.videoData = videoData;\n    this.videoDuration = videoDuration;\n  }\n  setVideo(videoId, videoData, videoDuration){\n    this.videoId.push(videoId);\n    this.videoData.push(videoData);\n    this.videoDuration.push(videoDuration);\n  }\n  getVideoData(videoId){\n    if (videoId >= 0 && videoId < this.videoId.length){\n      // console.log(this.videoId)\n      // console.log(videoId)\n      // let index = this.videoId.indexOf(videoId);\n      // console.log(\"get id :\", videoId, \"index :\", index)\n      return this.videoData[videoId]\n    }\n    else{\n      console.log(\"Data index out of bounds\");\n      return null\n    }\n  }\n  getVideoDuration(videoId){\n    if (videoId >= 0 && videoId < this.videoId.length){\n      // console.log(this.videoId)\n      // console.log(videoId)\n      // let index = this.videoId.indexOf(videoId);\n      // console.log(\"get id :\", videoId, \"index :\", index)\n      return this.videoDuration[videoId]\n    }\n    else{\n      console.log(\"Data index out of bounds\");\n      return null\n    }\n  }\n  getAllData(){\n    return [this.videoId, this.videoData, this.videoDuration]\n  }\n}\n\nclass MusicClip {\n  constructor (Type, Clip_id, duration = 60, arraySet = [], timeSet = [], lyricSet = [], lyrictimeSet = [], lyricsVideoId = []) {\n      console.log(\"music Type : \", Type, \"Clip_id\", Clip_id,  \"duration\", duration);\n      this.Type = Type;\n      this.Clip_id = Clip_id;\n      this.duration = duration;\n      if(Type==MusicClipType.Melody){\n        this.melodyNoteSet = arraySet;\n        this.melodyTimeset = timeSet;\n        this.melodyNoteId = arraySet.length;\n\n        this.lyricSet = lyricSet;\n        this.lyrictimeSet = lyrictimeSet;\n        this.lyricId = lyricSet.length;\n        this.lyricsVideoId = lyricsVideoId\n      }\n      if(Type==MusicClipType.Beat){\n        this.beatSet = arraySet;\n        this.beatTime = timeSet;\n        this.beatSetId = arraySet.length;\n      }\n  }\n  setType(type){\n    this.Type = type;\n  }\n  setNoteInput(note, time) {\n    if(this.Type==MusicClipType.Melody){\n      this.melodyNoteSet.push(note);\n      this.melodyTimeset.push([time, -1]);\n      this.melodyNoteId +=1;\n    }\n    else{\n      alert(\"This Cilp type is Melody\");\n    }\n  }\n  setNoteRelease(note, time) {\n    if(this.Type==MusicClipType.Melody){\n      for (let i = this.melodyNoteSet.length - 1; i >= 0; i--) {\n        if (this.melodyNoteSet[i] === note) {\n          if(this.melodyTimeset[i][1] == -1){\n            this.melodyTimeset[i][1] = time;\n            break;\n          }\n          break;\n        }\n      }\n    }\n    else{\n      alert(\"This Cilp type is Melody\");\n    }\n  }\n  setBeatInput(pad_id, time) {\n    if(this.Type==MusicClipType.Beat){\n      this.beatSet.push(pad_id);\n      this.beatTime.push(time);\n      this.beatSetId+=1;\n    }\n    else{\n      alert(\"This Clip type is Beat\");\n    }\n  }\n  setDuration(duration){\n    this.duration = duration;\n  }\n  setInstrument(instrument_id){\n    this.instrument_id = instrument_id;\n  }\n  setLyrics(lyric, timeset){\n    this.lyricSet.push(lyric);\n    this.lyrictimeSet.push(timeset);\n    this.lyricId += 1;\n    this.lyricsVideoId.push(-1);\n  }\n  setLyricsVideo(lyricsId, vidoeId){\n    this.lyricsVideoId[lyricsId] = vidoeId;\n  }\n  editNote(noteIndex, deltaTimeset){\n    if(this.Type==MusicClipType.Melody){\n      this.melodyTimeset[noteIndex][0] += deltaTimeset[0];\n      this.melodyTimeset[noteIndex][1] += deltaTimeset[1];\n    }\n    else{\n      this.beatTime[noteIndex] += deltaTimeset[0];\n    }\n  }\n  editLyrics(lyricid, deltaTimeset){\n    if(this.Type==MusicClipType.Melody){\n      this.lyrictimeSet[lyricid][0] += deltaTimeset[0];\n      this.lyrictimeSet[lyricid][1] += deltaTimeset[1];\n    }\n  }\n  deleteNote(noteIndex){\n    if(this.Type==MusicClipType.Melody){\n      this.melodyNoteSet.splice(noteIndex,1);\n      this.melodyTimeset.splice(noteIndex,1);\n    }\n    else{\n      this.beatSet.splice(noteIndex,1);\n      this.beatTime.splice(noteIndex,1);\n    }\n  }\n  deletelyric(lyricId){\n    if(this.Type==MusicClipType.Melody){\n      this.lyricSet.splice(lyricId,1);\n      this.lyrictimeSet.splice(lyricId,1);\n      this.lyricsVideoId.push(lyricId,1);\n    }\n  }\n  dleteAlllyric(){\n    if(this.Type==MusicClipType.Melody){\n      this.lyricSet =[];\n      this.lyrictimeSet=[];\n      this.lyricId = 0;\n      this.lyricsVideoId = [];\n    }\n  }\n  getClipLastTime(){\n    let lastTime = 1;\n    if(this.Type == MusicClipType.Melody){\n      for(let i=0; i<this.melodyTimeset.length; i++){\n        if(lastTime < this.melodyTimeset[i][1]){\n          lastTime = this.melodyTimeset[i][1]\n        }\n      }\n      for(let i=0; i<this.lyrictimeSet.length; i++){\n        if(lastTime < this.lyrictimeSet[i][1]){\n          lastTime = this.lyrictimeSet[i][1]\n        }\n      }\n      return lastTime\n    }\n    else{\n      for(let i=0; i<this.beatTime.length; i++){\n        if(lastTime < this.beatTime[i]){\n          lastTime = this.beatTime[i]\n        }\n      }\n      return lastTime\n    }\n  }\n  getLyricsVideoId(lyricsId){\n    return this.lyricsVideoId[lyricsId];\n  }\n  getClipId(){\n    return this.Clip_id;\n  }\n  getClipType(){\n    return this.Type;\n  }\n  getDuration(){\n    return parseFloat(this.duration);\n  }\n  getNoteIndex(){\n    if(this.Type==MusicClipType.Melody){\n      return this.melodyNoteId;\n    }\n    else{\n      return this.beatSetId;\n    }\n  }\n  getLyricsIndex(){\n    return this.lyricId;\n  }\n  getMusicClip(){\n    if(this.Type==MusicClipType.Melody){\n      return [this.melodyNoteSet, this.melodyTimeset]\n    }\n    else{\n      return [this.beatSet, this.beatTime]\n    }\n  }\n\n  getcurrentNoteSet(currentTime){\n    const noteSet = []\n    if(this.Type==MusicClipType.Melody){\n      //return [this.melodyNoteSet, this.melodyTimeset]\n      for (let i = 0; i < this.melodyTimeset.length; i++) {\n        if (this.melodyTimeset[i][0] <= currentTime && currentTime < this.melodyTimeset[i][1]) {\n          noteSet.push(this.melodyNoteSet[i]);\n        }\n      }\n      return noteSet;\n    }\n    else{\n      //return [this.beatSet, this.beatTime]\n      for (let i = 0; i < this.beatTime.length; i++) {\n        if (this.beatTime[i] - 1/60 <= currentTime && currentTime < this.beatTime[i] + 1/60) {\n          noteSet.push(this.beatSet[i]);\n        }\n      }\n      return noteSet;\n    }\n  }\n\n  getLyrics(currentTime){\n    //console.log(this.lyricSet, this.lyrictimeSet)\n    for (let i = 0; i < this.lyrictimeSet.length; i++) {\n      if (this.lyrictimeSet[i][0] <= currentTime && currentTime < this.lyrictimeSet[i][1]) {\n        return [this.lyricSet[i], i];\n      }\n    }\n    return [\"\", -1];\n  }\n  getLyricsTimeset(lyricsId){\n    if (lyricsId < this.lyrictimeSet.length && lyricsId >= 0 ){ \n      return [this.lyrictimeSet[lyricsId][0], this.lyrictimeSet[lyricsId][1]];\n    }\n    else{\n      return [null, null]\n    }\n  }\n  getLyricsLastTime(){\n    let lastTime = 0;\n    if(this.Type == MusicClipType.Melody){\n      for(let i=0; i<this.lyrictimeSet.length; i++){\n        if(lastTime < this.lyrictimeSet[i][1]){\n          lastTime = this.lyrictimeSet[i][1]\n        }\n      }\n    }\n    return lastTime\n  }\n  getLyricsText(lyricsId){\n    return this.lyricSet[lyricsId];\n  }\n  getAllLyrics(){\n    return [this.lyricSet, this.lyrictimeSet, this.lyricsVideoId];\n  }\n}\n\nclass MusicTrack{\n  constructor (userId = 0, id_set = [[],[],[]], time_set = [[], [], []]){\n    this.userId = userId;\n\n    this.TemplateIdClip = id_set[0];\n    this.MelodyClipIdList = id_set[1];\n    this.BeatClipIdList = id_set[2];\n\n    this.TemplateTimeset = time_set[0];\n    this.MelodyTimeset = time_set[1];\n    this.BeatTimeset = time_set[2];\n  }\n  setMusicClip(musicClip, clipTime){\n    if(musicClip.getClipType() == MusicClipType.Melody){\n      this.MelodyClipIdList.push(musicClip.getClipId());\n      let duration = parseFloat(musicClip.getDuration());\n      this.MelodyTimeset.push([clipTime, clipTime + duration]);\n      console.log(\"Add Melody box\", this.MelodyClipIdList);\n    }\n    else{\n      this.BeatClipIdList.push(musicClip.getClipId());\n      let duration = parseFloat(musicClip.getDuration());\n      this.BeatTimeset.push([clipTime, clipTime + duration]);\n      console.log(\"Add Beat box\", this.BeatClipIdList);\n    }\n  }\n  setTemplateClip(templateId, clipTime){  //지금 코드가 조금 꼬여서 임의로 Template은 30초 길이로 고정\n    this.TemplateIdClip.push(templateId);\n    this.TemplateTimeset.push([clipTime, clipTime + 30]);\n    console.log(\"Add Template box\", this.TemplateIdClip);\n  }\n  editMusicClip(type, clip_id, deltaTime){\n    if(type == MusicClipType.Melody){\n      this.MelodyTimeset[clip_id][0] += deltaTime;\n      this.MelodyTimeset[clip_id][1] += deltaTime;\n    }\n    else{\n      this.BeatTimeset[clip_id][0] += deltaTime;\n      this.BeatTimeset[clip_id][1] += deltaTime;\n    }\n  }\n  getTempalateId(){\n    return this.TemplateIdClip.length;\n  }\n  getMelodyId(){\n    return this.MelodyClipIdList.length;\n  }\n  getBeatId(){\n    return this.BeatClipIdList.length;\n  }\n  getcurrentClipSet(currentTime){\n    const Meldoy_set = []\n    const Beat_set = []\n    const Template_set = []\n    //console.log(this.BeatTimeset);\n    for (let i = 0; i < this.TemplateTimeset.length; i++) {\n      if (this.TemplateTimeset[i][0] <= currentTime && currentTime < this.TemplateTimeset[i][1]) {\n        Template_set.push(this.TemplateTimeset[i][0]);  // 시간이 먼저\n        Template_set.push(this.TemplateIdClip[i]);\n      }\n    }\n    for (let i = 0; i < this.MelodyTimeset.length; i++) {\n      if (this.MelodyTimeset[i][0] <= currentTime && currentTime < this.MelodyTimeset[i][1]) {\n        Meldoy_set.push(this.MelodyTimeset[i][0]);\n        Meldoy_set.push(this.MelodyClipIdList[i]);\n      }\n    }\n    for (let i = 0; i < this.BeatTimeset.length; i++) {\n      if (this.BeatTimeset[i][0] <= currentTime && currentTime < this.BeatTimeset[i][1]) {\n        Beat_set.push(this.BeatTimeset[i][0]);\n        Beat_set.push(this.BeatClipIdList[i]);\n      }\n    }\n    return [Template_set, Meldoy_set, Beat_set];  //순서는 항상 Template, Melody, Beat로 고정\n  }\n  getUserId(){\n    return this.userId;\n  }\n  getIdData(){\n    return [this.TemplateIdClip, this.MelodyClipIdList, this.BeatClipIdList]\n  }\n  getTimeData(){\n    return [this.TemplateTimeset, this.MelodyTimeset, this.BeatTimeset]\n  }\n  getTemplateSet(){\n    return [this.TemplateIdClip, this.TemplateTimeset]\n  }\n  getMelodySet(){\n    return [this.MelodyClipIdList, this.MelodyTimeset]\n  }\n  getBeatSet(){\n    return [this.BeatClipIdList, this.BeatTimeset]\n  }\n  deleteClip(clipType, clipIndex){\n    console.log(\"delete Track\", clipType, clipIndex);\n    if(clipType != null){\n      if(clipType == MusicClipType.Template){\n        this.TemplateIdClip.splice(clipIndex,1)\n        this.TemplateTimeset.splice(clipIndex,1)\n      }\n      else if(clipType == MusicClipType.Melody){\n        this.MelodyClipIdList.splice(clipIndex,1)\n        this.MelodyTimeset.splice(clipIndex,1)\n      }\n      else{\n        this.BeatClipIdList.splice(clipIndex,1)\n        this.BeatTimeset.splice(clipIndex,1)\n      }\n    }\n  }\n  // setMusicClip(Melody_clip_array){  //Track의 Clip 정리 코드\n  //   const MaxId = Math.max.apply(null, this.MelodyClipIdList);\n  // }\n  // setBeatClip(Beat_clip_array){  //Track의 Clip 정리 코드\n  //   const MaxId = Math.max.apply(null, this.BeatClipIdList);\n  // }\n  // saveTrack(){\n  //   console.log(\"save the Music Track\");\n  // }\n}\n\n//# sourceURL=webpack://Synthesizer/./src/js/Share.js?");

/***/ }),

/***/ "./src/js/SheetMusic.js":
/*!******************************!*\
  !*** ./src/js/SheetMusic.js ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _Share_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Share.js */ \"./src/js/Share.js\");\n/* harmony import */ var _Synthesizer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Synthesizer.js */ \"./src/js/Synthesizer.js\");\n/* harmony import */ var _jsmidgen_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./jsmidgen.js */ \"./src/js/jsmidgen.js\");\n/* harmony import */ var _jsmidgen_js__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_jsmidgen_js__WEBPACK_IMPORTED_MODULE_2__);\n\n\n\n//import * as JZZ from \"./JZZ.js\"\n\n//최소 범위 A2 ~ C7\n\nlet nowClicked;\nlet previousClicked;\nlet clickCount = 0;\nlet clickedHistory = [];\n\n\nlet nowVideoClicked;\nlet previousVideoClicked;\nlet clickVideoCount = 0;\nlet clickedVideoHistory = [];\n\nconst fps = 30;\nlet currentTime = 0.0;\nlet currentTrackTime = 0.0;\nlet play_state = false;\nlet play_state_track = false;\nlet timer = null;\nlet duration = document.getElementById(\"clipduration\").value;\nlet duration_track = document.getElementById(\"trackduration\").value;\n\nlet clipduration = document.getElementById(\"clipduration\");\nlet timeLine1 = document.getElementById(\"timeLine1\");\nlet timeLine2 = document.getElementById(\"timeLine2\");\nlet timeLine3 = document.getElementById(\"timeLine3\");\nlet FileInput = document.getElementById(\"fileUpload\");\n\nconst Template_clip_array = [];\nconst Melody_clip_array = [];\nconst Beat_clip_array = [];\n\nlet current_clip_type = _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Mood;\nlet melody_clip = new _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody, Melody_clip_array.length, duration);\nlet beat_clip = new _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat, Beat_clip_array.length, duration);\nlet template_clip = new _Share_js__WEBPACK_IMPORTED_MODULE_0__.TemplateClip(Template_clip_array.length, duration_track);\ntemplateConnectToVisualAndSound(template_clip);\nlet onNoteList = [];\nlet previousNote = [];\nlet previousNote_track = [];\nlet TrackObject = new _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicTrack();\nlet videoObject = new _Share_js__WEBPACK_IMPORTED_MODULE_0__.VideoClip();\nlet previousDial_ID = -1;\nlet doubleChecker = 0 //Webpack double Event error catcher\nlet trackActivaqte = false;\nlet noteClickIndex = -1;\nlet trackClickIndex = -1;\nlet trackClickType = null\nconst clip_box_width = 1810;\nconst clip_start_px = 80;\nconst track_box_width = 700;\n\nlet lyricsId = 0;\n\nlet bpmPlayNumber = 0;\n\nconst userName = document.getElementById(\"userName\").innerHTML\nconst userEmail = document.getElementById(\"userEmail\").innerHTML\nconst musicId = parseInt(document.getElementById(\"musicType\").innerHTML);\n\ndocument.getElementById(\"synthConnector\").click();\n\nconst videoRecordCanvas = document.getElementById(\"videoRecordCanvas\");\nlet videoCheckCanvas = document.getElementById(\"videoCheckCanvas\");\n\n\n\n\ndocument.getElementById(\"PreviousButton\").addEventListener(\"click\", function(){\n  console.log(\"previous check\")\n  stopRecording();\n  stopAllNotePlayer();\n  play_state = false;\n  if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Mood){\n    console.log('to Login')\n    document.getElementById(\"loginPage\").click();\n  }\n  else if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat){\n    moodTypeSceneChanger();\n  }\n  else if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody){\n    beatTypeSceneChanger();\n    clearNoteClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat);\n  }\n  else if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Lyrics){\n    melodyTypeSceneChanger();\n  }\n  else if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Template){\n    lyricsTypeSceneChanger();\n  }\n  else{\n    templateTypeSceneChanger();\n  }\n})\n\ndocument.getElementById(\"NextButton\").addEventListener(\"click\", function(){\n  stopRecording();\n  stopAllNotePlayer();\n  play_state = false;\n  if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Mood){\n    beatTypeSceneChanger();\n    clearNoteClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat);\n  }\n  else if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat){\n    melodyTypeSceneChanger();\n    clearNoteClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody);\n  }\n  else if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody){\n    lyricsTypeSceneChanger();\n  }\n  else if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Lyrics){\n    templateTypeSceneChanger();\n  }\n  else{\n    totalTypeSceneChanger();\n  }\n})\nfunction moodTypeSceneChanger(){\n  current_clip_type = _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Mood;\n  noteClickIndex = -1;\n  console.log(\"to Mood\", current_clip_type);\n  document.getElementById(\"moodContainer\").style.display = \"block\";\n  document.getElementById(\"sheetMusicController\").style.display = \"none\";\n  document.getElementById(\"trackContainer\").style.display = \"none\";\n  document.getElementById(\"ThemaContainer\").style.display = \"block\";\n  document.getElementById(\"BeatContainer\").style.display = 'none';\n  document.getElementById(\"MelodyContainer\").style.display = 'none';\n  document.getElementById(\"TemplateContainer\").style.display = 'none';\n}\nfunction beatTypeSceneChanger(){\n  current_clip_type = _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat;\n  noteClickIndex = -1;\n  console.log(\"to Beat\", current_clip_type);\n  document.getElementById(\"moodContainer\").style.display = \"none\";\n  document.getElementById(\"sheetMusicController\").style.display = \"block\";\n  document.getElementById(\"trackContainer\").style.display = \"block\";\n  document.getElementById(\"ThemaContainer\").style.display = \"none\";\n  document.getElementById(\"BeatContainer\").style.display = 'block';\n  document.getElementById(\"MelodyContainer\").style.display = 'none';\n  document.getElementById(\"TemplateContainer\").style.display = 'none';\n  initializeTimer();\n}\nfunction melodyTypeSceneChanger(){\n  current_clip_type = _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody;\n  noteClickIndex = -1;\n  console.log(\"to Melody\", current_clip_type);\n  document.getElementById(\"moodContainer\").style.display = \"none\";\n  document.getElementById(\"sheetMusicController\").style.display = \"block\";\n  document.getElementById(\"trackContainer\").style.display = \"block\";\n  document.getElementById(\"ThemaContainer\").style.display = \"none\";\n  document.getElementById(\"BeatContainer\").style.display = 'none';\n  document.getElementById(\"MelodyContainer\").style.display = 'block';\n  document.getElementById(\"TemplateContainer\").style.display = 'none';\n\n  document.getElementById(\"noteBoxContainer\").style.display = 'block';\n  document.getElementById(\"timeLineContainer\").style.display = 'block';\n  document.getElementById(\"lyricsVideoContainer\").style.display = 'none';\n  initializeTimer();\n}\nfunction lyricsTypeSceneChanger(){\n  current_clip_type = _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Lyrics;\n  noteClickIndex = -1;\n  console.log(\"to Lyrics\", current_clip_type);\n  document.getElementById(\"moodContainer\").style.display = \"none\";\n  document.getElementById(\"sheetMusicController\").style.display = \"block\";\n  document.getElementById(\"trackContainer\").style.display = \"block\";\n  document.getElementById(\"ThemaContainer\").style.display = \"none\";\n  document.getElementById(\"BeatContainer\").style.display = 'none';\n  document.getElementById(\"MelodyContainer\").style.display = 'block';\n  document.getElementById(\"TemplateContainer\").style.display = 'none';\n\n  document.getElementById(\"noteBoxContainer\").style.display = 'none'\n  document.getElementById(\"timeLineContainer\").style.display = 'none';\n  document.getElementById(\"lyricsVideoContainer\").style.display = 'block';\n  initializeTimer();\n}\nfunction templateTypeSceneChanger(){\n  current_clip_type = _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Template;\n  noteClickIndex = -1;\n  console.log(\"to Template\", current_clip_type);\n  document.getElementById(\"moodContainer\").style.display = \"none\";\n  document.getElementById(\"sheetMusicController\").style.display = \"block\";\n  document.getElementById(\"trackContainer\").style.display = \"block\";\n  document.getElementById(\"ThemaContainer\").style.display = \"none\";\n  document.getElementById(\"BeatContainer\").style.display = 'none';\n  document.getElementById(\"MelodyContainer\").style.display = 'none';\n  document.getElementById(\"TemplateContainer\").style.display = 'block';\n\n  document.getElementById(\"trackText\").style.display = 'block';\n  document.getElementById(\"timeLine3\").style.display = 'block';\n  document.getElementById(\"trackMusicDeleteButton\").disabled = false;\n  document.getElementById(\"trackClipCreateButton\").disabled = false;\n  document.getElementById(\"TrackContainer\").style.display = 'block';\n  document.getElementById(\"clipEditContainer\").style.display = 'block';\n  document.getElementById(\"videoCheckCanvas2\").style.display = 'none';\n\n  videoCheckCanvas = document.getElementById(\"videoCheckCanvas\");\n}\nfunction totalTypeSceneChanger(){\n  current_clip_type = _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Total;\n  noteClickIndex = -1;\n  console.log(\"to Total\", current_clip_type);\n  document.getElementById(\"moodContainer\").style.display = \"none\";\n  document.getElementById(\"sheetMusicController\").style.display = \"none\";\n  document.getElementById(\"trackContainer\").style.display = \"block\";\n  document.getElementById(\"ThemaContainer\").style.display = \"none\";\n  document.getElementById(\"BeatContainer\").style.display = 'none';\n  document.getElementById(\"MelodyContainer\").style.display = 'none';\n  document.getElementById(\"TemplateContainer\").style.display = 'none';\n\n  document.getElementById(\"trackText\").style.display = 'none';\n  document.getElementById(\"timeLine3\").style.display = 'none';\n  document.getElementById(\"trackMusicDeleteButton\").disabled = true;\n  document.getElementById(\"trackClipCreateButton\").disabled = true;\n  document.getElementById(\"TrackContainer\").style.display = 'none';\n  document.getElementById(\"clipEditContainer\").style.display = 'none';\n  document.getElementById(\"videoCheckCanvas2\").style.display = 'block';\n\n\n  document.getElementById(\"shape-canvas\").style.width = '960px';\n  document.getElementById(\"shape-canvas\").style.height = '580px';\n  document.getElementById(\"shape-canvas\").style.marginTop = '300px'\n\n  document.getElementById(\"trackContainer\").style.width = '900px'\n  document.getElementById(\"trackContainer\").style.height = '620px'\n\n  document.getElementById(\"trackContainer\").style.marginTop = '-620px'\n  document.getElementById(\"slider_track\").style.width = '720px';\n  document.getElementById(\"slider_track\").style.marginLeft = '70px';\n  document.getElementById('trackMusicPlayButton').style.marginLeft = '580px';\n  document.getElementById('trackMusicDeleteButton').style.display = 'none';\n  document.getElementById('trackClipCreateButton').style.display = 'none';\n\n  videoCheckCanvas = document.getElementById(\"videoCheckCanvas2\");\n  videoCheckCanvas.style.width = '750px';\n  videoCheckCanvas.style.height = '510px';\n  videoCheckCanvas.style.marginTop = '10px';\n  videoCheckCanvas.style.marginLeft = '60px';\n}\n\n\n/*------------------------------단축키 코드 관련 코드--------------------------------*/\ndocument.addEventListener('keyup', function(event) {\n  if (event.defaultPrevented) {\n    return;\n  }\n  switch (event.key) {\n    case 'Enter':\n      console.log(\"Enter\")\n      if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody || current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Lyrics){\n        document.getElementById(\"LyricsPushButton\").click();\n      }\n      break;\n    case ' ':\n      if (event.shiftKey) { \n        console.log(\"Shift+space\")\n        if(!play_state_track){\n          document.getElementById(\"trackMusicPlayButton\").click();\n        }\n        else{\n          document.getElementById(\"trackMusicPauseButton\").click();\n        }\n      } \n      else {\n        console.log(\"space\")\n        if(!play_state){\n          document.getElementById(\"sheetMusicPlayButton\").click();\n        }\n        else{\n          document.getElementById(\"sheetMusicPauseButton\").click();\n        }\n      }\n      break;\n    case 's':\n      if(event.ctrlKey){\n        document.getElementById(\"sheetMusicSaveButton\").click();\n      }\n      break;\n    case 'ArrowLeft':\n      console.log(\"Left\")\n      document.getElementById(\"PreviousButton\").click();\n      break;\n    case 'ArrowRight':\n      console.log(\"right\")\n      document.getElementById(\"NextButton\").click();\n      break;\n    case \"Backspace\":\n      if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat || current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody || current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Lyrics){\n        document.getElementById(\"sheetMusicDeleteButton\").click();\n      }\n      break\n    case \"Delete\":\n      if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat || current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody || current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Lyrics){\n        document.getElementById(\"sheetMusicDeleteButton\").click();\n      }\n      break\n    default:\n      return;\n  }\n\n  event.preventDefault();\n}, true);\n\n/*------------------------------녹화용 코드 관련 코드--------------------------------*/\nlet mediaRecorder = null;\nlet videoId = 0;\nvideoCheckCanvas.autoplay = false;\nlet chunck = [];\nfunction videoRecordingMode(recordingState){\n  if(recordingState){\n    videoRecordCanvas.style.display = \"block\"\n    videoCheckCanvas.style.display = \"none\"\n  }\n  else{\n    videoRecordCanvas.style.display = \"none\"\n    videoCheckCanvas.style.display = \"block\"\n  }\n}\n\ndocument.getElementById(\"recordStartButton\").addEventListener(\"click\", function(){\n  let timeElapsed = 4;\n  const intervalId = setInterval( function() {\n    timeElapsed--;\n    console.log(`${timeElapsed}초 뒤에 함수가 실행됩니다.`);\n    document.getElementById(\"videoWaitTime\").innerHTML = `${timeElapsed}초 뒤에 녹화 시작.`;\n    if (timeElapsed <= 0) {\n      document.getElementById(\"videoWaitTime\").innerHTML = '';\n      videoRecordingStart()\n      clearInterval(intervalId);\n    }\n  }, 1000);\n});\n\nasync function videoRecordingStart(){\n  videoRecordingMode(true);\n  let vidoeDuration = 0;\n  let startDate = 0;\n  let waitTime = 3;\n  let recordingState = false\n  const mediaStream = await navigator.mediaDevices.getUserMedia({\n    audio: false,\n    video: true\n  });\n  videoRecordCanvas.srcObject = mediaStream;\n  videoRecordCanvas.onloadedmetadata = (event)=>{\n    videoRecordCanvas.play();\n    console.log(\"recording Start\");\n    vidoeDuration = 0\n    startDate = Date.now();\n  }\n  mediaRecorder = new MediaRecorder(mediaStream);\n  mediaRecorder.ondataavailable = (event)=>{\n    chunck.push(event.data);\n  }\n  mediaRecorder.onstop = (event)=>{\n    // 배열에 담아둔 녹화 데이터들을 통합한 Blob객체 생성\n    vidoeDuration = (Date.now() - startDate)/1000\n    console.log(\"recording Stop : \");\n    console.log(\"video Duration :\", vidoeDuration);\n    let videoBlob = new Blob(chunck, { type: 'video/webm' });\n    videoObject.setVideo(videoId, videoBlob, vidoeDuration);\n    // BlobURL(ObjectURL) 생성\n    const blobURL = window.URL.createObjectURL(videoBlob);\n    // 녹화된 영상 재생: \n    videoCheckCanvas.src = blobURL;\n    videoCheckCanvas.play();\n    // 기존 녹화 데이터 제거\n    chunck.splice(0);\n    createVideoClipObject(videoId)\n    videoId +=1;\n    console.log(videoObject);\n  }\n  mediaRecorder.start();\n}\n\n\n\n\ndocument.getElementById(\"recordStopButton\").addEventListener(\"click\", function(){\n  // 녹화 종료!\n  videoRecordingMode(false);\n  mediaRecorder.stop();\n})\nfunction loadVideoClip(videoId, playDuration = null){\n  videoRecordingMode(false);\n  let videoData = videoObject.getVideoData(videoId);\n  let videoDuration = videoObject.getVideoDuration(videoId);\n  if (videoData instanceof Blob){\n    let url = window.URL.createObjectURL(videoData);\n    videoCheckCanvas.src = url;\n    videoCheckCanvas.play();\n    if(playDuration != null && playDuration > 0){\n      console.log(\"play rate :\", videoDuration / playDuration);\n      videoCheckCanvas.playbackRate  = videoDuration / playDuration;\n    }\n    else{\n      videoCheckCanvas.playbackRate  = 1.0\n    }\n  }\n  else{\n    console.error('The element at this index is not a Blob')\n  }\n}\nfunction setViodeTime(setTime, playbackRate){\n  let videoTime = setTime * playbackRate;\n  if(Math.abs(videoCheckCanvas.currentTime - videoTime) > 0.4){\n    console.log(\"setting video Time : \", videoCheckCanvas.currentTime, videoTime)\n    videoCheckCanvas.currentTime = videoTime;\n  }\n}\nfunction pauseVideo(){\n  videoCheckCanvas.pause();\n}\n\n\nfunction videoDownload(blob, id, duration){\n  const url = window.URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  let fileName = userName + \"_\" + id + \"_\" + parseInt(duration)\n  a.style.display = 'none';\n  a.href = url;\n  a.download = fileName;\n  document.body.appendChild(a);\n  a.click();\n\n  setTimeout(() => {\n    document.body.removeChild(a);\n    window.URL.revokeObjectURL(url);\n  }, 100);\n}\n\n\n//video Clip Object 생성용 코드(melody, Beat용)\nfunction createVideoClipObject(videoCLipId){\n  const videoIdClip = document.createElement(\"div\");\n  videoIdClip.classList.add(\"Video_clip\");\n  videoIdClip.style.width = '200px'\n  videoIdClip.textContent = \"수어 \" + (videoCLipId + 1); \n  let boxItem = document.getElementById(\"VideoClipContainer\");\n  videoIdClip.setAttribute(\"Video_Cilp_id\", videoCLipId); // clip_id 속성 추가\n\n  videoIdClip.setAttribute('id', \"video\" + videoCLipId); // 색상 바꾸는 용도\n\n\n\n  videoIdClip.addEventListener(\"click\", function(){\n    console.log(\"videoClipId:\", videoIdClip.getAttribute(\"Video_Cilp_id\"));\n    if(videoCLipId != -1){\n      loadVideoClip(videoIdClip.getAttribute(\"Video_Cilp_id\"));\n    }\n    if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Lyrics){\n      document.getElementById('lyricsVideo').innerHTML = videoIdClip.textContent;\n    }\n  })\n\n  // 여기임당\n\n  videoIdClip.addEventListener(\"click\", function (){\n    clickVideoCount += 1;\n    console.log(videoIdClip.id);\n    clickedVideoHistory.push(videoIdClip.id) // 아이디 히스토리 리스트로 넣기\n\n    // clickedHistory[-2] != clickedHistory[-1]\n    if (clickedVideoHistory.length == 1){     // 하나만 들어왔을 시\n      // console.log('히스토리', clickedHistory);\n      nowVideoClicked = document.getElementById(clickedVideoHistory[0]);\n      console.log('요거', nowVideoClicked)\n      nowVideoClicked.style.borderWidth = '0.5em'\n    }\n\n    // 두개 이상 들어왔을 시\n    else if (clickedVideoHistory.length > 1 && clickedVideoHistory[clickedVideoHistory.length - 1] != clickedVideoHistory[clickedVideoHistory.length - 2]){\n      nowVideoClicked = document.getElementById(clickedVideoHistory[clickedVideoHistory.length - 1]);\n      previousVideoClicked = document.getElementById(clickedVideoHistory[clickedVideoHistory.length - 2])\n\n      nowVideoClicked.style.borderWidth = '0.5em'\n      previousVideoClicked.style.borderWidth = ''\n      \n    }})\n  boxItem.appendChild(videoIdClip);\n}\n\n\n\n\n\ndocument.getElementById(\"lyricsSettingButton\").addEventListener(\"click\", function(){\n  if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Lyrics){\n    let lyricsText = document.getElementById('lyricsVideo').innerHTML;\n    if(noteClickIndex != -1){\n      console.log(\"current lyrics id :\", noteClickIndex, \"video id :\", parseInt(lyricsText.substr(2))-1);\n      alert(\"자막(\" + melody_clip.getLyricsText(noteClickIndex) +\")과 영상 (\"+lyricsText +\")이 연결되었습니다.\")\n      melody_clip.setLyricsVideo(noteClickIndex, parseInt(lyricsText.substr(2))-1)\n    }\n  }\n})\n\nlet previousLyricsIndex  = null;\nfunction playVideoControl(currentTime, lyricsIndex){\n  if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Lyrics  || current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Total){\n    let videoId = melody_clip.getLyricsVideoId(lyricsIndex);\n    if(lyricsIndex != -1 && videoId != -1){\n      let [startTime, lastTime] = melody_clip.getLyricsTimeset(lyricsIndex);\n      let videoDuration = videoObject.getVideoDuration(videoId);\n      //console.log(\"time:\", currentTime - startTime, \"VideoId\", videoId);\n      if(lyricsIndex != -1 && previousLyricsIndex != lyricsIndex){\n        let videoData = videoObject.getVideoData(videoId);\n        if (videoData instanceof Blob){\n          let url = window.URL.createObjectURL(videoData);\n          videoCheckCanvas.src = url;\n          let playDuration = lastTime - startTime;\n          console.log(\"check\", playDuration, startTime, lastTime);\n          if(playDuration != null && playDuration > 0){\n            videoCheckCanvas.playbackRate  = videoDuration / playDuration;\n            console.log(\"rate Change\", videoDuration / playDuration)\n          }\n          else{\n            videoCheckCanvas.playbackRate  = 1.0;\n          }\n        }\n        previousLyricsIndex = lyricsIndex;\n      }\n      if(videoCheckCanvas.paused){\n        videoCheckCanvas.play();\n      }\n      setViodeTime(currentTime - startTime, videoDuration/(lastTime - startTime))\n    }\n    // else{\n    //   if(!videoCheckCanvas.paused){\n    //     console.log(\"pause check\");\n    //     videoCheckCanvas.pause();\n    //   }\n    // }\n  }\n}\n\n\n\n\n\n\n\n/*-----------------------------MIDI 파일 생성용 코드-----------------------------------------*/\n\nlet MidiEventTime = 0.0\nconst midiBPM = 120;\nconst midiBeatNote = [\"C\" ,\"D\", \"F\", \"A#\"]\nfunction generateMidi(miditype) {\n    var file = new _jsmidgen_js__WEBPACK_IMPORTED_MODULE_2__.File();\n    var track = new _jsmidgen_js__WEBPACK_IMPORTED_MODULE_2__.Track();\n\n    file.addTrack(track);\n    track.setTempo(midiBPM);\n    if(miditype == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody){\n      track.instrument(0, 0x03) // 피아노 악기로 설정\n    }\n    else{\n      track.instrument(0, 0x70) // 타악기로 설정\n    }\n    \n    MidiTrackMaker(track, miditype)\n\n    var midiData = file.toBytes();\n    var byteNumbers = new Array(midiData.length);\n    for (var i = 0; i < midiData.length; i++) {\n        byteNumbers[i] = midiData.charCodeAt(i);\n    }\n    var byteArray = new Uint8Array(byteNumbers);\n    var blob = new Blob([byteArray], {type: \"application/octet-stream\"});\n    var downloadLink = document.createElement('a');\n    downloadLink.href = window.URL.createObjectURL(blob);\n    downloadLink.download = userName + \"_\" + miditype + '_Midi.mid';\n    document.body.appendChild(downloadLink);\n    downloadLink.click();\n    document.body.removeChild(downloadLink);\n}\n\nfunction MidiTrackMaker(track, miditype){\n  for(let trackTimer = 0; trackTimer <duration_track; trackTimer += 1/fps){\n    let cur_track_set = TrackObject.getcurrentClipSet(trackTimer);\n    if(cur_track_set[1].length > 0 && miditype == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody){\n      MidiMelodyMaker(track, trackTimer, trackTimer - cur_track_set[1][0], Melody_clip_array[cur_track_set[1][1]]);\n    }\n    if(cur_track_set[2].length > 0 && miditype == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat){\n      MidiBeatMaker(track, trackTimer, trackTimer - cur_track_set[2][0], Beat_clip_array[cur_track_set[2][1]]);\n    }\n  }\n}\n\n\nfunction MidiMelodyMaker(track, currentTime, inputTime, melody_clip){\n  let currentNote = melody_clip.getcurrentNoteSet(inputTime);\n  MidiNoteAdditor(track, currentNote, previousNote_track, currentTime);\n  previousNote_track = melody_clip.getcurrentNoteSet(inputTime);\n}\nfunction MidiNoteAdditor(track, currentNote, previousNote, currentTime){ //피아노 음 재생 함수\n  //piano_player(currentNote[0], true);\n  if(currentTime < MidiEventTime){\n    MidiEventTime = 0.0;\n  }\n  var exclusiveArr1 = currentNote.filter(function(val) {\n    return previousNote.indexOf(val) === -1;\n  });\n  var exclusiveArr2 = previousNote.filter(function(val) {\n    return currentNote.indexOf(val) === -1;\n  });\n  if(exclusiveArr1.length > 0){\n    //console.log(\"Inpnut\", exclusiveArr1);\n    for( let note of exclusiveArr1){\n      track.noteOn(0, note, parseInt((currentTime - MidiEventTime) * midiBPM * 2))\n      console.log(\"note ON\", note, parseInt((currentTime - MidiEventTime) * midiBPM * 2), currentTime)\n      MidiEventTime = currentTime\n    }  \n  }\n  if(exclusiveArr2.length > 0){\n    //console.log(\"Ouput \", exclusiveArr2);\n    for( let note of exclusiveArr2){\n      track.noteOff(0, note, parseInt((currentTime - MidiEventTime) * midiBPM * 2))\n      console.log(\"note OFF\", note, parseInt((currentTime - MidiEventTime) * midiBPM * 2))\n      MidiEventTime = currentTime\n    }  \n  }\n}\n\n\nfunction MidiBeatMaker(track, currentTime, inputTime, beat_clip){\n  let currentBeat = beat_clip.getcurrentNoteSet(inputTime);\n  if(currentTime < MidiEventTime){\n    console.log(\"MidiEventTimer reset\")\n    MidiEventTime = 0.0;\n  }\n  for (let beat of currentBeat){\n    if(beat == 0){\n      track.addNote(0, midiBeatNote[beat]+\"2\", 32, parseInt((currentTime - MidiEventTime) * midiBPM * 2))\n      console.log(\"beat ON\",beat+1, parseInt((currentTime - MidiEventTime) * midiBPM * 2), currentTime)\n      MidiEventTime = currentTime\n    }\n    else if(beat == 1){\n      track.addNote(0, midiBeatNote[beat]+\"2\", 32, parseInt((currentTime - MidiEventTime) * midiBPM * 2))\n      console.log(\"beat ON\",beat+1, parseInt((currentTime - MidiEventTime) * midiBPM * 2), currentTime)\n      MidiEventTime = currentTime\n    }\n    else if(beat == 2){\n      track.addNote(0, midiBeatNote[beat]+\"2\", 32, parseInt((currentTime - MidiEventTime) * midiBPM * 2))\n      console.log(\"beat ON\",beat+1, parseInt((currentTime - MidiEventTime) * midiBPM * 2), currentTime)\n      MidiEventTime = currentTime\n    }\n    else{\n      track.addNote(0, midiBeatNote[beat]+\"2\", 32, parseInt((currentTime - MidiEventTime) * midiBPM * 2))\n      console.log(\"beat ON\",beat+1, parseInt((currentTime - MidiEventTime) * midiBPM * 2), currentTime)\n      MidiEventTime = currentTime\n    }\n   }\n}\n\n\n\n/*-----------------------------MIDI 파일 생성용 코드-----------------------------------------*/\n\n\n\nfunction InitializeAllSetting(){\n  currentTime = 0.0;\n  currentTrackTime = 0.0;\n  play_state = false;\n  play_state_track = false;\n  Template_clip_array.length = 0;\n  Melody_clip_array.length = 0;\n  Beat_clip_array.length = 0;\n  melody_clip = new _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody, Melody_clip_array.length, duration);\n  beat_clip = new _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat, Beat_clip_array.length, duration);\n  template_clip = new _Share_js__WEBPACK_IMPORTED_MODULE_0__.TemplateClip(Template_clip_array.length, duration_track);\n  current_clip_type = _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat;\n  onNoteList = [];\n  previousNote = [];\n  previousNote_track = [];\n  TrackObject = new _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicTrack();\n  previousDial_ID = -1;\n  doubleChecker = 0;\n  trackActivaqte = false;\n  noteClickIndex = -1;\n  trackClickIndex = -1;\n  trackClickType = null\n  lyricsId = 0;\n  stopRecording();\n  clearNoteClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat);\n  clearNoteClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody);\n  clearAllBoxClip();\n  initializeTimer();\n  initializeTimer2();\n}\n\n/* Timer Setting and Update code*/\nfunction startRecording(){//Timer를 시작하는 코드\n  stopTrack()\n  play_state = true;\n  previousLyricsIndex = null;\n  startTimer();\n  startMetronome();\n  if(document.getElementById(\"BPMType\").checked){\n    bpmPlayNumber = 5\n  }\n}\nfunction stopRecording(){//Timer를 중지하는 코드\n  play_state = false;\n  noteSizeAllOff();\n  stopTimer();\n  stopMetronome();\n}\nfunction startTimer() { // 타이머 시작 코드\n  if (!timer) { // 타이머가 이미 실행 중이지 않은 경우에만 실행\n    timer = setInterval(updateTime, 1 / fps * 1000); // 0.01초 간격으로 updateTime 함수 실행\n  }\n}\nfunction stopTimer() {  // 타이머 정지 코드\n  clearInterval(timer);\n  timer = null; // 타이머 변수 초기화\n  pauseVideo(); // 영상 재생 정지\n}\n\n\n// track timer code\nfunction startTrack(){//Timer를 시작하는 코드\n  stopRecording()\n  play_state = true;\n  play_state_track = true;\n  previousLyricsIndex = null;\n  startTimer2();\n  startMetronome();\n  if(document.getElementById(\"BPMType\").checked){\n    bpmPlayNumber = 5\n  }\n}\nfunction stopTrack(){//Timer를 중지하는 코드\n  play_state = false;\n  play_state_track = false;\n  noteSizeAllOff();\n  stopTimer2();\n  stopMetronome();\n}\nfunction startTimer2() { // 타이머 시작 코드\n  if (!timer) { // 타이머가 이미 실행 중이지 않은 경우에만 실행\n    timer = setInterval(updateTime2, 1 / fps * 1000); // 0.01초 간격으로 updateTime 함수 실행\n  }\n}\nfunction stopTimer2() {  // 타이머 정지 코드\n  clearInterval(timer);\n  timer = null; // 타이머 변수 초기화\n}\nfunction currentClipDuration(){\n  if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody||current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Lyrics){\n    return melody_clip.getDuration();\n  }\n  else{\n    return beat_clip.getDuration();\n  }\n}\n\n\n\nfunction updateTime() { //시간에 따라 업데이트 해야하는 함수들\n  if(bpmPlayNumber > 4){\n    currentTime += 1/fps;\n    musicPlayer(currentTime);\n    //console.log(time_to_px(currentTime, duration)-clip_start_px);\n    $(\"#slider\").slider(\"value\",time_to_px(currentTime, currentClipDuration()));\n    timeLine2.style.left = (time_to_px(currentTime, currentClipDuration())-clip_start_px) + \"px\";\n    timeLine1.style.left = (time_to_px(currentTime, currentClipDuration())-clip_start_px) + \"px\";\n    // console.log(onNoteList[0].style.left, time_to_px(currentTime, currentClipDuration()) + \"px\")\n    // updateTime2(currentTime)\n    showLyrics(currentTime);\n    for (let item of onNoteList){\n      noteResizeChanger(item, time_to_px(currentTime, currentClipDuration()));\n    }\n    if(currentTime >= currentClipDuration()){\n      stopRecording() //끝 도달하면 자동으로 종료\n    }\n  }\n}\n\nfunction ClipUpdateTimeControl(setTime){\n  currentTime = setTime\n  $(\"#slider\").slider(\"value\",time_to_px(currentTime, currentClipDuration()));\n  timeLine2.style.left = (time_to_px(currentTime, currentClipDuration())-clip_start_px) + \"px\";\n  timeLine1.style.left = (time_to_px(currentTime, currentClipDuration())-clip_start_px) + \"px\";\n  showLyrics(currentTime);\n  for (let item of onNoteList){\n    noteResizeChanger(item, time_to_px(currentTime, currentClipDuration()));\n  }\n}\n\n\n\n\n\n$(\"#slider\").slider({ //Timer 슬라이더\n  value: clip_start_px,\n  min: clip_start_px,\n  max: clip_box_width,\n  step: 0.01,\n  slide: function( event, ui ) {\n    timeLine1.style.left = ((ui.value)-clip_start_px) + \"px\";\n    timeLine2.style.left = ((ui.value)-clip_start_px) + \"px\";\n    currentTime = px_to_time(ui.value, currentClipDuration());\n    // if(practiceMode){\n    //   player1.seekTo(px_to_time(ui.value, duration), true);\n    // }\n    // else{\n    //   player2.seekTo(px_to_time(ui.value, duration), true);\n    // }\n    noteSizeAllOff();\n  }\n});\nfunction initializeTimer(){ //Timer 초기화\n  stopRecording();\n  currentTime = 0.0;\n  $(\"#slider\").slider(\"value\",time_to_px(currentTime, currentClipDuration()));\n  timeLine2.style.left = (time_to_px(currentTime, currentClipDuration())-clip_start_px) + \"px\";\n  timeLine1.style.left = (time_to_px(currentTime, currentClipDuration())-clip_start_px) + \"px\";\n}\nfunction time_to_px(time, duration, width = clip_box_width, start = clip_start_px){ //Time을 Px로 변환하는 코드\n  return start + time / duration * (width - start)\n}\nfunction time_to_px_Scale(time, duration, width = clip_box_width, start = clip_start_px){ //Time을 Px로 변환하는 코드\n  return time / duration * (width - start)\n}\nfunction px_to_time(px, duration, width = clip_box_width, start = clip_start_px){  //Px을 Time으로 변환하는 코드\n  return (px - start) * duration / (width - start)\n}\nfunction px_to_time_Scale(px, duration, width = clip_box_width, start = clip_start_px){  //Px Scale을 Time Scale로 변환하는 코드\n  return px * duration / (width - start)\n}\n/*Note Sound Maker*/\nfunction musicPlayer(currentTime){  //음, 비트 소리를 재생하는 코드\n  if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody || current_clip_type==_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Lyrics){\n    let currentNote = melody_clip.getcurrentNoteSet(currentTime)\n    notePlayer(currentNote, previousNote);\n    previousNote = melody_clip.getcurrentNoteSet(currentTime);\n  }\n  else if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat){\n    let currentBeat = beat_clip.getcurrentNoteSet(currentTime);\n    for (let beat of currentBeat){\n      (0,_Synthesizer_js__WEBPACK_IMPORTED_MODULE_1__.beat_player)(beat);\n      setTimeout(() => (0,_Synthesizer_js__WEBPACK_IMPORTED_MODULE_1__.beat_output_play)(beat), 100);\n    }\n  }\n}\nfunction notePlayer(currentNote, previousNote){ //피아노 음 재생 함수\n  //piano_player(currentNote[0], true);\n  var exclusiveArr1 = currentNote.filter(function(val) {\n    return previousNote.indexOf(val) === -1;\n  });\n  var exclusiveArr2 = previousNote.filter(function(val) {\n    return currentNote.indexOf(val) === -1;\n  });\n  if(exclusiveArr1.length > 0){\n    //console.log(\"Inpnut\", exclusiveArr1);\n    for( let note of exclusiveArr1){\n      (0,_Synthesizer_js__WEBPACK_IMPORTED_MODULE_1__.piano_player)(note, true);\n    }  \n  }\n  if(exclusiveArr2.length > 0){\n    //console.log(\"Ouput \", exclusiveArr2);\n    for( let note of exclusiveArr2){\n      (0,_Synthesizer_js__WEBPACK_IMPORTED_MODULE_1__.piano_player)(note, false);\n    }  \n  }\n  //console.log(\"piano Player Test \", exclusiveArr1, exclusiveArr2)\n}\nfunction stopAllNotePlayer(){ //재생되는 음을 모두 정지하는\n  if(previousNote.length > 0){\n    //console.log(\"Ouput \", exclusiveArr2);\n    for(let note of previousNote){\n      (0,_Synthesizer_js__WEBPACK_IMPORTED_MODULE_1__.piano_player)(note, false);\n    }  \n  }\n  if(previousNote_track.length > 0){\n    //console.log(\"Ouput \", exclusiveArr2);\n    for(let note of previousNote_track){\n      (0,_Synthesizer_js__WEBPACK_IMPORTED_MODULE_1__.piano_player)(note, false);\n    }  \n  }\n  previousNote = []\n  previousNote_track = []\n}\nfunction OctaveToColor(octave){\n  switch(octave){\n    case \"C4\":\n      return 'hsl(0,99%,41%)'\n    case \"C#4\":\n      return 'hsl(24,99%,41%)';\n    case \"D4\":\n      return 'hsl(36,99%,41%)';\n    case \"D#4\":\n      return 'hsl(46,99%,41%)';\n    case \"E4\":\n      return 'hsl(55,99%,41%)';\n    case \"F4\":\n      return 'hsl(129,100%,31%)';\n    case \"F#4\":\n      return 'hsl(179,100%,27%)';\n    case \"G4\":\n      return 'hsl(186,99%,41%)';\n    case \"G#4\":\n      return  '#2E93FF';\n    case \"A4\":\n      return 'hsl(273,99%,40%)';\n    case \"A#4\":\n      return  'hsl(284,100%,34%)';\n    case \"B4\":\n      return 'hsl(329,100%,39%)';\n    //let magenta = 'hsl(346,100%,39%)'\n    case \"C5\":\n      return 'hsl(0,100%,25%)'\n    case \"C#5\":\n      return 'hsl(25,100%,24%)'\n    case \"D5\":\n      return 'hsl(36,100%,24%)'\n    case \"D#5\":\n      return 'hsl(48,100%,24%)'\n    case \"E5\":\n      return  'hsl(57,100%,26%)'\n    case \"F5\":\n      return  'hsl(120,100%,19%)'\n    case \"F#5\":\n      return 'hsl(178,100%,18%)'\n    case \"G5\":\n      return 'hsl(210,100%,22%)'\n    case \"G#5\":\n      return 'hsl(246,100%,22%)'\n    case \"A5\":\n      return 'hsl(275,100%,22%)'\n    case \"A#5\":\n      return  'hsl(308,100%,22%)'\n    case \"B5\":\n      return  'hsl(323,100%,21%)'\n    case \"C6\":\n      return  'hsl(351,100%,21%)'\n    default:\n      return 'hsl(0,100%,0%)'\n  }\n}\n\n/*Cilp Note Object creater*/\nfunction createResizeDragElement(note, leftPosition, noteId, type) { //Melody, Beat 노트 생성\n  const resizeDrag = document.createElement(\"div\");\n  let boxItem = null\n  if(type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody){\n    resizeDrag.classList.add(\"resize-drag\");  // resize-drag로 생성\n    const Itemid = \"box_\" + note.substr(0, note.length - 1); \n    boxItem = document.getElementById(Itemid);\n    resizeDrag.textContent = note.substr(note.length - 1, note.length);\n    resizeDrag.style.backgroundColor =  OctaveToColor(note)\n  }\n  else{\n    resizeDrag.classList.add(\"draggable\");  // resize-drag로 생성\n    const Itemid = \"box_\" + note;\n    boxItem = document.getElementById(Itemid);\n    resizeDrag.textContent = \"\"\n  }\n  resizeDrag.style.left = leftPosition + \"px\"; // left 스타일 추가\n  resizeDrag.setAttribute(\"note_id\", noteId); // note_id 속성 추가\n  resizeDrag.setAttribute(\"note\", note); // note_id 속성 추가\n  resizeDrag.addEventListener(\"click\", function(){\n    //console.log(\"Note Id:\", resizeDrag.getAttribute(\"note_id\"));\n    noteClickIndex = resizeDrag.getAttribute(\"note_id\");\n  })\n  noteClickIndex = noteId;\n  boxItem.appendChild(resizeDrag);\n  return resizeDrag\n}\n\nfunction noteResizeChanger(noteObejct, target_pix){\n  const currentWidth = 10;  //Meldoy 음표의 최소 길이값(css에서 변경시 바꿔야함)\n  const currentleft = parseFloat(noteObejct.style.left);\n  if(currentWidth < target_pix - currentleft){\n    noteObejct.style.width = (target_pix - currentleft) + \"px\";\n  }\n}\nfunction noteSizeAllOff(){ //Note 변화용 array 초기화\n  for (let i = 0; i < onNoteList.length; i++) {\n    melody_clip.setNoteRelease(onNoteList[i].getAttribute(\"note\"), currentTime);\n  }\n  onNoteList = [];\n}\nfunction noteOff(note){//Note 변화 설정 초기화\n  for (let i = 0; i < onNoteList.length; i++) {\n    if (onNoteList[i].getAttribute(\"note\") === note) {\n      onNoteList.splice(i, 1);\n      break;\n    }\n  }\n}\nfunction newClipCreater(){\n  if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody){\n    console.log(\"New Melody Clip Create\", Melody_clip_array.length)\n    melody_clip = new _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody, Melody_clip_array.length, duration);\n    noteClickIndex = -1;\n    clearNoteClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody);\n    initializeTimer();\n  }\n  else if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat){\n    console.log(\"New Beat Clip Create\", Beat_clip_array.length)\n    beat_clip = new _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat, Beat_clip_array.length, duration);\n    noteClickIndex = -1;\n    clearNoteClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat);\n    initializeTimer();\n  }\n  else if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Template){\n    console.log(\"New Template Clip Create\", Template_clip_array.length)\n    template_clip = new _Share_js__WEBPACK_IMPORTED_MODULE_0__.TemplateClip(Template_clip_array.length, duration_track);\n    templateConnectToVisualAndSound(template_clip);\n    console.log(Template_clip_array)\n  }\n}\n\n/* Clip Event Code */\ndocument.getElementById(\"trackClipCreateButton\").addEventListener('click', function (){\n  newClipCreater();\n})\ndocument.getElementById(\"sheetMusicTemplateButton\").addEventListener('click', function (){\n  if(template_clip.get_Clip_id() != Template_clip_array.length){\n    console.log(\"New Template Clip Create\", template_clip.get_Clip_id(), Template_clip_array.length)\n    template_clip = new _Share_js__WEBPACK_IMPORTED_MODULE_0__.TemplateClip(Template_clip_array.length, duration_track);\n    templateConnectToVisualAndSound(template_clip);\n    console.log(Template_clip_array)\n  }\n})\ndocument.getElementById(\"sheetMusicSaveButton\").addEventListener('click', function (){\n  if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody){     // Melody Save \n    if(melody_clip.getClipId() == Melody_clip_array.length){\n      clipDurationNormalize(current_clip_type)\n      createClipBox(melody_clip);\n      Melody_clip_array.push(melody_clip);\n      melody_clip = new _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody, Melody_clip_array.length, duration);\n      alert(\"멜로디 저장\")\n      clearNoteClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody);\n      initializeTimer();\n    }\n    else{\n      clipDurationNormalize(current_clip_type)\n      Melody_clip_array[melody_clip.getClipId()] = melody_clip;\n      alert(\"멜로디 다시 저장\")\n    }\n  }\n  else if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat){      \n    if(beat_clip.getClipId() == Beat_clip_array.length){        \n      clipDurationNormalize(current_clip_type)                          // Beat Save\n      createClipBox(beat_clip);\n      Beat_clip_array.push(beat_clip);\n      beat_clip = new _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat, Beat_clip_array.length, duration);\n      alert(\"비트 저장\")\n      clearNoteClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat);\n      initializeTimer();\n    }\n    else{\n      clipDurationNormalize(current_clip_type)\n      Beat_clip_array[beat_clip.getClipId()] = beat_clip;\n      alert(\"비트 다시 저장\")\n    }\n  }\n  else if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Lyrics){\n    \n  }\n  else if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Template){\n    if(template_clip.get_Clip_id() == Template_clip_array.length){\n      createTemplateClipBox(template_clip);\n      Template_clip_array.push(template_clip);\n      template_clip = new _Share_js__WEBPACK_IMPORTED_MODULE_0__.TemplateClip(Template_clip_array.length , duration_track);\n      templateConnectToVisualAndSound(template_clip);\n      console.log(Template_clip_array)\n      alert(\"이펙트 저장\")\n    }\n    else{\n      Template_clip_array[template_clip.get_Clip_id()] = template_clip;\n      alert(\"이펙트 다시 저장\")\n    }\n  }\n  else if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Total){  //자지막 전부 저장하는 부분\n     generateMidi(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody);\n     generateMidi(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat);\n     let [videoId, videoData, videoDuration] = videoObject.get\n     for(let i=0;i <videoId.length; i++){\n      videoDownload(videoData[i], videoId[i], videoDuration[i])\n     }\n  }\n})\n\n\ndocument.getElementById(\"sheetMusicPlayButton\").addEventListener('click', function (){\n  startRecording();\n})\ndocument.getElementById(\"sheetMusicPauseButton\").addEventListener('click', function (){\n  stopRecording();\n  stopAllNotePlayer();\n  stopAllNotePlayer();\n})\ndocument.getElementById(\"sheetMusicDeleteButton\").addEventListener('click', function (){\n  if(noteClickIndex!=-1){\n    if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody){\n      melody_clip.deleteNote(noteClickIndex);\n      clearNoteClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody);\n      loadClip(melody_clip, melody_clip.getDuration());\n    }\n    else if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat){\n      beat_clip.deleteNote(noteClickIndex);\n      clearNoteClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat);\n      loadClip(beat_clip, beat_clip.getDuration())\n    }\n    else if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Lyrics){\n      melody_clip.deletelyric(noteClickIndex);\n      clearNoteClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody);\n      loadClip(melody_clip, melody_clip.getDuration());\n    }\n  }\n  noteClickIndex = -1; //선택 클립 number 초기화\n})\ndocument.getElementById(\"sheetMusicAllDeleteButton\").addEventListener('click', function (){\n  if (window.confirm(\"정말 클립 내용을 모두 삭제하시겠습니까?\")) {\n    if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody){\n      melody_clip = new _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody, melody_clip.getClipId(), duration);\n      clearNoteClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody);\n      loadClip(melody_clip, melody_clip.getDuration());\n    }\n    else if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat){\n      beat_clip = new _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat, beat_clip.getClipId(), duration);\n      clearNoteClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat);\n      loadClip(beat_clip, beat_clip.getDuration());\n    }\n    else if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Lyrics){\n      melody_clip.dleteAlllyric();\n      clearNoteClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Lyrics);\n      loadClip(melody_clip, melody_clip.getDuration());\n    }\n  }\n})\n\n/* Synthesizer Event Code */\n_Share_js__WEBPACK_IMPORTED_MODULE_0__.SyntheysizerEvents.addEventListener('pianoKeyInput', function (e){\n  doubleChecker += 1\n  if(doubleChecker%2 ==0){\n    if(play_state && current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody){\n      melody_clip.setNoteInput(e.detail.note, currentTime);\n        //console.log(\"noteInpu Check\", e.detail.note)\n      let NoteItem = createResizeDragElement(e.detail.note, time_to_px(currentTime, currentClipDuration()), melody_clip.getNoteIndex(), _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody);\n      onNoteList.push(NoteItem); \n    }\n  }\n})\n_Share_js__WEBPACK_IMPORTED_MODULE_0__.SyntheysizerEvents.addEventListener('pianoKeyOutput', function (e){\n  doubleChecker += 1\n  if(doubleChecker%2 ==0){\n    if(play_state && current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody){\n      melody_clip.setNoteRelease(e.detail.note, currentTime);\n      noteOff(e.detail.note)\n    }\n  }\n})\n_Share_js__WEBPACK_IMPORTED_MODULE_0__.SyntheysizerEvents.addEventListener('padkeyInput', function (e){\n  doubleChecker += 1\n  if(doubleChecker%2 ==0){\n    if(play_state && current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat){\n      beat_clip.setBeatInput(e.detail.id, currentTime);\n      console.log(\"Pad Input\")\n      let PadItem = createResizeDragElement(e.detail.id, time_to_px(currentTime, currentClipDuration()), beat_clip.getNoteIndex(), _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat);\n    }\n  }\n})\n_Share_js__WEBPACK_IMPORTED_MODULE_0__.SyntheysizerEvents.addEventListener('dialInput', function(e){\n  doubleChecker += 1\n  if(doubleChecker%2 ==0){\n    template_clip.set_dial(e.detail.value);\n    document.getElementById(\"dial_1\").value = e.detail.value[0][0]\n    document.getElementById(\"dial_2\").value = e.detail.value[0][1]\n    document.getElementById(\"dial_3\").value = e.detail.value[0][2]\n    document.getElementById(\"dial_4\").value = e.detail.value[0][3]\n  }\n})\n\n/*Clip Edit code*/\n// clipduration.addEventListener(\"change\", function(){ //Clip duration change code\n//   changeClipDuration(parseFloat(clipduration.value));\n// })\n// function changeClipDuration(inputDuration){\n//   duration = inputDuration\n//   console.log(\"Clip duration Set : \", duration);\n//   noteSizeAllOff();\n//   clearNoteClip(current_clip_type);\n//   if(time_to_px(currentTime, duration) >= clip_box_width){\n//     $(\"#slider\").slider(\"value\", clip_box_width);\n//     timeLine2.style.left = (clip_box_width-clip_start_px) + \"px\";\n//     timeLine1.style.left = (clip_box_width-clip_start_px) + \"px\";\n//   }\n//   else{\n//     $(\"#slider\").slider(\"value\",time_to_px(currentTime, duration));\n//     timeLine2.style.left = (time_to_px(currentTime, duration)-clip_start_px) + \"px\";\n//     timeLine1.style.left = (time_to_px(currentTime, duration)-clip_start_px) + \"px\";\n//   }\n//   if(current_clip_type == MusicClipType.Melody){\n//     melody_clip.setDuration(duration);\n//     template_clip.set_duration(duration);\n//     loadClip(melody_clip, duration);\n//   }\n//   else if(current_clip_type == MusicClipType.Beat){\n//     beat_clip.setDuration(duration);\n//     loadClip(beat_clip, duration);\n//   }\n// }\nfunction removeAllElementsByClassName(className) {//\n  const elements = document.getElementsByClassName(className);\n  while (elements.length > 0) {\n    elements[0].parentNode.removeChild(elements[0]);\n  }\n}\nfunction clearNoteClip(type){// 편집기에 모든 노트 제거\n  if(type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody){\n    removeAllElementsByClassName(\"resize-drag\");\n    removeAllElementsByClassName(\"resize-lyrics\");\n  }\n  if(type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Lyrics){\n    removeAllElementsByClassName(\"resize-lyrics\");\n  }\n  else{\n    removeAllElementsByClassName(\"draggable\");\n  }\n}\nfunction clearExampleClip(type){\n  if(type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody){\n    removeAllElementsByClassName(\"inresize-drag\");\n  }\n  else{\n    removeAllElementsByClassName(\"indraggable\");\n  }\n}\n\n\nfunction loadClip(MusicClip, duration){ // 입력 클립을 편집기에 반영\n  console.log(\"load Clip\", MusicClip);\n  console.log(\"duration \", duration);\n  if(MusicClip.getClipType() == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody){\n    const [NoteSet, TimeSet] = MusicClip.getMusicClip();\n    //const lyricsList = MusicClip.getLyrics();\n    for(let i=0; i<NoteSet.length; i++){\n      let NoteItem = createResizeDragElement(NoteSet[i], time_to_px(TimeSet[i][0], duration), i, _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody);\n      noteResizeChanger(NoteItem, time_to_px(TimeSet[i][1], duration));\n    }\n    const [LyricsSet, LyricsTimeSet, LyricsVideoId] = MusicClip.getAllLyrics();\n    for(let i=0; i<LyricsSet.length; i++){\n      createLyricsObject(i, LyricsSet[i], LyricsTimeSet[i][0],LyricsTimeSet[i][1], LyricsVideoId[i])\n    }\n  }\n  else{\n    const [padSet, TimeSet] = MusicClip.getMusicClip()\n    for(let i=0; i<padSet.length; i++){\n      let NoteItem = createResizeDragElement(padSet[i], time_to_px(TimeSet[i], duration), i, _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat);\n    }\n  }\n  noteClickIndex = -1;\n}\n\nfunction changeMusicClip(noteIndex, deltaTimeset){ // 노트 위치, 크기 편집을 클립 시간에 반영\n  if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody){\n    melody_clip.editNote(noteIndex, deltaTimeset)\n  }\n  else if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat){\n    beat_clip.editNote(noteIndex, deltaTimeset)\n  }\n}\nfunction changelyricsClip(noteIndex, deltaTimeset){ // 노트 위치, 크기 편집을 클립 시간에 반영\n  if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody||current_clip_type==_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Lyrics){\n    melody_clip.editLyrics(noteIndex, deltaTimeset);\n  }\n}\n\n//-------------------------------------------------------------------------------------------------------------------//\n//-------------------------------------------------------------------------------------------------------------------//\n//------------------------------------------- Track Code------------------------------------------------------//\n//-------------------------------------------------------------------------------------------------------------------//\n//-------------------------------------------------------------------------------------------------------------------//\n\n//Track Clip Icon Maker\nfunction createClipBox(musicClip) { //Melody, Beat 노트 생성\n  let currenctCliptType = musicClip.getClipType();\n  let clip_id = musicClip.getClipId();\n  const dragdrop = document.createElement(\"div\");\n  dragdrop.classList.add(\"drag-drop\");  // resize-drag로 생성\n  dragdrop.setAttribute(\"clip_id\", clip_id); // clip_id 속성 추가\n  dragdrop.setAttribute(\"clip_type\", currenctCliptType); // clip_type 속성 추가\n  dragdrop.addEventListener(\"click\", function(){\n    console.log(\"current Clip Type:\", dragdrop.getAttribute(\"clip_type\"),\"current Clip id\", dragdrop.getAttribute(\"clip_id\"))\n    loadFromTrackToMusicClip(dragdrop.getAttribute(\"clip_type\"), dragdrop.getAttribute(\"clip_id\"));\n  })\n  if(currenctCliptType == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody){\n    dragdrop.textContent = \"멜로디 \" + (clip_id+1); //내용이 있어야 나와서 -로 일단 임시로 추가\n    dragdrop.setAttribute(\"id\", \"melody-drop\");\n    let boxItem = document.getElementById(\"MelodydropContainer\");\n    boxItem.appendChild(dragdrop);\n  }\n  else{\n    dragdrop.textContent = \"비트 \" + (clip_id+1); //내용이 있어야 나와서 -로 일단 임시로 추가\n    dragdrop.setAttribute(\"id\", \"beat-drop\");\n    let boxItem = document.getElementById(\"BeatdropContainer\");\n    boxItem.appendChild(dragdrop);\n  }\n}\nfunction createTemplateClipBox(template_clip){\n  let clip_id = template_clip.get_Clip_id()\n  const dragdrop_template = document.createElement(\"div\");\n  dragdrop_template.classList.add(\"drag-drop\");  // resize-drag로 생성\n  dragdrop_template.setAttribute(\"clip_id\", clip_id); // clip_id 속성 추가\n  dragdrop_template.setAttribute(\"clip_type\", _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Template); // clip_type 속성 추가\n  dragdrop_template.addEventListener(\"click\", function(){\n    //console.log(\"current Clip Type:\", dragdrop_template.getAttribute(\"clip_type\"),\"current Clip id\", dragdrop_template.getAttribute(\"clip_id\"))\n    loadFromTrackToTemplateClip(dragdrop_template.getAttribute(\"clip_id\"));\n  })\n    dragdrop_template.textContent = \"효과 \" + (clip_id+1); //내용이 있어야 나와서 -로 일단 임시로 추가\n    dragdrop_template.setAttribute(\"id\", \"template-drop\");\n    let boxItem_template = document.getElementById(\"TemplatedropContainer\");\n    boxItem_template.appendChild(dragdrop_template);\n  }\n\n\n//Track Clip Object 생성용 코드(melody, Beat용)\nfunction createTrackClipObject(dropzoneName, clipType, clip_id, duration, box_id){\n  //let clipType = musicClip.getClipType();\n  //let clip_id = musicClip.getClipId();\n  //let duration = musicClip.getDuration();\n  //console.log(\"duration Check\", duration);\n  const trackClip = document.createElement(\"div\");\n  trackClip.classList.add(\"draggable_clip\");\n  trackClip.style.width = time_to_px(duration, duration_track, track_box_width, 0) + \"px\"\n\n  if(clipType == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody){\n    trackClip.textContent = \"멜로디\" + (clip_id + 1); //내용이 있어야 나와서 -로 일단 임시로 추가\n    //dragdrop.setAttribute(\"id\", \"melody-drop\");\n  }\n  else{\n    trackClip.textContent = \"비트\" + (clip_id + 1); //내용이 있어야 나와서 -로 일단 임시로 추가\n    //dragdrop.setAttribute(\"id\", \"beat-drop\");\n  }\n  let boxItem = document.getElementById(dropzoneName);\n  trackClip.setAttribute(\"box_id\", box_id); // clip_id 속성 추가\n  trackClip.setAttribute(\"box_type\", clipType); // clip_type 속성 추가\n  trackClip.addEventListener(\"click\", function(){\n    console.log(\"type:\", trackClip.getAttribute(\"box_type\"), \"id\", trackClip.getAttribute(\"box_id\"));\n    trackClickIndex = trackClip.getAttribute(\"box_id\");\n    trackClickType = trackClip.getAttribute(\"box_type\");\n  })\n  boxItem.appendChild(trackClip);\n  return px_to_time_Scale(trackClip.offsetLeft, duration_track, track_box_width, 0)\n}\n\n//Track Clip Object 생성용 코드(Template용)\nfunction createTrackClipObject_template(dropzoneName, clip_id, box_id){\n  const trackClip = document.createElement(\"div\");\n  trackClip.classList.add(\"resize-drag_clip\");\n  trackClip.style.width = time_to_px(60, duration_track, track_box_width, 0) + \"px\"\n  let boxItem = document.getElementById(dropzoneName);\n  trackClip.textContent = \"효과\" + (clip_id+1)\n  trackClip.setAttribute(\"box_id\", box_id); // clip_id 속성 추가\n  trackClip.setAttribute(\"box_type\", _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Template); // clip_type 속성 추가\n  trackClip.addEventListener(\"click\", function(){\n    console.log(\"type:\", trackClip.getAttribute(\"box_type\"), \"id\", trackClip.getAttribute(\"box_id\"));\n    trackClickIndex = trackClip.getAttribute(\"box_id\");\n    trackClickType = trackClip.getAttribute(\"box_type\");\n  })\n  boxItem.appendChild(trackClip);\n  return px_to_time_Scale(trackClip.offsetLeft, duration_track, track_box_width, 0)\n}\n\n//clip 정보를 가져오는 코드\nfunction get_clip(clipType, clip_id){\n  if(clipType == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody){\n    return Melody_clip_array[clip_id]\n    //dragdrop.setAttribute(\"id\", \"melody-drop\");\n  }\n  else{\n    return Beat_clip_array[clip_id]\n    //dragdrop.setAttribute(\"id\", \"beat-drop\");\n  }\n}\n\n$(\"#slider_track\").slider({ //Timer 슬라이더2\n  value: 0,\n  min: 0,\n  max: track_box_width,\n  step: 0.1,\n  slide: function( event, ui ) {\n    timeLine3.style.left = (ui.value) + \"px\";\n    currentTrackTime = px_to_time(ui.value, duration_track, track_box_width, 0)\n    //console.log(\"Track Time\", currentTrackTime)\n  }\n});\n\nfunction updateTime2() { //시간에 따라 업데이트 해야하는 함수들\n  if(bpmPlayNumber > 4){\n    currentTrackTime += 1/fps\n    //musicPlayer(currentTime);\n    $(\"#slider_track\").slider(\"value\",time_to_px(currentTrackTime, duration_track, track_box_width, 0));\n    timeLine3.style.left = time_to_px(currentTrackTime, duration_track, track_box_width, 0) + \"px\";\n    //console.log(\"Test Track\", cur_track_set[0][1]);\n    let cur_track_set = TrackObject.getcurrentClipSet(currentTrackTime);\n    //console.log(cur_track_set)\n    if(cur_track_set[0].length > 0){\n      //console.log(Template_clip_array);\n      templatePlayerClip(Template_clip_array[cur_track_set[0][1]]);\n    }\n    if(cur_track_set[1].length > 0){\n      musicPlayerMelodyClip(currentTrackTime - cur_track_set[1][0], Melody_clip_array[cur_track_set[1][1]]);\n      if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody || current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Lyrics){ // 클립 로드\n        if(melody_clip != Melody_clip_array[cur_track_set[1][1]]){\n          melody_clip = Melody_clip_array[cur_track_set[1][1]];\n          clearNoteClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody);\n          loadClip(melody_clip, melody_clip.getDuration());\n        }\n        ClipUpdateTimeControl(currentTrackTime - cur_track_set[1][0]);\n      }\n    }\n    if(cur_track_set[2].length > 0){\n      musicPlayerBeatClip(currentTrackTime - cur_track_set[2][0], Beat_clip_array[cur_track_set[2][1]]);\n      if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat){// 클립 로드\n        if(beat_clip != Beat_clip_array[cur_track_set[2][1]]){\n          beat_clip = Beat_clip_array[cur_track_set[2][1]];\n          clearNoteClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat);\n          loadClip(beat_clip, beat_clip.getDuration());\n        }\n        ClipUpdateTimeControl(currentTrackTime - cur_track_set[2][0])\n      }\n    }\n    if(currentTrackTime >= duration_track){\n      stopTrack() // 끝 도달하면 자동으로 종료\n    }\n  }\n}\nfunction initializeTimer2(){ // Timer 초기화\n  $(\"#slider_track\").slider(\"value\",time_to_px(currentTrackTime, duration_track, track_box_width, 0));\n  timeLine3.style.left = time_to_px(currentTrackTime, duration_track, track_box_width, 0) + \"px\";\n}\nfunction musicPlayerMelodyClip(currentTime, melody_clip){  //음이나 비트 소리를 재생하는 코드\n  let currentNote = melody_clip.getcurrentNoteSet(currentTime);\n  notePlayer(currentNote, previousNote_track);\n  previousNote_track = melody_clip.getcurrentNoteSet(currentTime);\n  showLyrics(currentTime);\n}\nfunction musicPlayerBeatClip(currentTime, beat_clip){  //음이나 비트 소리를 재생하는 코드\n  let currentBeat = beat_clip.getcurrentNoteSet(currentTime);\n  for (let beat of currentBeat){\n    (0,_Synthesizer_js__WEBPACK_IMPORTED_MODULE_1__.beat_player)(beat);\n    setTimeout(() => (0,_Synthesizer_js__WEBPACK_IMPORTED_MODULE_1__.beat_output_play)(beat), 100);\n  }\n}\nfunction templatePlayerClip(inputClip){\n  if(inputClip.get_Clip_id() != previousDial_ID){\n    //console.log(\"id\", inputClip.get_Clip_id())\n    template_clip = inputClip\n    templateConnectToVisualAndSound(inputClip);\n     previousDial_ID = inputClip.get_Clip_id();\n  }\n}\nfunction templateConnectToVisualAndSound(inputClip){\n  const event = new CustomEvent('templateLoad', { detail: inputClip.get_dial() });\n  _Share_js__WEBPACK_IMPORTED_MODULE_0__.SyntheysizerEvents.dispatchEvent(event);\n}\nfunction clearAllBoxClip(){// 편집기에 모든 노트 제거\n  InitializeAllTrack();\n  removeAllElementsByClassName(\"drag-drop\");\n}\nfunction InitializeAllTrack(){\n  removeAllElementsByClassName(\"resize-drag_clip\");\n  removeAllElementsByClassName(\"draggable_clip\");\n}\ndocument.getElementById(\"trackMusicPlayButton\").addEventListener('click', function (){\n  startTrack();\n})\ndocument.getElementById(\"trackMusicPauseButton\").addEventListener('click', function (){\n  stopTrack();\n  stopAllNotePlayer2();\n})\ndocument.getElementById(\"trackMusicDeleteButton\").addEventListener('click', function (){\n  TrackObject.deleteClip(trackClickType, trackClickIndex);\n  InitializeAllTrack();\n  loadTrack(TrackObject);\n})\nfunction loadTrack(MusicTrack){ // Track을 편집기에 반영\n  const [TemplateId, TemplateTimeset] = MusicTrack.getTemplateSet()\n  const [MelodyClipId, MelodyTimeset] = MusicTrack.getMelodySet()\n  const [BeatClipId, BeatTimeset] = MusicTrack.getBeatSet()\n  for(let i=0; i<TemplateId.length; i++){\n    createTrackClipObject_template('template-dropzone', TemplateId[i], i);\n  }\n  for(let i=0; i<MelodyClipId.length; i++){\n    createTrackClipObject(\"melody-dropzone\", _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody, MelodyClipId[i], MelodyTimeset[i][1]-MelodyTimeset[i][0], i)\n  }\n  for(let i=0; i<BeatClipId.length; i++){\n    createTrackClipObject(\"beat-dropzone\", _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat, BeatClipId[i], BeatTimeset[i][1]-BeatTimeset[i][0], i)\n  }\n}\n\nfunction stopAllNotePlayer2(){\n  if(previousNote_track.length > 0){\n    //console.log(\"Ouput \", exclusiveArr2);\n    for( let note of previousNote_track){\n      (0,_Synthesizer_js__WEBPACK_IMPORTED_MODULE_1__.piano_player)(note, false);\n    }  \n  }\n  previousNote_track - [];\n}\nfunction loadFromTrackToMusicClip(clip_type, clip_id){\n  if(clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody){\n    if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Lyrics){  //클릭 당시 Lyrics 씬일 때만 적용\n      lyricsTypeSceneChanger();\n      clearNoteClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody);\n      melody_clip = Melody_clip_array[clip_id];\n      loadClip(melody_clip, melody_clip.getDuration());\n    }\n    else{                                           // 나머지는 다 Melody 씬으로 이동\n      melodyTypeSceneChanger();\n      clearNoteClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody);\n      melody_clip = Melody_clip_array[clip_id];\n      loadClip(melody_clip, melody_clip.getDuration());\n    }\n  }\n  else{\n    beatTypeSceneChanger();\n    clearNoteClip(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat);\n    beat_clip = Beat_clip_array[clip_id];\n    loadClip(beat_clip, beat_clip.getDuration());\n  }\n}\nfunction loadFromTrackToTemplateClip(clip_id){\n  templateTypeSceneChanger();\n  templateConnectToVisualAndSound(template_clip);\n}\n\n//-------------------------------------------------------------------------------------------------------------------//\n//-------------------------------------------------------------------------------------------------------------------//\n//-------------------------------------------- File Save and upLoad code -------------------------------------------//\n//-------------------------------------------------------------------------------------------------------------------//\n//-------------------------------------------------------------------------------------------------------------------//\n\nfunction downloadJsonFile(filename, data) { // 객체를 JSON 파일로 다운로드하는 함수\n  const jsonData = JSON.stringify(data);\n  const blob = new Blob([jsonData], { type: 'application/json' });\n  const url = URL.createObjectURL(blob);\n\n  const link = document.createElement('a');\n  link.download = filename;\n  link.href = url;\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n  URL.revokeObjectURL(url);\n}\n//Track이랑 Clip을 따로 파일로 저장하는 함수, Track은 Clip의 위치값만 있기 때문에 한 번에 가져와야함\nconst tmp_Meldoy_array = []\nconst tmp_Beat_array = []\nconst tmp_template_array = []\n\n\n// document.getElementById(\"trackMusicSaveButton\").addEventListener('click', function(){\n//   generateMidi(MusicClipType.Melody);\n//   generateMidi(MusicClipType.Beat);\n//   let MusicTrackObejct = {\n//     \"Type\":\"MusicTrack\",\n//     \"user_Id\": TrackObject.getUserId(),\n//     \"id_set\" : TrackObject.getIdData(),\n//     \"time_set\" : TrackObject.getTimeData()\n//   }\n//   //downloadJsonFile(\"MusicTrack_\" + TrackObject.getUserId(), MusicTrackObejct);  //Track 정보 저장\n//   if(current_clip_type == MusicClipType.Template){\n//     for(let i = 0; i < Template_clip_array.length; i ++){\n//       let templateObejct = {\n//         \"userName\":userName,\n//         \"musicName\":musicId,\n//         \"Type\": MusicClipType.Template,\n//         \"CLip id\": Template_clip_array[i].get_Clip_id(),\n//         \"duration\": Template_clip_array[i].get_duration(),\n//         \"instrument\": Template_clip_array[i].get_instrument(),\n//         \"dial_set\": Template_clip_array[i].get_dial()\n//       }\n//       downloadJsonFile(\"template_clip_\" + userName + \"_\" + musicId, templateObejct); \n//     }\n//   }\n//   if(current_clip_type == MusicClipType.Melody){\n//     for(let i = 0; i < Melody_clip_array.length; i ++){\n//       let MusicObejct = {\n//         \"userName\":userName,\n//         \"musicName\":musicId,\n//         \"Type\": Melody_clip_array[i].getClipType(),\n//         \"CLip id\": Melody_clip_array[i].getClipId(),\n//         \"duration\": Melody_clip_array[i].getDuration(),\n//         \"noteSet\": Melody_clip_array[i].getMusicClip()[0],\n//         \"timeSet\": Melody_clip_array[i].getMusicClip()[1],\n//       }\n//       downloadJsonFile(\"Melody_clip_\" + userName + \"_\" + musicId, MusicObejct); \n//     }\n//   }\n//   if(current_clip_type == MusicClipType.Beat){\n//     for(let i = 0; i < Beat_clip_array.length; i ++){\n//       let MusicObejct = {\n//         \"userName\":userName,\n//         \"musicName\":musicId,\n//         \"Type\": Beat_clip_array[i].getClipType(),\n//         \"CLip id\": Beat_clip_array[i].getClipId(),\n//         \"duration\": Beat_clip_array[i].getDuration(),\n//         \"noteSet\": Beat_clip_array[i].getMusicClip()[0],\n//         \"timeSet\": Beat_clip_array[i].getMusicClip()[1]\n//       }\n//       downloadJsonFile(\"Beat_clip_\" + userName + \"_\" + musicId, MusicObejct); \n//     }\n//   }\n//})\n\n\n\n/*------------------------------------------laod MIDI Code -------------------------------------------- */\ndocument.getElementById(\"sheetMusicLoadButton\").addEventListener('click', function (){\n  FileInput.click();\n})\nFileInput.addEventListener('change', function(e){\n  // const Files = e.target.files;\n  // for(let file of Files){\n  //   const reader = new FileReader();\n  //   reader.onload = function(event) {\n  //     const contents = event.target.result;\n  //     const jsonObject = JSON.parse(contents);\n  //     if(jsonObject[\"Type\"]==MusicClipType.Melody){\n  //       let Tmp_melody_clip = new MusicClip(jsonObject[\"Type\"], jsonObject[\"CLip_id\"], jsonObject[\"duration\"], jsonObject[\"noteSet\"], jsonObject[\"TimeSet\"])\n  //       console.log(\"Melody push\", Tmp_melody_clip);\n  //       tmp_Meldoy_array.push(Tmp_melody_clip)\n  //     }\n  //     if(jsonObject[\"Type\"]==MusicClipType.Beat){\n  //       let Tmp_beat_clip = new MusicClip(jsonObject[\"Type\"], jsonObject[\"CLip_id\"], jsonObject[\"duration\"], jsonObject[\"noteSet\"], jsonObject[\"TimeSet\"]);\n  //       console.log(\"Beat push\", Tmp_beat_clip);\n  //       tmp_Beat_array.push(Tmp_beat_clip);\n  //     }\n  //     if(jsonObject[\"Type\"]==MusicClipType.Template){\n  //       let Tmp_template_clip = new TemplateClip(jsonObject[\"CLip_id\"], jsonObject[\"duration\"], jsonObject[\"instrument\"]);\n  //       Tmp_template_clip.set_dial(jsonObject[\"dial_set\"]);\n  //       console.log(\"Template push\", Tmp_template_clip);\n  //       tmp_template_array.push(Tmp_template_clip);\n  //     }\n  //     if(jsonObject[\"Type\"]==\"MusicTrack\"){\n  //       TrackObject = new MusicTrack(jsonObject[\"user_Id\"], jsonObject[\"id_set\"], jsonObject[\"time_set\"]);\n  //       console.log(\"TrackObject : \", TrackObject);\n  //     }\n  //   };\n  //   reader.readAsText(file);\n  const file = e.target.files[0];\n  const reader = new FileReader();\n  reader.onload = function(e) {\n      try {\n          const data = new Uint8Array(e.target.result);\n          const smf = new JZZ.MIDI.SMF(data.buffer);\n          getMididata(smf[0])\n      } catch (error) {\n          console.error('Error parsing MIDI file:', error);\n      }\n  };\n  reader.onerror = function() {\n      console.error('Error reading file:', reader.error);\n  };\n  reader.readAsArrayBuffer(file);\n})\nlet OverMidiDataChecker = false;\n\nfunction clipDurationNormalize(type){\n  if(type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody){\n    if(melody_clip.getNoteIndex() != 0){\n      melody_clip.setDuration(melody_clip.getClipLastTime()+ 0.1);\n    }\n    else{\n      console.log(\"there isn't note\")\n    }\n  }\n  else{\n    if(beat_clip.getNoteIndex() != 0){\n      beat_clip.setDuration(beat_clip.getClipLastTime()+ 0.1);\n    }\n    else{\n      console.log(\"there isn't note\")\n    }\n  }\n}\nfunction setMidiToMelodyClip(inputLog){\n  let [channel, input, note, time] = inputLog\n  if(channel == 0){\n    if(input){\n      melody_clip.setNoteInput(note,time);\n    }\n    else{\n      melody_clip.setNoteRelease(note,time);\n    }\n  }\n}\nfunction setMidiToBeatClip(inputLog){\n  let [channel, input, note, time] = inputLog\n  if(input){\n    console.log(\"note :\", note.slice(0, -1), \"index :\", midiBeatNote.indexOf(note.slice(0, -1)), \"time:\", time)\n    if(midiBeatNote.indexOf(note.slice(0, -1)) != -1){\n      beat_clip.setBeatInput(midiBeatNote.indexOf(note.slice(0, -1)), time)\n    }\n    else{\n      OverMidiDataChecker = true;\n    }\n  }\n}\nfunction getMididata(midiData) { \n  console.log(\"current Type\", current_clip_type);\n  newClipCreater();  \n  for(let i = 0; i<midiData.length; i++){\n    if(midiData[i].length > 0){\n      let MidiTextLine = getMidiLine(midiData[i])\n      if(MidiTextLine != null){\n        if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody){\n          setMidiToMelodyClip(MidiTextLine)\n        }\n        else if(current_clip_type==_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat){\n          setMidiToBeatClip(MidiTextLine)\n        }\n      }\n    }\n  }\n  if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody){\n    clipDurationNormalize(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Melody)\n    console.log(melody_clip)\n    loadClip(melody_clip, melody_clip.getDuration())\n  }\n  else if(current_clip_type == _Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat){\n    clipDurationNormalize(_Share_js__WEBPACK_IMPORTED_MODULE_0__.MusicClipType.Beat)\n    console.log(beat_clip)\n    loadClip(beat_clip, beat_clip.getDuration())\n  }\n  if(OverMidiDataChecker){\n    alert(\"범위에서 벗어난 MIDI 정보가 있습니다. 일부는 적용이 안됩니다.\")\n    OverMidiDataChecker = false;\n  }\n}\n\nfunction getMidiLine(midiLine){\n  if(midiLine[0] >= 144 && midiLine[0] <= 154){\n    return [midiLine[0] - 144, true, pitch2NoteMidi(midiLine[1]), midiLine.tt/midiBPM/2]\n  }\n  else if(midiLine[0] >= 128 && midiLine[0] <= 138){\n    return [midiLine[0] - 128, false, pitch2NoteMidi(midiLine[1]), midiLine.tt/midiBPM/2]\n  }\n  else if(midiLine[0] >= 192 && midiLine[0] <= 202){\n    console.log(\"channel :\", midiLine[0] - 192, \" setting MIDI Instrument :\", midiLine[1])\n    return null\n  }\n  else{\n    //console.log(\"except check here\");\n    console.log(\"except check here\", midiLine);\n    OverMidiDataChecker = true;\n    return null\n  }\n}\n\nfunction pitch2NoteMidi(input_pitch){\n  let noteType = [\"C\",\"C#\",\"D\",\"D#\",\"E\",\"F\",\"F#\",\"G\",\"G#\",\"A\",\"A#\",\"B\"]\n  return noteType[(input_pitch -12)%12] + String(parseInt((input_pitch - 12)/12))\n}\n\n\n/*------------------------------------------laod MIDI Code -------------------------------------------- */\n\n//-------------------------------------------------------------------------------------------------------------------//\n//-------------------------------------------------------------------------------------------------------------------//\n//---------------------------------------------가사 관련 추가 코드---------------------------------------------------//\n//-------------------------------------------------------------------------------------------------------------------//\n//-------------------------------------------------------------------------------------------------------------------//\n\n\n\ndocument.getElementById(\"LyricsPushButton\").addEventListener(\"click\", function(){\n  let lyricsDefaultTime = parseInt(melody_clip.getDuration()/10)\n  if(lyricsDefaultTime < 1){\n    lyricsDefaultTime = 1\n  }\n  let lyricsText = document.getElementById(\"lyricsInputer\").value;\n  if(lyricsText != \"\"){\n    let lyricsLastTime = melody_clip.getLyricsLastTime();\n    let lyticsId = melody_clip.getLyricsIndex()\n    melody_clip.setLyrics(lyricsText,[lyricsLastTime, lyricsLastTime + lyricsDefaultTime])\n    createLyricsObject(lyticsId, lyricsText, lyricsLastTime, lyricsLastTime + lyricsDefaultTime, -1);\n  }\n  document.getElementById(\"lyricsInputer\").value = \"\"\n})\nfunction createLyricsObject(note_id, lyricsText, startTime, endTime, LyricsVideoId){\n  const boxItem = document.getElementById(\"LyricsBox1\");\n  const lyricsNote = document.createElement(\"div\");\n  lyricsNote.classList.add(\"resize-lyrics\");\n\n  lyricsNote.style.left = time_to_px(startTime, currentClipDuration()) + \"px\";\n  lyricsNote.style.width = time_to_px_Scale(endTime - startTime, currentClipDuration()) + \"px\";\n  lyricsNote.textContent = lyricsText\n  lyricsNote.setAttribute(\"note_id\", note_id); // clip_id 속성 추가\n  lyricsNote.setAttribute('id', note_id) // 색상 바꾸는 용도\n\n  \n  lyricsNote.addEventListener(\"click\", function(){\n\n\n    console.log(\"id\", lyricsNote.getAttribute(\"note_id\"));\n    noteClickIndex = lyricsNote.getAttribute(\"note_id\");\n\n\n    document.getElementById(\"lyricsWord\").innerHTML = lyricsNote.textContent;\n    let lyricsVideoId = melody_clip.getLyricsVideoId(lyricsNote.getAttribute(\"note_id\"))\n    if(lyricsVideoId != -1){\n      loadVideoClip(lyricsVideoId)\n      document.getElementById('lyricsVideo').innerHTML = \"수어 \" + (lyricsVideoId + 1);\n    }\n    else{\n      document.getElementById('lyricsVideo').innerHTML = \"none\";\n    }\n\n\n  })\n\n\n  lyricsNote.addEventListener(\"click\", function history(){\n    clickCount += 1;\n    clickedHistory.push(lyricsNote.id) // 아이디 히스토리 리스트로 넣기\n\n    // clickedHistory[-2] != clickedHistory[-1]\n    if (clickedHistory.length == 1){     //하나 이상 클릭했을 때\n      // console.log('히스토리', clickedHistory);\n      nowClicked = document.getElementById(clickedHistory[0]);\n      nowClicked.style.borderWidth = 'thick'\n    }\n\n    else if (clickedHistory.length > 1 && clickedHistory[clickedHistory.length - 1] != clickedHistory[clickedHistory.length - 2]){\n      nowClicked = document.getElementById(clickedHistory[clickedHistory.length - 1]);\n      previousClicked = document.getElementById(clickedHistory[clickedHistory.length - 2])\n\n      nowClicked.style.borderWidth = 'thick'\n      previousClicked.style.borderWidth = ''\n      \n    }})\n\n\n\n  boxItem.appendChild(lyricsNote);\n}\n\nfunction showLyrics(currentTime){\n  let [currentLyricsText, currentLyricsIndex] = melody_clip.getLyrics(currentTime);\n  document.getElementById(\"lyricsDisplay\").innerHTML = currentLyricsText;\n  playVideoControl(currentTime, currentLyricsIndex);\n}\n\n\n\ninteract('.resize-lyrics')\n  .resizable({\n    edges: { top: false, left: true, bottom: false, right: true },\n    listeners: {\n      move: function (event) {\n        let { x, y } = event.target.dataset\n        x = (parseFloat(x) || 0) + event.deltaRect.left\n        y = (parseFloat(y) || 0) + event.deltaRect.top\n        Object.assign(event.target.style, {\n          width: `${event.rect.width}px`,\n          height: `${event.rect.height}px`,\n          transform: `translate(${x}px, ${y}px)`\n        })\n        changelyricsClip(event.target.getAttribute(\"note_id\"), [px_to_time_Scale(event.deltaRect.left, currentClipDuration()), px_to_time_Scale(event.deltaRect.left + event.deltaRect.width, currentClipDuration())])\n        Object.assign(event.target.dataset, { x, y })\n      }\n    }\n  })\n  .draggable({\n    listeners: { move: window.dragMoveListener_lyrics },\n    inertia: true,\n    modifiers: [\n      interact.modifiers.restrictRect({\n        restriction: 'parent',\n        endOnly: true\n      })\n    ]\n  })\n  .draggable({\n    // enable inertial throwing\n    inertia: true,\n    // keep the element within the area of it's parent\n    modifiers: [\n      interact.modifiers.restrictRect({\n        restriction: 'parent',\n        endOnly: true\n      })\n    ],\n    // enable autoScroll\n    autoScroll: true,\n    listeners: {\n      // call this function on every dragmove event\n      move: dragMoveListener_lyrics,\n\n      // call this function on every dragend event\n      end (event) {\n        var textEl = event.target.querySelector('p')\n        textEl && (textEl.textContent =\n          'moved a distance of ' +\n          (Math.sqrt(Math.pow(event.pageX - event.x0, 2) +\n                     Math.pow(event.pageY - event.y0, 2) | 0))\n            .toFixed(2) + 'px')\n      }\n    }\n  })\nfunction dragMoveListener_lyrics(event) {\n  var target = event.target\n  // keep the dragged position in the data-x/data-y attributes\n  var x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx\n  var y = 0\n  // translate the element\n  target.style.transform = 'translate(' + x + 'px, ' + y + 'px)'\n  changelyricsClip(event.target.getAttribute(\"note_id\"), [px_to_time_Scale(event.dx, currentClipDuration()), px_to_time_Scale(event.dx, currentClipDuration())])\n  // update the posiion attributes\n  target.setAttribute('data-x', x)\n}\n\n//------------------------------------------- 매트로늄 생성용 코드---------------------------------------------------//\n\n\n//let bpmPlayOn = document.getElementById(\"BPMType\"); //bpm 온오프 설정용 예비함수1\n\nlet bpmHapticOn = false // bpm-beat haptic 설정용 예비함수2\nconst metronome = new Tone.Loop(time => {\n  const synth = new Tone.NoiseSynth().toDestination();\n  if(!document.getElementById(\"BPMType\").checked){\n    synth.triggerAttackRelease(\"2n\", time, 0.3);\n  }\n  if(document.getElementById(\"hapticType\").checked){\n    document.getElementById('HapticPlayButton1').click();\n  }\n  bpmPlayNumber += 1;\n}, \"4n\");\n\nfunction startMetronome() {\n  const bpm = parseFloat(document.getElementById(\"bpm\").value);\n  Tone.Transport.bpm.value = bpm;\n  metronome.start(0);\n  Tone.Transport.start();\n}\nfunction stopMetronome() {\n  metronome.stop();\n  Tone.Transport.stop();\n  bpmPlayNumber = 0;\n}\n\n\n\n//-------------------------------------------------------------------------------------------------------------------//\n//-------------------------------------------------------------------------------------------------------------------//\n//------------------------------------------- Note Interaction용 ----------------------------------------------------//\n//-------------------------------------------------------------------------------------------------------------------//\n//-------------------------------------------------------------------------------------------------------------------//\n\n\n//Piano clip note \ninteract('.resize-drag')\n  .resizable({\n    edges: { top: false, left: true, bottom: false, right: true },\n    listeners: {\n      move: function (event) {\n        let { x, y } = event.target.dataset\n        x = (parseFloat(x) || 0) + event.deltaRect.left\n        y = (parseFloat(y) || 0) + event.deltaRect.top\n        Object.assign(event.target.style, {\n          width: `${event.rect.width}px`,\n          height: `${event.rect.height}px`,\n          transform: `translate(${x}px, ${y}px)`\n        })\n        changeMusicClip(event.target.getAttribute(\"note_id\"), [px_to_time_Scale(event.deltaRect.left, currentClipDuration()), px_to_time_Scale(event.deltaRect.left + event.deltaRect.width, currentClipDuration())])\n        \n        Object.assign(event.target.dataset, { x, y })\n      }\n    }\n  })\n  .draggable({\n    listeners: { move: window.dragMoveListener_note },\n    inertia: true,\n    modifiers: [\n      interact.modifiers.restrictRect({\n        restriction: 'parent',\n        endOnly: true\n      })\n    ]\n  })\n  .draggable({\n    // enable inertial throwing\n    inertia: true,\n    // keep the element within the area of it's parent\n    modifiers: [\n      interact.modifiers.restrictRect({\n        restriction: 'parent',\n        endOnly: true\n      })\n    ],\n    // enable autoScroll\n    autoScroll: true,\n    listeners: {\n      // call this function on every dragmove event\n      move: dragMoveListener_note,\n\n      // call this function on every dragend event\n      end (event) {\n        var textEl = event.target.querySelector('p')\n        textEl && (textEl.textContent =\n          'moved a distance of ' +\n          (Math.sqrt(Math.pow(event.pageX - event.x0, 2) +\n                     Math.pow(event.pageY - event.y0, 2) | 0))\n            .toFixed(2) + 'px')\n      }\n    }\n  })\n  // Track Template\n  interact('.resize-drag_clip')\n  .resizable({\n    edges: { top: false, left: false, bottom: false, right: true },\n    listeners: {\n      move: function (event) {\n        let { x, y } = event.target.dataset\n        x = (parseFloat(x) || 0) + event.deltaRect.left\n        y = (parseFloat(y) || 0) + event.deltaRect.top\n        Object.assign(event.target.style, {\n          width: `${event.rect.width}px`,\n          height: `${event.rect.height}px`,\n          transform: `translate(${x}px, ${y}px)`\n        })\n        Object.assign(event.target.dataset, { x, y })\n      }\n    }\n  })\n\n//beat clip note \ninteract('.draggable')\n  .draggable({\n    listeners: { move: window.dragMoveListener_note },\n    inertia: true,\n    modifiers: [\n      interact.modifiers.restrictRect({\n        restriction: 'parent',\n        endOnly: true\n      })\n    ]\n  })\n  .draggable({\n    // enable inertial throwing\n    inertia: true,\n    // keep the element within the area of it's parent\n    modifiers: [\n      interact.modifiers.restrictRect({\n        restriction: 'parent',\n        endOnly: true\n      })\n    ],\n    // enable autoScroll\n    autoScroll: true,\n    listeners: {\n      // call this function on every dragmove event\n      move: dragMoveListener_note,\n\n      // call this function on every dragend event\n      end (event) {\n        var textEl = event.target.querySelector('p')\n\n        textEl && (textEl.textContent =\n          'moved a distance of ' +\n          (Math.sqrt(Math.pow(event.pageX - event.x0, 2) +\n                    Math.pow(event.pageY - event.y0, 2) | 0))\n            .toFixed(2) + 'px')\n      }\n    }\n  })\n\n//track music box\ninteract('.draggable_clip')\n.draggable({\n  listeners: { move: window.dragMoveListener_clip },\n  inertia: true,\n  modifiers: [\n    interact.modifiers.restrictRect({\n      restriction: 'parent',\n      endOnly: true\n    })\n  ]\n})\n.draggable({\n  // enable inertial throwing\n  inertia: true,\n  // keep the element within the area of it's parent\n  modifiers: [\n    interact.modifiers.restrictRect({\n      restriction: 'parent',\n      endOnly: true\n    })\n  ],\n  // enable autoScroll\n  autoScroll: true,\n  listeners: {\n    // call this function on every dragmove event\n    move: dragMoveListener_clip,\n\n    // call this function on every dragend event\n    end (event) {\n      var textEl = event.target.querySelector('p')\n\n      textEl && (textEl.textContent =\n        'moved a distance of ' +\n        (Math.sqrt(Math.pow(event.pageX - event.x0, 2) +\n                  Math.pow(event.pageY - event.y0, 2) | 0))\n          .toFixed(2) + 'px')\n    }\n  }\n})\n\n  function dragMoveListener_note (event) {\n    var target = event.target\n    // keep the dragged position in the data-x/data-y attributes\n    var x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx\n    var y = 0\n    // translate the element\n    target.style.transform = 'translate(' + x + 'px, ' + y + 'px)'\n    //console.log( \"id:\", event.target.getAttribute(\"note_id\"), \"Add timeset:\", [px_to_time_Scale(event.dx, duration), px_to_time_Scale(event.dx, duration)]);\n    changeMusicClip(event.target.getAttribute(\"note_id\"), [px_to_time_Scale(event.dx, currentClipDuration()), px_to_time_Scale(event.dx, currentClipDuration())])\n    // console.log(\"Add Plus :\", px_to_time(x, duration), \"id:\", target.getAttribute(\"note_id\"));\n    // update the posiion attributes\n    target.setAttribute('data-x', x)\n  }\n\n  function dragMoveListener_clip (event) {\n    var target = event.target\n    // keep the dragged position in the data-x/data-y attributes\n    var x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx\n    var y = 0\n    // translate the element\n    target.style.transform = 'translate(' + x + 'px, ' + y + 'px)'\n    //console.log( \"type:\", event.target.getAttribute(\"box_type\"), \"id:\", event.target.getAttribute(\"box_id\"), \"Add timeset:\", event.dx/10);\n    TrackObject.editMusicClip(event.target.getAttribute(\"box_type\"), event.target.getAttribute(\"box_id\"), px_to_time(event.dx, duration_track, track_box_width, 0))\n    // console.log(\"Add Plus :\", px_to_time(x, duration), \"id:\", target.getAttribute(\"note_id\"));\n    // update the posiion attributes\n    target.setAttribute('data-x', x)\n  }\n\n\n  //clip dropzone 설정용 코드\n  interact('.template-dropzone').dropzone({\n    // only accept elements matching this CSS selector\n    accept: '#template-drop',\n    // Require a 75% element overlap for a drop to be possible\n    overlap: 0.75,\n  \n    // listen for drop related events:\n  \n    ondropactivate: function (event) {\n      // add active dropzone feedback\n      event.target.classList.add('drop-active')\n    },\n    ondragenter: function (event) {\n      var draggableElement = event.relatedTarget\n      var dropzoneElement = event.target\n      // feedback the possibility of a drop\n      if(trackActivaqte){\n      dropzoneElement.classList.add('drop-target')\n      draggableElement.classList.add('can-drop')\n      //draggableElement.textContent = 'Dragged in'\n      event.target.classList.remove('drop-active')\n      event.target.classList.remove('drop-target')\n      const tempalteId = parseInt(event.relatedTarget.getAttribute(\"clip_id\"));\n      const clipTime = createTrackClipObject_template('template-dropzone', tempalteId, TrackObject.getTempalateId())\n        //console.log(\"clip Time Check\", clipTime/10);\n      TrackObject.setTemplateClip(tempalteId, clipTime)\n        trackActivaqte = false;\n      }\n    },\n    ondragleave: function (event) {\n      // remove the drop feedback style\n      event.target.classList.remove('drop-target')\n      event.relatedTarget.classList.remove('can-drop')\n      //event.relatedTarget.textContent = 'Dragged out'\n    },\n    ondrop: function (event) {\n      //event.relatedTarget.textContent = 'Dropped'\n    },\n    ondropdeactivate: function (event) {\n      // remove active dropzone feedback\n      trackActivaqte = true\n    }\n  })\n\n  interact('.melody-dropzone').dropzone({\n    // only accept elements matching this CSS selector\n    accept: '#melody-drop',\n    // Require a 75% element overlap for a drop to be possible\n    overlap: 0.75,\n    // listen for drop related events:\n    ondropactivate: function (event) {\n      // add active dropzone feedback\n      event.target.classList.add('drop-active')\n    },\n    ondragenter: function (event) {\n      var draggableElement = event.relatedTarget\n      var dropzoneElement = event.target\n      if(trackActivaqte){\n      // feedback the possibility of a drop\n      dropzoneElement.classList.add('drop-target')\n      draggableElement.classList.add('can-drop')\n      //draggableElement.textContent = 'Dragged in'\n      event.target.classList.remove('drop-active')\n      event.target.classList.remove('drop-target')\n      const Tmp_clip = get_clip(event.relatedTarget.getAttribute(\"clip_type\"), event.relatedTarget.getAttribute(\"clip_id\"))\n      const clipTime = createTrackClipObject('melody-dropzone', Tmp_clip.getClipType(), Tmp_clip.getClipId(), Tmp_clip.getDuration(), TrackObject.getMelodyId())\n      //console.log(\"clip Time Check\", clipTime/10);\n      TrackObject.setMusicClip(Tmp_clip, clipTime)\n        trackActivaqte = false;\n      }\n    },\n    ondragleave: function (event) {\n      // remove the drop feedback style\n      event.target.classList.remove('drop-target')\n      event.relatedTarget.classList.remove('can-drop')\n      //event.relatedTarget.textContent = 'Dragged out'\n    },\n    ondrop: function (event) {\n      //event.relatedTarget.textContent = 'Dropped'\n      //createTrackClipObject('melody-dropzone',get_clip(event.target.getAttribute(\"clip_id\"), event.target.getAttribute(\"clip_type\")))\n\n    },\n    ondropdeactivate: function (event) {\n      // remove active dropzone feedback\n      trackActivaqte = true\n    }\n  })\n\n    interact('.beat-dropzone').dropzone({\n    // only accept elements matching this CSS selector\n    accept: '#beat-drop',\n    // Require a 75% element overlap for a drop to be possible\n    overlap: 0.75,\n    // listen for drop related events:\n    ondropactivate: function (event) {\n      // add active dropzone feedback\n      event.target.classList.add('drop-active')\n    },\n    ondragenter: function (event) {\n      var draggableElement = event.relatedTarget\n      var dropzoneElement = event.target\n      if(trackActivaqte){\n      // feedback the possibility of a drop\n      dropzoneElement.classList.add('drop-target')\n      draggableElement.classList.add('can-drop')\n      //draggableElement.textContent = 'Dragged in'\n      event.target.classList.remove('drop-active')\n      event.target.classList.remove('drop-target')\n      const Tmp_clip = get_clip(event.relatedTarget.getAttribute(\"clip_type\"), event.relatedTarget.getAttribute(\"clip_id\"))\n      const clipTime = createTrackClipObject('beat-dropzone', Tmp_clip.getClipType(), Tmp_clip.getClipId(), Tmp_clip.getDuration(), TrackObject.getBeatId())\n      TrackObject.setMusicClip(Tmp_clip, clipTime)\n      //console.log(\"clip Time Check\", clipTime/10);\n        trackActivaqte = false;\n      }\n    },\n    ondragleave: function (event) {\n      // remove the drop feedback style\n      event.target.classList.remove('drop-target')\n      event.relatedTarget.classList.remove('can-drop')\n      //event.relatedTarget.textContent = 'Dragged out'\n    },\n    ondrop: function (event) {\n      //event.relatedTarget.textContent = 'Dropped'\n      //createTrackClipObject('beat-dropzone',get_clip(event.target.getAttribute(\"clip_id\"), event.target.getAttribute(\"clip_type\")))\n  \n    },\n    ondropdeactivate: function (event) {\n      // remove active dropzone feedback\n      trackActivaqte = true\n    }\n  })\n  \n  interact('.drag-drop')\n    .draggable({\n      inertia: true,\n      modifiers: [\n        interact.modifiers.restrictRect({\n          restriction: 'parent',\n          endOnly: true\n        })\n      ],\n      autoScroll: true,\n      // dragMoveListener from the dragging demo above\n      listeners: { move: dragMoveListenerxy }\n    })\n  \n  function dragMoveListenerxy (event) {\n    var target = event.target\n    // keep the dragged position in the data-x/data-y attributes\n    var x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx\n    var y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy\n    // translate the element\n    target.style.transform = 'translate(' + x + 'px, ' + y + 'px)'\n    // update the posiion attributes\n    target.setAttribute('data-x', x)\n    target.setAttribute('data-y', y)\n  }\n\n//# sourceURL=webpack://Synthesizer/./src/js/SheetMusic.js?");

/***/ }),

/***/ "./src/js/Synthesizer.js":
/*!*******************************!*\
  !*** ./src/js/Synthesizer.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"beat_output_play\": () => (/* binding */ beat_output_play),\n/* harmony export */   \"beat_player\": () => (/* binding */ beat_player),\n/* harmony export */   \"dialInitialize\": () => (/* binding */ dialInitialize),\n/* harmony export */   \"piano_player\": () => (/* binding */ piano_player)\n/* harmony export */ });\n/* harmony import */ var _JZZ_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./JZZ.js */ \"./src/js/JZZ.js\");\n/* harmony import */ var _JZZ_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_JZZ_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _Share_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Share.js */ \"./src/js/Share.js\");\n\n\n\nlet noteType = [\"C\",\"C#\",\"D\",\"D#\",\"E\",\"F\",\"F#\",\"G\",\"G#\",\"A\",\"A#\",\"B\"]\nlet vector = {X:\"x\", Y:\"y\"}\n\nlet BeatHapticOn = true; //bpm-beat haptic 설정용 예비함수2 (서로 반대로 설정해야함)\n\n//AutiFilter >> 그냥 필터!\nconst filter = new Tone.Filter().toDestination();\nfilter.set({\n  frequency: \"C4\",\n  type:\"highpass\"\n});\n\nconst beatAudio1 = document.getElementById('beat1');\nconst beatAudio2 = document.getElementById('beat2');\nconst beatAudio3 = document.getElementById('beat3');\nconst beatAudio4 = document.getElementById('beat4');\n//AutoWah >> 울리는 효과\n// const autoWah = new Tone.AutoWah(50, 6, -30).toDestination();\n// autoWah.Q.value = 6;\n\n//BitCrusher >> 찢어지는 듯한 효과\n// const crusher = new Tone.BitCrusher(4).toDestination();\n\n//Chebyshev >> 고양이 소리?\n// const cheby = new Tone.Chebyshev(50).toDestination();\n\n//Chorus >> 동시에 누를 때 확인\n// const chorus = new Tone.Chorus(4, 2.5, 0.5).toDestination().start();\n\n//Distortion >> 음이 더 늘어지는 효과\n//const dist = new Tone.Distortion(1.5).toDestination();\n\n//FeedbackDelay >> delay랑 코러스 효과음?\n// const feedbackDelay = new Tone.FeedbackDelay(\"8n\", 0.5).toDestination();\n\n//Freeverb >> 먹먹해지는 효과?\n// const freeverb = new Tone.Freeverb().toDestination();\n// freeverb.dampening = 1000;\n\n//JCReverb >> 두 음이 울리는 느낌?\n//const reverb = new Tone.JCReverb(0.4).toDestination();\nconst delay = new Tone.FeedbackDelay(0.5).toDestination();;\n//const synth = new Tone.Synth().chain(delay, reverb);\n\n//Phaser >> 잡음이 섞이는 느낌\n// const phaser = new Tone.Phaser({\n// \tfrequency: 150,\n// \toctaves: 10,\n// \tbaseFrequency: 1000\n// }).toDestination();\n\n// //PingPonDelay >> 탁구공이 튀는 느낌으로 점점 음이 생기는 느낌\n// const pingPong = new Tone.PingPongDelay(\"4n\", 0.2).toDestination();\n\n// const vibrato = new Tone.Vibrato(5, 0.1).toDestination();\n\nlet autoWah = new Tone.AutoWah(50, 6, -30).toDestination();\nlet crusher = new Tone.BitCrusher(4).toDestination();\nlet cheby = new Tone.Chebyshev(50).toDestination();\nlet chorus = new Tone.Chorus(5, 2.5, 0.5).toDestination();\nlet feedbackDelay = new Tone.FeedbackDelay(\"8n\", 0.5).toDestination();\nlet freeverb = new Tone.Freeverb().toDestination();\nlet phaser = new Tone.Phaser({\n  frequency: 150,\n  octaves: 10,\n  baseFrequency: 1000\n}).toDestination();\nlet vibrato = new Tone.Vibrato(5, 0.1).toDestination();\nlet dial_bool = [false, false, false, false, false, false, false, false]\n\n// const synth = new Tone.Synth().chain(chorus).toDestination();\n// const AMsynth = new Tone.AMSynth().toDestination();\n// const duoSynth = new Tone.DuoSynth().toDestination();\nconst fmSynth = new Tone.FMSynth().toDestination();\n// const MembraneSynth = new Tone.MembraneSynth().toDestination();\n// const plucky = new Tone.PluckSynth().toDestination();\n\n\nconst polySynth = new Tone.PolySynth().toDestination();\npolySynth.set({ detune: -1200 });\n\nconst MonoSynth = new Tone.MonoSynth({\n\toscillator: {\n\t\ttype: \"square\"\n\t},\n\tenvelope: {\n\t\tattack: 0.1\n\t}\n}).toDestination();\n\nconst sampler = new Tone.Sampler({\n\turls: {\n\t\tA1: \"A1.mp3\",\n\t\tA2: \"A2.mp3\",\n\t},\n\t//baseUrl: \"https://tonejs.github.io/audio/salamander/\",\n  baseUrl: \"https://tonejs.github.io/audio/casio/\",\n  attack: 1,\n  release: 0,\n}).toDestination();\n\n//sampler.connect(pingPong)\n\n\n\n// Beat\n//const MetalSynth = new Tone.MetalSynth().toDestination();\n//const noiseSynth = new Tone.NoiseSynth().toDestination();\n\n\n\nfunction set_synthesiser(msg){\n  let synthesiser_msg = get_msg_input(msg)\n    switch (synthesiser_msg.input_type){\n      case \"90\":  //Press the piano keys\n        piano_key_input(synthesiser_msg.input_id, synthesiser_msg.input_value)\n        break;\n      case \"80\":  //Release the piano keys\n        piano_key_release(synthesiser_msg.input_id)\n        break;\n      case \"99\":  //tap the touch pad\n        pad_input(synthesiser_msg.input_id, synthesiser_msg.input_value)\n        break;\n      case \"89\":  //Release the touch pad\n        pad_output(synthesiser_msg.input_id)\n        break;\n      case \"b0\":  //Moving the dial or Moving the joystick(up,down)\n        if(synthesiser_msg.input_id != 1){\n          dial_input(synthesiser_msg.input_id, synthesiser_msg.input_value)\n        }\n        else{\n          joystick_input(synthesiser_msg.input_id, synthesiser_msg.input_value, vector.Y)\n        }\n        break;\n      case \"e0\":  //Moving the joystick(left, right)\n        joystick_input(synthesiser_msg.input_id, synthesiser_msg.input_value, vector.X)\n        break;\n      case \"d9\":  //Press the touch pad\n        break;\n      default:\n        break;\n      }\n}\n\nfunction get_msg_input(msg){\n  // output list : [input_type, input_id, input_value, bool(OnOff)]\n  return {\n    input_type: msg.substr(0,2), \n    input_id: parseInt(msg.substr(3,2), 16), \n    input_value: parseInt(msg.substr(6,2), 16)\n  }\n}\nfunction piano_player(input_note, attackRelase, value = 127){\n  if(attackRelase){\n    polySynth.triggerAttack(input_note);\n    _Share_js__WEBPACK_IMPORTED_MODULE_1__.note_set.pitch = note2Pitch(input_note);  //output : 0 ~ 127\n    _Share_js__WEBPACK_IMPORTED_MODULE_1__.note_set.note = input_note; //output : C0 ~ B7\n    _Share_js__WEBPACK_IMPORTED_MODULE_1__.note_set.value = value; //output : 0 ~ 127\n    const event = new CustomEvent('noteInput', { detail: _Share_js__WEBPACK_IMPORTED_MODULE_1__.note_set });\n    _Share_js__WEBPACK_IMPORTED_MODULE_1__.SyntheysizerEvents.dispatchEvent(event);\n  }\n  else{\n    polySynth.triggerRelease(input_note);\n    _Share_js__WEBPACK_IMPORTED_MODULE_1__.note_set.pitch = note2Pitch(input_note);  //output : 0 ~ 127\n    _Share_js__WEBPACK_IMPORTED_MODULE_1__.note_set.note = input_note; //output : C0 ~ B7\n    const event = new CustomEvent('noteRelease', { detail: _Share_js__WEBPACK_IMPORTED_MODULE_1__.note_set });\n    _Share_js__WEBPACK_IMPORTED_MODULE_1__.SyntheysizerEvents.dispatchEvent(event);\n  }\n}\nfunction note2Pitch(input_note){\n  //console.log(\"input\", input_note.slice(0,-1), input_note.slice(-1));\n  let num = noteType.findIndex((num) => num == input_note.slice(0,1));\n  return num + noteType.length * parseInt(input_note.slice(-1))\n}\nfunction pitch2Note(input_pitch){\n  return noteType[input_pitch%12] + String(parseInt(input_pitch/12))\n}\n\nfunction piano_key_input(input_id, input_value){\n  let input_note = pitch2Note(input_id)\n  piano_player(input_note, true);\n  _Share_js__WEBPACK_IMPORTED_MODULE_1__.note_set.pitch = input_id;  //output : 0 ~ 127\n  _Share_js__WEBPACK_IMPORTED_MODULE_1__.note_set.note = input_note; //output : C0 ~ B7\n  _Share_js__WEBPACK_IMPORTED_MODULE_1__.note_set.value = input_value; //output : 0 ~ 127\n  const event = new CustomEvent('pianoKeyInput', { detail: _Share_js__WEBPACK_IMPORTED_MODULE_1__.note_set });\n  _Share_js__WEBPACK_IMPORTED_MODULE_1__.SyntheysizerEvents.dispatchEvent(event);\n}\n\nfunction piano_key_release(input_id){\n  let input_note = pitch2Note(input_id)\n  piano_player(input_note, false);\n  _Share_js__WEBPACK_IMPORTED_MODULE_1__.note_set.pitch = input_id;  //output : 0 ~ 127\n  _Share_js__WEBPACK_IMPORTED_MODULE_1__.note_set.note = input_note; //output : C0 ~ B7\n  const event = new CustomEvent('pianoKeyOutput', { detail: _Share_js__WEBPACK_IMPORTED_MODULE_1__.note_set });\n  _Share_js__WEBPACK_IMPORTED_MODULE_1__.SyntheysizerEvents.dispatchEvent(event);\n}\nfunction restartAudio(audioElement) {\n  audioElement.currentTime = 0; // 재생 위치를 0으로 설정\n  audioElement.play(); // 오디오 재생 시작\n}\nfunction beat_player(input_id){\n  _Share_js__WEBPACK_IMPORTED_MODULE_1__.pad_set.id = input_id;\n  const event = new CustomEvent('padInput', { detail: _Share_js__WEBPACK_IMPORTED_MODULE_1__.pad_set });\n  _Share_js__WEBPACK_IMPORTED_MODULE_1__.SyntheysizerEvents.dispatchEvent(event);\n  //console.log(\"tap Check\");\n  switch (input_id){\n    case 0:\n      restartAudio(beatAudio1);\n      if(!document.getElementById(\"hapticType\").checked){\n        document.getElementById('HapticPlayButton1').click();\n      }\n      break;\n    case 1:\n      restartAudio(beatAudio2);\n      if(!document.getElementById(\"hapticType\").checked){\n        document.getElementById('HapticPlayButton2').click();\n      }\n      break;\n    case 2:\n      restartAudio(beatAudio3);\n      if(!document.getElementById(\"hapticType\").checked){\n        document.getElementById('HapticPlayButton3').click();\n      }\n      break;\n    case 3:\n      restartAudio(beatAudio4);\n      if(!document.getElementById(\"hapticType\").checked){\n        document.getElementById('HapticPlayButton4').click();\n      }\n      break;\n    default:\n      break;\n  }\n}\nfunction beat_output_play(input_id){\n  _Share_js__WEBPACK_IMPORTED_MODULE_1__.pad_set.id = input_id;\n  const event = new CustomEvent('padOutput', { detail: _Share_js__WEBPACK_IMPORTED_MODULE_1__.pad_set });\n  _Share_js__WEBPACK_IMPORTED_MODULE_1__.SyntheysizerEvents.dispatchEvent(event);\n}\n\nfunction pad_input(input_id){\n  _Share_js__WEBPACK_IMPORTED_MODULE_1__.pad_set.id = input_id - 36;\n  beat_player(input_id - 36)\n  const event = new CustomEvent('padkeyInput', { detail: _Share_js__WEBPACK_IMPORTED_MODULE_1__.pad_set });\n  _Share_js__WEBPACK_IMPORTED_MODULE_1__.SyntheysizerEvents.dispatchEvent(event);\n}\nfunction pad_output(input_id){\n  beat_output_play(input_id - 36)\n}\n_Share_js__WEBPACK_IMPORTED_MODULE_1__.SyntheysizerEvents.addEventListener('templateLoad', function (e){\n  // console.log(\"In Circle note: \", e.detail.value); //범위가 0~127입니다.\n  _Share_js__WEBPACK_IMPORTED_MODULE_1__.dial_set.value = e.detail;\n  //console.log(\"set chnaged\", dial_set);\n  const event = new CustomEvent('dialInput', { detail: _Share_js__WEBPACK_IMPORTED_MODULE_1__.dial_set });\n  _Share_js__WEBPACK_IMPORTED_MODULE_1__.SyntheysizerEvents.dispatchEvent(event);\n  //console.log(dial_set);\n  //for(let i = 70; i < 78; i++){\n  //  dial_effect(i, dial_set.value[parseInt((i-70)/4)][(i-70)%4]);\n  //}\n})\n\n\nfunction dialInitialize(){\n  _Share_js__WEBPACK_IMPORTED_MODULE_1__.dial_set.value = [[0.0, 0.0, 0.0, 0.0], \n                  [0.0, 0.0, 0.0, 0.0]]\n  const event = new CustomEvent('dialInput', { detail: _Share_js__WEBPACK_IMPORTED_MODULE_1__.dial_set });\n  _Share_js__WEBPACK_IMPORTED_MODULE_1__.SyntheysizerEvents.dispatchEvent(event);\n  for(let i = 70; i < 78; i++){\n    dial_effect(i, 0);\n  }\n  \n}\nfunction dial_input(input_id, input_value){\n  //console.log(\"dial_input\", input_id, );\n  if(input_id > 69){  //there are except case in joystick\n    _Share_js__WEBPACK_IMPORTED_MODULE_1__.dial_set.value[parseInt((input_id-70)/4)][(input_id-70)%4] = input_value;\n    const event = new CustomEvent('dialInput', { detail: _Share_js__WEBPACK_IMPORTED_MODULE_1__.dial_set });\n    _Share_js__WEBPACK_IMPORTED_MODULE_1__.SyntheysizerEvents.dispatchEvent(event);\n    dial_effect(input_id, input_value);\n  }\n}\n\nfunction Normaizing(input_value, minmaxList){\n  return minmaxList[0] + (minmaxList[1] - minmaxList[0]) * ((input_value - 10) / (127 - 10));\n}\n\nfunction dial_effect(input_id, input_value){\n    switch (input_id){\n      case 70:\n        console.log(\"feedbackDelay\", input_value)\n        if(dial_bool[0]){\n          console.log(\"feedbackDelay disconnect\");\n          polySynth.disconnect(feedbackDelay);\n          dial_bool[0] = false;\n        }\n        if(input_value > 10){\n          // console.log(\"connect\");\n          //feedbackDelay = new Tone.FeedbackDelay(\"8n\", Normaizing(input_value, [0, 0.8])).toDestination();\n          //feedbackDelay.feedback.value = Normaizing(input_value, [0, 0.5]);\n          //polySynth.connect(feedbackDelay);\n          //dial_bool[0] = true;\n        }\n        break;\n      case 71:\n        console.log(\"crusher\", input_value)\n        if(dial_bool[1]){\n          console.log(\"crusher disconnect\");\n          polySynth.disconnect(crusher);\n          dial_bool[1] = false;\n        }\n        if(input_value > 10){\n          // console.log(\"connect\");\n          //crusher.bits.value = 9 - parseInt(Normaizing(input_value, [1, 3]));\n          //polySynth.connect(crusher);\n          //dial_bool[1] = true;\n        }\n        break;\n      case 72:\n        console.log(\"cheby\", input_value)\n        if(dial_bool[2]){\n          console.log(\"cheby disconnect\");\n          polySynth.disconnect(cheby);\n          dial_bool[2] = false;\n        }\n        if(input_value > 10){  \n          // console.log(\"connect\");\n          //cheby.order = parseInt(Normaizing(input_value, [1, 20]));\n          //polySynth.connect(cheby);\n          //dial_bool[2] = true;\n        }\n        break;\n      case 73:\n        console.log(\"chorus\", input_value)\n        if(dial_bool[3]){\n          console.log(\"chorus disconnect\");\n          polySynth.disconnect(chorus);\n          dial_bool[3] = false;\n        }\n        if(input_value > 10){\n          // console.log(\"connect\");\n          //chorus = new Tone.Chorus(Normaizing(input_value, [1, 10]), 2.5, 0.5).toDestination();\n          chorus.frequency.value = Normaizing(input_value, [1, 7])\n          polySynth.connect(chorus);\n          dial_bool[3] = true;\n        }\n        break;\n      default:\n        break;\n      }\n}\n\n\n\nfunction joystick_input(input_id, input_value, type){\n  if(type == vector.X){\n    //console.log(type, input_value - 64)\n    _Share_js__WEBPACK_IMPORTED_MODULE_1__.joystick_set.value[0] = input_value - 64;\n    const event = new CustomEvent('joystickInpnut', { detail: _Share_js__WEBPACK_IMPORTED_MODULE_1__.joystick_set });\n    _Share_js__WEBPACK_IMPORTED_MODULE_1__.SyntheysizerEvents.dispatchEvent(event);\n  }\n  else{\n    //console.log(type, parseInt(input_value/2))\n    _Share_js__WEBPACK_IMPORTED_MODULE_1__.joystick_set.value[1] = parseInt(input_value/2)\n    const event = new CustomEvent('joystickInpnut', { detail: _Share_js__WEBPACK_IMPORTED_MODULE_1__.joystick_set });\n    _Share_js__WEBPACK_IMPORTED_MODULE_1__.SyntheysizerEvents.dispatchEvent(event);\n  }\n}\n\n// MIDI Device Detect code\nvar midi_in;\nlet open_midi = document.querySelector('[data-action=\"open_midi_in\"]');\nopen_midi.addEventListener('click', event => {\n  midi_in = (0,_JZZ_js__WEBPACK_IMPORTED_MODULE_0__.JZZ)().openMidiIn()\n  .or(function(){document.getElementById(\"midiInName\").innerHTML = \"Cannot open!\";})\n  .and(function(){document.getElementById(\"midiInName\").innerHTML = this.name(); console.log(this.info());})\n  .connect(function(msg){\n    set_synthesiser(msg.toString());\n  });\n });\n\n let close_midi = document.querySelector('[data-action=\"close_midi_in\"]');\n close_midi.addEventListener('click', event => {\n  if (midi_in) {\n    midi_in.close();\n    midi_in = undefined;\n    document.getElementById(\"midiInName\").innerHTML = \"closed\";\n  }\n  });\n\n//# sourceURL=webpack://Synthesizer/./src/js/Synthesizer.js?");

/***/ }),

/***/ "./src/js/jsmidgen.js":
/*!****************************!*\
  !*** ./src/js/jsmidgen.js ***!
  \****************************/
/***/ (function(module, exports, __webpack_require__) {

eval("/* module decorator */ module = __webpack_require__.nmd(module);\nvar Midi = {};\n\n(function(exported) {\n\n\tvar DEFAULT_VOLUME   = exported.DEFAULT_VOLUME   = 90;\n\tvar DEFAULT_DURATION = exported.DEFAULT_DURATION = 128;\n\tvar DEFAULT_CHANNEL  = exported.DEFAULT_CHANNEL  = 0;\n\n\t/* ******************************************************************\n\t * Utility functions\n\t ****************************************************************** */\n\n\tvar Util = {\n\n\t\tmidi_letter_pitches: { a:21, b:23, c:12, d:14, e:16, f:17, g:19 },\n\n\t\t/**\n\t\t * Convert a symbolic note name (e.g. \"c4\") to a numeric MIDI pitch (e.g.\n\t\t * 60, middle C).\n\t\t *\n\t\t * @param {string} n - The symbolic note name to parse.\n\t\t * @returns {number} The MIDI pitch that corresponds to the symbolic note\n\t\t * name.\n\t\t */\n\t\tmidiPitchFromNote: function(n) {\n\t\t\tvar matches = /([a-g])(#+|b+)?([0-9]+)$/i.exec(n);\n\t\t\tvar note = matches[1].toLowerCase(), accidental = matches[2] || '', octave = parseInt(matches[3], 10);\n\t\t\treturn (12 * octave) + Util.midi_letter_pitches[note] + (accidental.substr(0,1)=='#'?1:-1) * accidental.length;\n\t\t},\n\n\t\t/**\n\t\t * Ensure that the given argument is converted to a MIDI pitch. Note that\n\t\t * it may already be one (including a purely numeric string).\n\t\t *\n\t\t * @param {string|number} p - The pitch to convert.\n\t\t * @returns {number} The resulting numeric MIDI pitch.\n\t\t */\n\t\tensureMidiPitch: function(p) {\n\t\t\tif (typeof p == 'number' || !/[^0-9]/.test(p)) {\n\t\t\t\t// numeric pitch\n\t\t\t\treturn parseInt(p, 10);\n\t\t\t} else {\n\t\t\t\t// assume it's a note name\n\t\t\t\treturn Util.midiPitchFromNote(p);\n\t\t\t}\n\t\t},\n\n\t\tmidi_pitches_letter: { '12':'c', '13':'c#', '14':'d', '15':'d#', '16':'e', '17':'f', '18':'f#', '19':'g', '20':'g#', '21':'a', '22':'a#', '23':'b' },\n\t\tmidi_flattened_notes: { 'a#':'bb', 'c#':'db', 'd#':'eb', 'f#':'gb', 'g#':'ab' },\n\n\t\t/**\n\t\t * Convert a numeric MIDI pitch value (e.g. 60) to a symbolic note name\n\t\t * (e.g. \"c4\").\n\t\t *\n\t\t * @param {number} n - The numeric MIDI pitch value to convert.\n\t\t * @param {boolean} [returnFlattened=false] - Whether to prefer flattened\n\t\t * notes to sharpened ones. Optional, default false.\n\t\t * @returns {string} The resulting symbolic note name.\n\t\t */\n\t\tnoteFromMidiPitch: function(n, returnFlattened) {\n\t\t\tvar octave = 0, noteNum = n, noteName, returnFlattened = returnFlattened || false;\n\t\t\tif (n > 23) {\n\t\t\t\t// noteNum is on octave 1 or more\n\t\t\t\toctave = Math.floor(n/12) - 1;\n\t\t\t\t// subtract number of octaves from noteNum\n\t\t\t\tnoteNum = n - octave * 12;\n\t\t\t}\n\n\t\t\t// get note name (c#, d, f# etc)\n\t\t\tnoteName = Util.midi_pitches_letter[noteNum];\n\t\t\t// Use flattened notes if requested (e.g. f# should be output as gb)\n\t\t\tif (returnFlattened && noteName.indexOf('#') > 0) {\n\t\t\t\tnoteName = Util.midi_flattened_notes[noteName];\n\t\t\t}\n\t\t\treturn noteName + octave;\n\t\t},\n\n\t\t/**\n\t\t * Convert beats per minute (BPM) to microseconds per quarter note (MPQN).\n\t\t *\n\t\t * @param {number} bpm - A number in beats per minute.\n\t\t * @returns {number} The number of microseconds per quarter note.\n\t\t */\n\t\tmpqnFromBpm: function(bpm) {\n\t\t\tvar mpqn = Math.floor(60000000 / bpm);\n\t\t\tvar ret=[];\n\t\t\tdo {\n\t\t\t\tret.unshift(mpqn & 0xFF);\n\t\t\t\tmpqn >>= 8;\n\t\t\t} while (mpqn);\n\t\t\twhile (ret.length < 3) {\n\t\t\t\tret.push(0);\n\t\t\t}\n\t\t\treturn ret;\n\t\t},\n\n\t\t/**\n\t\t * Convert microseconds per quarter note (MPQN) to beats per minute (BPM).\n\t\t *\n\t\t * @param {number} mpqn - The number of microseconds per quarter note.\n\t\t * @returns {number} A number in beats per minute.\n\t\t */\n\t\tbpmFromMpqn: function(mpqn) {\n\t\t\tvar m = mpqn;\n\t\t\tif (typeof mpqn[0] != 'undefined') {\n\t\t\t\tm = 0;\n\t\t\t\tfor (var i=0, l=mpqn.length-1; l >= 0; ++i, --l) {\n\t\t\t\t\tm |= mpqn[i] << l;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn Math.floor(60000000 / mpqn);\n\t\t},\n\n\t\t/**\n\t\t * Converts an array of bytes to a string of hexadecimal characters. Prepares\n\t\t * it to be converted into a base64 string.\n\t\t *\n\t\t * @param {Array} byteArray - Array of bytes to be converted.\n\t\t * @returns {string} Hexadecimal string, e.g. \"097B8A\".\n\t\t */\n\t\tcodes2Str: function(byteArray) {\n\t\t\treturn String.fromCharCode.apply(null, byteArray);\n\t\t},\n\n\t\t/**\n\t\t * Converts a string of hexadecimal values to an array of bytes. It can also\n\t\t * add remaining \"0\" nibbles in order to have enough bytes in the array as the\n\t\t * `finalBytes` parameter.\n\t\t *\n\t\t * @param {string} str - string of hexadecimal values e.g. \"097B8A\"\n\t\t * @param {number} [finalBytes] - Optional. The desired number of bytes\n\t\t * (not nibbles) that the returned array should contain.\n\t\t * @returns {Array} An array of nibbles.\n\t\t */\n\t\tstr2Bytes: function (str, finalBytes) {\n\t\t\tif (finalBytes) {\n\t\t\t\twhile ((str.length / 2) < finalBytes) { str = \"0\" + str; }\n\t\t\t}\n\n\t\t\tvar bytes = [];\n\t\t\tfor (var i=str.length-1; i>=0; i = i-2) {\n\t\t\t\tvar chars = i === 0 ? str[i] : str[i-1] + str[i];\n\t\t\t\tbytes.unshift(parseInt(chars, 16));\n\t\t\t}\n\n\t\t\treturn bytes;\n\t\t},\n\n\t\t/**\n\t\t * Translates number of ticks to MIDI timestamp format, returning an array\n\t\t * of bytes with the time values. MIDI has a very particular way to express\n\t\t * time; take a good look at the spec before ever touching this function.\n\t\t *\n\t\t * @param {number} ticks - Number of ticks to be translated.\n\t\t * @returns {number} Array of bytes that form the MIDI time value.\n\t\t */\n\t\ttranslateTickTime: function(ticks) {\n\t\t\tvar buffer = ticks & 0x7F;\n\n\t\t\twhile (ticks = ticks >> 7) {\n\t\t\t\tbuffer <<= 8;\n\t\t\t\tbuffer |= ((ticks & 0x7F) | 0x80);\n\t\t\t}\n\n\t\t\tvar bList = [];\n\t\t\twhile (true) {\n\t\t\t\tbList.push(buffer & 0xff);\n\n\t\t\t\tif (buffer & 0x80) { buffer >>= 8; }\n\t\t\t\telse { break; }\n\t\t\t}\n\t\t\treturn bList;\n\t\t},\n\n\t};\n\n\t/* ******************************************************************\n\t * Event class\n\t ****************************************************************** */\n\n\t/**\n\t * Construct a MIDI event.\n\t *\n\t * Parameters include:\n\t *  - time [optional number] - Ticks since previous event.\n\t *  - type [required number] - Type of event.\n\t *  - channel [required number] - Channel for the event.\n\t *  - param1 [required number] - First event parameter.\n\t *  - param2 [optional number] - Second event parameter.\n\t */\n\tvar MidiEvent = function(params) {\n\t\tif (!this) return new MidiEvent(params);\n\t\tif (params &&\n\t\t\t\t(params.type    !== null || params.type    !== undefined) &&\n\t\t\t\t(params.channel !== null || params.channel !== undefined) &&\n\t\t\t\t(params.param1  !== null || params.param1  !== undefined)) {\n\t\t\tthis.setTime(params.time);\n\t\t\tthis.setType(params.type);\n\t\t\tthis.setChannel(params.channel);\n\t\t\tthis.setParam1(params.param1);\n\t\t\tthis.setParam2(params.param2);\n\t\t}\n\t};\n\n\t// event codes\n\tMidiEvent.NOTE_OFF           = 0x80;\n\tMidiEvent.NOTE_ON            = 0x90;\n\tMidiEvent.AFTER_TOUCH        = 0xA0;\n\tMidiEvent.CONTROLLER         = 0xB0;\n\tMidiEvent.PROGRAM_CHANGE     = 0xC0;\n\tMidiEvent.CHANNEL_AFTERTOUCH = 0xD0;\n\tMidiEvent.PITCH_BEND         = 0xE0;\n\n\n\t/**\n\t * Set the time for the event in ticks since the previous event.\n\t *\n\t * @param {number} ticks - The number of ticks since the previous event. May\n\t * be zero.\n\t */\n\tMidiEvent.prototype.setTime = function(ticks) {\n\t\tthis.time = Util.translateTickTime(ticks || 0);\n\t};\n\n\t/**\n\t * Set the type of the event. Must be one of the event codes on MidiEvent.\n\t *\n\t * @param {number} type - Event type.\n\t */\n\tMidiEvent.prototype.setType = function(type) {\n\t\tif (type < MidiEvent.NOTE_OFF || type > MidiEvent.PITCH_BEND) {\n\t\t\tthrow new Error(\"Trying to set an unknown event: \" + type);\n\t\t}\n\n\t\tthis.type = type;\n\t};\n\n\t/**\n\t * Set the channel for the event. Must be between 0 and 15, inclusive.\n\t *\n\t * @param {number} channel - The event channel.\n\t */\n\tMidiEvent.prototype.setChannel = function(channel) {\n\t\tif (channel < 0 || channel > 15) {\n\t\t\tthrow new Error(\"Channel is out of bounds.\");\n\t\t}\n\n\t\tthis.channel = channel;\n\t};\n\n\t/**\n\t * Set the first parameter for the event. Must be between 0 and 255,\n\t * inclusive.\n\t *\n\t * @param {number} p - The first event parameter value.\n\t */\n\tMidiEvent.prototype.setParam1 = function(p) {\n\t\tthis.param1 = p;\n\t};\n\n\t/**\n\t * Set the second parameter for the event. Must be between 0 and 255,\n\t * inclusive.\n\t *\n\t * @param {number} p - The second event parameter value.\n\t */\n\tMidiEvent.prototype.setParam2 = function(p) {\n\t\tthis.param2 = p;\n\t};\n\n\t/**\n\t * Serialize the event to an array of bytes.\n\t *\n\t * @returns {Array} The array of serialized bytes.\n\t */\n\tMidiEvent.prototype.toBytes = function() {\n\t\tvar byteArray = [];\n\n\t\tvar typeChannelByte = this.type | (this.channel & 0xF);\n\n\t\tbyteArray.push.apply(byteArray, this.time);\n\t\tbyteArray.push(typeChannelByte);\n\t\tbyteArray.push(this.param1);\n\n\t\t// Some events don't have a second parameter\n\t\tif (this.param2 !== undefined && this.param2 !== null) {\n\t\t\tbyteArray.push(this.param2);\n\t\t}\n\t\treturn byteArray;\n\t};\n\n\t/* ******************************************************************\n\t * MetaEvent class\n\t ****************************************************************** */\n\n\t/**\n\t * Construct a meta event.\n\t *\n\t * Parameters include:\n\t *  - time [optional number] - Ticks since previous event.\n\t *  - type [required number] - Type of event.\n\t *  - data [optional array|string] - Event data.\n\t */\n\tvar MetaEvent = function(params) {\n\t\tif (!this) return new MetaEvent(params);\n\t\tvar p = params || {};\n\t\tthis.setTime(params.time);\n\t\tthis.setType(params.type);\n\t\tthis.setData(params.data);\n\t};\n\n\tMetaEvent.SEQUENCE   = 0x00;\n\tMetaEvent.TEXT       = 0x01;\n\tMetaEvent.COPYRIGHT  = 0x02;\n\tMetaEvent.TRACK_NAME = 0x03;\n\tMetaEvent.INSTRUMENT = 0x04;\n\tMetaEvent.LYRIC      = 0x05;\n\tMetaEvent.MARKER     = 0x06;\n\tMetaEvent.CUE_POINT  = 0x07;\n\tMetaEvent.CHANNEL_PREFIX = 0x20;\n\tMetaEvent.END_OF_TRACK   = 0x2f;\n\tMetaEvent.TEMPO      = 0x51;\n\tMetaEvent.SMPTE      = 0x54;\n\tMetaEvent.TIME_SIG   = 0x58;\n\tMetaEvent.KEY_SIG    = 0x59;\n\tMetaEvent.SEQ_EVENT  = 0x7f;\n\n\t/**\n\t * Set the time for the event in ticks since the previous event.\n\t *\n\t * @param {number} ticks - The number of ticks since the previous event. May\n\t * be zero.\n\t */\n\tMetaEvent.prototype.setTime = function(ticks) {\n\t\tthis.time = Util.translateTickTime(ticks || 0);\n\t};\n\n\t/**\n\t * Set the type of the event. Must be one of the event codes on MetaEvent.\n\t *\n\t * @param {number} t - Event type.\n\t */\n\tMetaEvent.prototype.setType = function(t) {\n\t\tthis.type = t;\n\t};\n\n\t/**\n\t * Set the data associated with the event. May be a string or array of byte\n\t * values.\n\t *\n\t * @param {string|Array} d - Event data.\n\t */\n\tMetaEvent.prototype.setData = function(d) {\n\t\tthis.data = d;\n\t};\n\n\t/**\n\t * Serialize the event to an array of bytes.\n\t *\n\t * @returns {Array} The array of serialized bytes.\n\t */\n\tMetaEvent.prototype.toBytes = function() {\n\t\tif (!this.type) {\n\t\t\tthrow new Error(\"Type for meta-event not specified.\");\n\t\t}\n\n\t\tvar byteArray = [];\n\t\tbyteArray.push.apply(byteArray, this.time);\n\t\tbyteArray.push(0xFF, this.type);\n\n\t\t// If data is an array, we assume that it contains several bytes. We\n\t\t// apend them to byteArray.\n\t\tif (Array.isArray(this.data)) {\n\t\t\tbyteArray.push(this.data.length);\n\t\t\tbyteArray.push.apply(byteArray, this.data);\n\t\t} else if (typeof this.data == 'number') {\n\t\t\tbyteArray.push(1, this.data);\n\t\t} else if (this.data !== null && this.data !== undefined) {\n\t\t\t// assume string; may be a bad assumption\n\t\t\tbyteArray.push(this.data.length);\n\t\t\tvar dataBytes = this.data.split('').map(function(x){ return x.charCodeAt(0) });\n\t\t\tbyteArray.push.apply(byteArray, dataBytes);\n\t\t} else {\n\t\t\tbyteArray.push(0);\n\t\t}\n\n\t\treturn byteArray;\n\t};\n\n\t/* ******************************************************************\n\t * Track class\n\t ****************************************************************** */\n\n\t/**\n\t * Construct a MIDI track.\n\t *\n\t * Parameters include:\n\t *  - events [optional array] - Array of events for the track.\n\t */\n\tvar Track = function(config) {\n\t\tif (!this) return new Track(config);\n\t\tvar c = config || {};\n\t\tthis.events = c.events || [];\n\t};\n\n\tTrack.START_BYTES = [0x4d, 0x54, 0x72, 0x6b];\n\tTrack.END_BYTES   = [0x00, 0xFF, 0x2F, 0x00];\n\n\t/**\n\t * Add an event to the track.\n\t *\n\t * @param {MidiEvent|MetaEvent} event - The event to add.\n\t * @returns {Track} The current track.\n\t */\n\tTrack.prototype.addEvent = function(event) {\n\t\tthis.events.push(event);\n\t\treturn this;\n\t};\n\n\t/**\n\t * Add a note-on event to the track.\n\t *\n\t * @param {number} channel - The channel to add the event to.\n\t * @param {number|string} pitch - The pitch of the note, either numeric or\n\t * symbolic.\n\t * @param {number} [time=0] - The number of ticks since the previous event,\n\t * defaults to 0.\n\t * @param {number} [velocity=90] - The volume for the note, defaults to\n\t * DEFAULT_VOLUME.\n\t * @returns {Track} The current track.\n\t */\n\tTrack.prototype.addNoteOn = Track.prototype.noteOn = function(channel, pitch, time, velocity) {\n\t\tthis.events.push(new MidiEvent({\n\t\t\ttype: MidiEvent.NOTE_ON,\n\t\t\tchannel: channel,\n\t\t\tparam1: Util.ensureMidiPitch(pitch),\n\t\t\tparam2: velocity || DEFAULT_VOLUME,\n\t\t\ttime: time || 0,\n\t\t}));\n\t\treturn this;\n\t};\n\n\t/**\n\t * Add a note-off event to the track.\n\t *\n\t * @param {number} channel - The channel to add the event to.\n\t * @param {number|string} pitch - The pitch of the note, either numeric or\n\t * symbolic.\n\t * @param {number} [time=0] - The number of ticks since the previous event,\n\t * defaults to 0.\n\t * @param {number} [velocity=90] - The velocity the note was released,\n\t * defaults to DEFAULT_VOLUME.\n\t * @returns {Track} The current track.\n\t */\n\tTrack.prototype.addNoteOff = Track.prototype.noteOff = function(channel, pitch, time, velocity) {\n\t\tthis.events.push(new MidiEvent({\n\t\t\ttype: MidiEvent.NOTE_OFF,\n\t\t\tchannel: channel,\n\t\t\tparam1: Util.ensureMidiPitch(pitch),\n\t\t\tparam2: velocity || DEFAULT_VOLUME,\n\t\t\ttime: time || 0,\n\t\t}));\n\t\treturn this;\n\t};\n\n\t/**\n\t * Add a note-on and -off event to the track.\n\t *\n\t * @param {number} channel - The channel to add the event to.\n\t * @param {number|string} pitch - The pitch of the note, either numeric or\n\t * symbolic.\n\t * @param {number} dur - The duration of the note, in ticks.\n\t * @param {number} [time=0] - The number of ticks since the previous event,\n\t * defaults to 0.\n\t * @param {number} [velocity=90] - The velocity the note was released,\n\t * defaults to DEFAULT_VOLUME.\n\t * @returns {Track} The current track.\n\t */\n\tTrack.prototype.addNote = Track.prototype.note = function(channel, pitch, dur, time, velocity) {\n\t\tthis.noteOn(channel, pitch, time, velocity);\n\t\tif (dur) {\n\t\t\tthis.noteOff(channel, pitch, dur, velocity);\n\t\t}\n\t\treturn this;\n\t};\n\n\t/**\n\t * Add a note-on and -off event to the track for each pitch in an array of pitches.\n\t *\n\t * @param {number} channel - The channel to add the event to.\n\t * @param {array} chord - An array of pitches, either numeric or\n\t * symbolic.\n\t * @param {number} dur - The duration of the chord, in ticks.\n\t * @param {number} [velocity=90] - The velocity of the chord,\n\t * defaults to DEFAULT_VOLUME.\n\t * @returns {Track} The current track.\n\t */\n\tTrack.prototype.addChord = Track.prototype.chord = function(channel, chord, dur, velocity) {\n\t\tif (!Array.isArray(chord) && !chord.length) {\n\t\t\tthrow new Error('Chord must be an array of pitches');\n\t\t}\n\t\tchord.forEach(function(note) {\n\t\t\tthis.noteOn(channel, note, 0, velocity);\n\t\t}, this);\n\t\tchord.forEach(function(note, index) {\n\t\t\tif (index === 0) {\n\t\t\t\tthis.noteOff(channel, note, dur);\n\t\t\t} else {\n\t\t\t\tthis.noteOff(channel, note);\n\t\t\t}\n\t\t}, this);\n\t\treturn this;\n\t};\n\n\t/**\n\t * Set instrument for the track.\n\t *\n\t * @param {number} channel - The channel to set the instrument on.\n\t * @param {number} instrument - The instrument to set it to.\n\t * @param {number} [time=0] - The number of ticks since the previous event,\n\t * defaults to 0.\n\t * @returns {Track} The current track.\n\t */\n\tTrack.prototype.setInstrument = Track.prototype.instrument = function(channel, instrument, time) {\n\t\tthis.events.push(new MidiEvent({\n\t\t\ttype: MidiEvent.PROGRAM_CHANGE,\n\t\t\tchannel: channel,\n\t\t\tparam1: instrument,\n\t\t\ttime: time || 0,\n\t\t}));\n\t\treturn this;\n\t};\n\n\t/**\n\t * Set the tempo for the track.\n\t *\n\t * @param {number} bpm - The new number of beats per minute.\n\t * @param {number} [time=0] - The number of ticks since the previous event,\n\t * defaults to 0.\n\t * @returns {Track} The current track.\n\t */\n\tTrack.prototype.setTempo = Track.prototype.tempo = function(bpm, time) {\n\t\tthis.events.push(new MetaEvent({\n\t\t\ttype: MetaEvent.TEMPO,\n\t\t\tdata: Util.mpqnFromBpm(bpm),\n\t\t\ttime: time || 0,\n\t\t}));\n\t\treturn this;\n\t};\n\n\t/**\n\t * Serialize the track to an array of bytes.\n\t *\n\t * @returns {Array} The array of serialized bytes.\n\t */\n\tTrack.prototype.toBytes = function() {\n\t\tvar trackLength = 0;\n\t\tvar eventBytes = [];\n\t\tvar startBytes = Track.START_BYTES;\n\t\tvar endBytes   = Track.END_BYTES;\n\n\t\tvar addEventBytes = function(event) {\n\t\t\tvar bytes = event.toBytes();\n\t\t\ttrackLength += bytes.length;\n\t\t\teventBytes.push.apply(eventBytes, bytes);\n\t\t};\n\n\t\tthis.events.forEach(addEventBytes);\n\n\t\t// Add the end-of-track bytes to the sum of bytes for the track, since\n\t\t// they are counted (unlike the start-of-track ones).\n\t\ttrackLength += endBytes.length;\n\n\t\t// Makes sure that track length will fill up 4 bytes with 0s in case\n\t\t// the length is less than that (the usual case).\n\t\tvar lengthBytes = Util.str2Bytes(trackLength.toString(16), 4);\n\n\t\treturn startBytes.concat(lengthBytes, eventBytes, endBytes);\n\t};\n\n\t/* ******************************************************************\n\t * File class\n\t ****************************************************************** */\n\n\t/**\n\t * Construct a file object.\n\t *\n\t * Parameters include:\n\t *  - ticks [optional number] - Number of ticks per beat, defaults to 128.\n\t *    Must be 1-32767.\n\t *  - tracks [optional array] - Track data.\n\t */\n\tvar File = function(config){\n\t\tif (!this) return new File(config);\n\n\t\tvar c = config || {};\n\t\tif (c.ticks) {\n\t\t\tif (typeof c.ticks !== 'number') {\n\t\t\t\tthrow new Error('Ticks per beat must be a number!');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (c.ticks <= 0 || c.ticks >= (1 << 15) || c.ticks % 1 !== 0) {\n\t\t\t\tthrow new Error('Ticks per beat must be an integer between 1 and 32767!');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.ticks = c.ticks || 128;\n\t\tthis.tracks = c.tracks || [];\n\t};\n\n\tFile.HDR_CHUNKID     = \"MThd\";             // File magic cookie\n\tFile.HDR_CHUNK_SIZE  = \"\\x00\\x00\\x00\\x06\"; // Header length for SMF\n\tFile.HDR_TYPE0       = \"\\x00\\x00\";         // Midi Type 0 id\n\tFile.HDR_TYPE1       = \"\\x00\\x01\";         // Midi Type 1 id\n\n\t/**\n\t * Add a track to the file.\n\t *\n\t * @param {Track} track - The track to add.\n\t */\n\tFile.prototype.addTrack = function(track) {\n\t\tif (track) {\n\t\t\tthis.tracks.push(track);\n\t\t\treturn this;\n\t\t} else {\n\t\t\ttrack = new Track();\n\t\t\tthis.tracks.push(track);\n\t\t\treturn track;\n\t\t}\n\t};\n\n\t/**\n\t * Serialize the MIDI file to an array of bytes.\n\t *\n\t * @returns {Array} The array of serialized bytes.\n\t */\n\tFile.prototype.toBytes = function() {\n\t\tvar trackCount = this.tracks.length.toString(16);\n\n\t\t// prepare the file header\n\t\tvar bytes = File.HDR_CHUNKID + File.HDR_CHUNK_SIZE;\n\n\t\t// set Midi type based on number of tracks\n\t\tif (parseInt(trackCount, 16) > 1) {\n\t\t\tbytes += File.HDR_TYPE1;\n\t\t} else {\n\t\t\tbytes += File.HDR_TYPE0;\n\t\t}\n\n\t\t// add the number of tracks (2 bytes)\n\t\tbytes += Util.codes2Str(Util.str2Bytes(trackCount, 2));\n\t\t// add the number of ticks per beat (currently hardcoded)\n\t\tbytes += String.fromCharCode((this.ticks/256),  this.ticks%256);;\n\n\t\t// iterate over the tracks, converting to bytes too\n\t\tthis.tracks.forEach(function(track) {\n\t\t\tbytes += Util.codes2Str(track.toBytes());\n\t\t});\n\n\t\treturn bytes;\n\t};\n\n\t/* ******************************************************************\n\t * Exports\n\t ****************************************************************** */\n\n\texported.Util = Util;\n\texported.File = File;\n\texported.Track = Track;\n\texported.Event = MidiEvent;\n\texported.MetaEvent = MetaEvent;\n\n})( Midi );\n\nif ( true && module !== null) {\n\tmodule.exports = Midi;\n} else if ( true && exports !== null) {\n\texports = Midi;\n} else {\n\tthis.Midi = Midi;\n}\n\n\n//# sourceURL=webpack://Synthesizer/./src/js/jsmidgen.js?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			id: moduleId,
/******/ 			loaded: false,
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/global */
/******/ 	(() => {
/******/ 		__webpack_require__.g = (function() {
/******/ 			if (typeof globalThis === 'object') return globalThis;
/******/ 			try {
/******/ 				return this || new Function('return this')();
/******/ 			} catch (e) {
/******/ 				if (typeof window === 'object') return window;
/******/ 			}
/******/ 		})();
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/node module decorator */
/******/ 	(() => {
/******/ 		__webpack_require__.nmd = (module) => {
/******/ 			module.paths = [];
/******/ 			if (!module.children) module.children = [];
/******/ 			return module;
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./src/js/SheetMusic.js");
/******/ 	
/******/ })()
;